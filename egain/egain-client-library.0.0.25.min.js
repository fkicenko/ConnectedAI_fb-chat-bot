/*! egain-client-library 05-06-2017 */
(function(global, factory){if (typeof module === "object" && typeof module.exports === "object"){module.exports = global.document?factory(global, true):function(w){if (!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}} else{factory(global)}})(typeof window !== "undefined"?window:this, function(window, noGlobal){var arr = []; var slice = arr.slice; var concat = arr.concat; var push = arr.push; var indexOf = arr.indexOf; var class2type = {}; var toString = class2type.toString; var hasOwn = class2type.hasOwnProperty; var support = {}; var document = window.document, version = "2.1.3", jQuery = function(selector, context){return new jQuery.fn.init(selector, context)}, rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, rmsPrefix = /^-ms-/, rdashAlpha = /-([\da-z])/gi, fcamelCase = function(all, letter){return letter.toUpperCase()}; jQuery.fn = jQuery.prototype = {jquery:version, constructor:jQuery, selector:"", length:0, toArray:function(){return slice.call(this)}, get:function(num){return num != null?num < 0?this[num + this.length]:this[num]:slice.call(this)}, pushStack:function(elems){var ret = jQuery.merge(this.constructor(), elems); ret.prevObject = this; ret.context = this.context; return ret}, each:function(callback, args){return jQuery.each(this, callback, args)}, map:function(callback){return this.pushStack(jQuery.map(this, function(elem, i){return callback.call(elem, i, elem)}))}, slice:function(){return this.pushStack(slice.apply(this, arguments))}, first:function(){return this.eq(0)}, last:function(){return this.eq( - 1)}, eq:function(i){var len = this.length, j = + i + (i < 0?len:0); return this.pushStack(j >= 0 && j < len?[this[j]]:[])}, end:function(){return this.prevObject || this.constructor(null)}, push:push, sort:arr.sort, splice:arr.splice}; jQuery.extend = jQuery.fn.extend = function(){var options, name, src, copy, copyIsArray, clone, target = arguments[0] || {}, i = 1, length = arguments.length, deep = false; if (typeof target === "boolean"){deep = target; target = arguments[i] || {}; i++}if (typeof target !== "object" && !jQuery.isFunction(target)){target = {}}if (i === length){target = this; i--}for (; i < length; i++){if ((options = arguments[i]) != null){for (name in options){src = target[name]; copy = options[name]; if (target === copy){continue}if (deep && copy && (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))){if (copyIsArray){copyIsArray = false; clone = src && jQuery.isArray(src)?src:[]} else{clone = src && jQuery.isPlainObject(src)?src:{}}target[name] = jQuery.extend(deep, clone, copy)} else if (copy !== undefined){target[name] = copy}}}}return target}; jQuery.extend({expando:"jQuery" + (version + Math.random()).replace(/\D/g, ""), isReady:true, error:function(msg){throw new Error(msg)}, noop:function(){}, isFunction:function(obj){return jQuery.type(obj) === "function"}, isArray:Array.isArray, isWindow:function(obj){return obj != null && obj === obj.window}, isNumeric:function(obj){return!jQuery.isArray(obj) && obj - parseFloat(obj) + 1 >= 0}, isPlainObject:function(obj){if (jQuery.type(obj) !== "object" || obj.nodeType || jQuery.isWindow(obj)){return false}if (obj.constructor && !hasOwn.call(obj.constructor.prototype, "isPrototypeOf")){return false}return true}, isEmptyObject:function(obj){var name; for (name in obj){return false}return true}, type:function(obj){if (obj == null){return obj + ""}return typeof obj === "object" || typeof obj === "function"?class2type[toString.call(obj)] || "object":typeof obj}, globalEval:function(code){var script, indirect = eval; code = jQuery.trim(code); if (code){if (code.indexOf("use strict") === 1){script = document.createElement("script"); script.text = code; document.head.appendChild(script).parentNode.removeChild(script)} else{indirect(code)}}}, camelCase:function(string){return string.replace(rmsPrefix, "ms-").replace(rdashAlpha, fcamelCase)}, nodeName:function(elem, name){return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase()}, each:function(obj, callback, args){var value, i = 0, length = obj.length, isArray = isArraylike(obj); if (args){if (isArray){for (; i < length; i++){value = callback.apply(obj[i], args); if (value === false){break}}} else{for (i in obj){value = callback.apply(obj[i], args); if (value === false){break}}}} else{if (isArray){for (; i < length; i++){value = callback.call(obj[i], i, obj[i]); if (value === false){break}}} else{for (i in obj){value = callback.call(obj[i], i, obj[i]); if (value === false){break}}}}return obj}, trim:function(text){return text == null?"":(text + "").replace(rtrim, "")}, makeArray:function(arr, results){var ret = results || []; if (arr != null){if (isArraylike(Object(arr))){jQuery.merge(ret, typeof arr === "string"?[arr]:arr)} else{push.call(ret, arr)}}return ret}, inArray:function(elem, arr, i){return arr == null? - 1:indexOf.call(arr, elem, i)}, merge:function(first, second){var len = + second.length, j = 0, i = first.length; for (; j < len; j++){first[i++] = second[j]}first.length = i; return first}, grep:function(elems, callback, invert){var callbackInverse, matches = [], i = 0, length = elems.length, callbackExpect = !invert; for (; i < length; i++){callbackInverse = !callback(elems[i], i); if (callbackInverse !== callbackExpect){matches.push(elems[i])}}return matches}, map:function(elems, callback, arg){var value, i = 0, length = elems.length, isArray = isArraylike(elems), ret = []; if (isArray){for (; i < length; i++){value = callback(elems[i], i, arg); if (value != null){ret.push(value)}}} else{for (i in elems){value = callback(elems[i], i, arg); if (value != null){ret.push(value)}}}return concat.apply([], ret)}, guid:1, proxy:function(fn, context){var tmp, args, proxy; if (typeof context === "string"){tmp = fn[context]; context = fn; fn = tmp}if (!jQuery.isFunction(fn)){return undefined}args = slice.call(arguments, 2); proxy = function(){return fn.apply(context || this, args.concat(slice.call(arguments)))}; proxy.guid = fn.guid = fn.guid || jQuery.guid++; return proxy}, now:Date.now, support:support}); jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name){class2type["[object " + name + "]"] = name.toLowerCase()}); function isArraylike(obj){var length = obj.length, type = jQuery.type(obj); if (type === "function" || jQuery.isWindow(obj)){return false}if (obj.nodeType === 1 && length){return true}return type === "array" || length === 0 || typeof length === "number" && length > 0 && length - 1 in obj}var Sizzle = function(window){var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains, expando = "sizzle" + 1 * new Date, preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function(a, b){if (a === b){hasDuplicate = true}return 0}, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf = function(list, elem){var i = 0, len = list.length; for (; i < len; i++){if (list[i] === elem){return i}}return - 1}, booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", whitespace = "[\\x20\\t\\r\\n\\f]", characterEncoding = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", identifier = characterEncoding.replace("w", "w#"), attributes = "\\[" + whitespace + "*(" + characterEncoding + ")(?:" + whitespace + "*([*^$|!~]?=)" + whitespace + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + identifier + "))|)" + whitespace + "*\\]", pseudos = ":(" + characterEncoding + ")(?:\\((" + "('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" + "((?:\\\\.|[^\\\\()[\\]]|" + attributes + ")*)|" + ".*" + ")\\)|)", rwhitespace = new RegExp(whitespace + "+", "g"), rtrim = new RegExp("^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g"), rcomma = new RegExp("^" + whitespace + "*," + whitespace + "*"), rcombinators = new RegExp("^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*"), rattributeQuotes = new RegExp("=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g"), rpseudo = new RegExp(pseudos), ridentifier = new RegExp("^" + identifier + "$"), matchExpr = {ID:new RegExp("^#(" + characterEncoding + ")"), CLASS:new RegExp("^\\.(" + characterEncoding + ")"), TAG:new RegExp("^(" + characterEncoding.replace("w", "w*") + ")"), ATTR:new RegExp("^" + attributes), PSEUDO:new RegExp("^" + pseudos), CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace + "*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace + "*(\\d+)|))" + whitespace + "*\\)|)", "i"), bool:new RegExp("^(?:" + booleans + ")$", "i"), needsContext:new RegExp("^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i")}, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\d$/i, rnative = /^[^{]+\{\s*\[native \w/, rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\/g, runescape = new RegExp("\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig"), funescape = function(_, escaped, escapedWhitespace){var high = "0x" + escaped - 65536; return high !== high || escapedWhitespace?escaped:high < 0?String.fromCharCode(high + 65536):String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320)}, unloadHandler = function(){setDocument()}; try{push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes); arr[preferredDoc.childNodes.length].nodeType} catch (e){push = {apply:arr.length?function(target, els){push_native.apply(target, slice.call(els))}:function(target, els){var j = target.length, i = 0; while (target[j++] = els[i++]){}target.length = j - 1}}}function Sizzle(selector, context, results, seed){var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector; if ((context?context.ownerDocument || context:preferredDoc) !== document){setDocument(context)}context = context || document; results = results || []; nodeType = context.nodeType; if (typeof selector !== "string" || !selector || nodeType !== 1 && nodeType !== 9 && nodeType !== 11){return results}if (!seed && documentIsHTML){if (nodeType !== 11 && (match = rquickExpr.exec(selector))){if (m = match[1]){if (nodeType === 9){elem = context.getElementById(m); if (elem && elem.parentNode){if (elem.id === m){results.push(elem); return results}} else{return results}} else{if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains(context, elem) && elem.id === m){results.push(elem); return results}}} else if (match[2]){push.apply(results, context.getElementsByTagName(selector)); return results} else if ((m = match[3]) && support.getElementsByClassName){push.apply(results, context.getElementsByClassName(m)); return results}}if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))){nid = old = expando; newContext = context; newSelector = nodeType !== 1 && selector; if (nodeType === 1 && context.nodeName.toLowerCase() !== "object"){groups = tokenize(selector); if (old = context.getAttribute("id")){nid = old.replace(rescape, "\\$&")} else{context.setAttribute("id", nid)}nid = "[id='" + nid + "'] "; i = groups.length; while (i--){groups[i] = nid + toSelector(groups[i])}newContext = rsibling.test(selector) && testContext(context.parentNode) || context; newSelector = groups.join(",")}if (newSelector){try{push.apply(results, newContext.querySelectorAll(newSelector)); return results} catch (qsaError){} finally{if (!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim, "$1"), context, results, seed)}function createCache(){var keys = []; function cache(key, value){if (keys.push(key + " ") > Expr.cacheLength){delete cache[keys.shift()]}return cache[key + " "] = value}return cache}function markFunction(fn){fn[expando] = true; return fn}function assert(fn){var div = document.createElement("div"); try{return!!fn(div)} catch (e){return false} finally{if (div.parentNode){div.parentNode.removeChild(div)}div = null}}function addHandle(attrs, handler){var arr = attrs.split("|"), i = attrs.length; while (i--){Expr.attrHandle[arr[i]] = handler}}function siblingCheck(a, b){var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE); if (diff){return diff}if (cur){while (cur = cur.nextSibling){if (cur === b){return - 1}}}return a?1: - 1}function createInputPseudo(type){return function(elem){var name = elem.nodeName.toLowerCase(); return name === "input" && elem.type === type}}function createButtonPseudo(type){return function(elem){var name = elem.nodeName.toLowerCase(); return(name === "input" || name === "button") && elem.type === type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument = + argument; return markFunction(function(seed, matches){var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length; while (i--){if (seed[j = matchIndexes[i]]){seed[j] = !(matches[j] = seed[j])}}})})}function testContext(context){return context && typeof context.getElementsByTagName !== "undefined" && context}support = Sizzle.support = {}; isXML = Sizzle.isXML = function(elem){var documentElement = elem && (elem.ownerDocument || elem).documentElement; return documentElement?documentElement.nodeName !== "HTML":false}; setDocument = Sizzle.setDocument = function(node){var hasCompare, parent, doc = node?node.ownerDocument || node:preferredDoc; if (doc === document || doc.nodeType !== 9 || !doc.documentElement){return document}document = doc; docElem = doc.documentElement; parent = doc.defaultView; if (parent && parent !== parent.top){if (parent.addEventListener){parent.addEventListener("unload", unloadHandler, false)} else if (parent.attachEvent){parent.attachEvent("onunload", unloadHandler)}}documentIsHTML = !isXML(doc); support.attributes = assert(function(div){div.className = "i"; return!div.getAttribute("className")}); support.getElementsByTagName = assert(function(div){div.appendChild(doc.createComment("")); return!div.getElementsByTagName("*").length}); support.getElementsByClassName = rnative.test(doc.getElementsByClassName); support.getById = assert(function(div){docElem.appendChild(div).id = expando; return!doc.getElementsByName || !doc.getElementsByName(expando).length}); if (support.getById){Expr.find["ID"] = function(id, context){if (typeof context.getElementById !== "undefined" && documentIsHTML){var m = context.getElementById(id); return m && m.parentNode?[m]:[]}}; Expr.filter["ID"] = function(id){var attrId = id.replace(runescape, funescape); return function(elem){return elem.getAttribute("id") === attrId}}} else{delete Expr.find["ID"]; Expr.filter["ID"] = function(id){var attrId = id.replace(runescape, funescape); return function(elem){var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id"); return node && node.value === attrId}}}Expr.find["TAG"] = support.getElementsByTagName?function(tag, context){if (typeof context.getElementsByTagName !== "undefined"){return context.getElementsByTagName(tag)} else if (support.qsa){return context.querySelectorAll(tag)}}:function(tag, context){var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag); if (tag === "*"){while (elem = results[i++]){if (elem.nodeType === 1){tmp.push(elem)}}return tmp}return results}; Expr.find["CLASS"] = support.getElementsByClassName && function(className, context){if (documentIsHTML){return context.getElementsByClassName(className)}}; rbuggyMatches = []; rbuggyQSA = []; if (support.qsa = rnative.test(doc.querySelectorAll)){assert(function(div){docElem.appendChild(div).innerHTML = "<a id='" + expando + "'></a>" + "<select id='" + expando + "-\f]' msallowcapture=''>" + "<option selected=''></option></select>"; if (div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]=" + whitespace + "*(?:''|\"\")")}if (!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\[" + whitespace + "*(?:value|" + booleans + ")")}if (!div.querySelectorAll("[id~=" + expando + "-]").length){rbuggyQSA.push("~=")}if (!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if (!div.querySelectorAll("a#" + expando + "+*").length){rbuggyQSA.push(".#.+[+~]")}}); assert(function(div){var input = doc.createElement("input"); input.setAttribute("type", "hidden"); div.appendChild(input).setAttribute("name", "D"); if (div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name" + whitespace + "*[*^$|!~]?=")}if (!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled", ":disabled")}div.querySelectorAll("*,:x"); rbuggyQSA.push(",.*:")})}if (support.matchesSelector = rnative.test(matches = docElem.matches || docElem.webkitMatchesSelector || docElem.mozMatchesSelector || docElem.oMatchesSelector || docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch = matches.call(div, "div"); matches.call(div, "[s!='']:x"); rbuggyMatches.push("!=", pseudos)})}rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join("|")); rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join("|")); hasCompare = rnative.test(docElem.compareDocumentPosition); contains = hasCompare || rnative.test(docElem.contains)?function(a, b){var adown = a.nodeType === 9?a.documentElement:a, bup = b && b.parentNode; return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains?adown.contains(bup):a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16))}:function(a, b){if (b){while (b = b.parentNode){if (b === a){return true}}}return false}; sortOrder = hasCompare?function(a, b){if (a === b){hasDuplicate = true; return 0}var compare = !a.compareDocumentPosition - !b.compareDocumentPosition; if (compare){return compare}compare = (a.ownerDocument || a) === (b.ownerDocument || b)?a.compareDocumentPosition(b):1; if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare){if (a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a)){return - 1}if (b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b)){return 1}return sortInput?indexOf(sortInput, a) - indexOf(sortInput, b):0}return compare & 4? - 1:1}:function(a, b){if (a === b){hasDuplicate = true; return 0}var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b]; if (!aup || !bup){return a === doc? - 1:b === doc?1:aup? - 1:bup?1:sortInput?indexOf(sortInput, a) - indexOf(sortInput, b):0} else if (aup === bup){return siblingCheck(a, b)}cur = a; while (cur = cur.parentNode){ap.unshift(cur)}cur = b; while (cur = cur.parentNode){bp.unshift(cur)}while (ap[i] === bp[i]){i++}return i?siblingCheck(ap[i], bp[i]):ap[i] === preferredDoc? - 1:bp[i] === preferredDoc?1:0}; return doc}; Sizzle.matches = function(expr, elements){return Sizzle(expr, null, null, elements)}; Sizzle.matchesSelector = function(elem, expr){if ((elem.ownerDocument || elem) !== document){setDocument(elem)}expr = expr.replace(rattributeQuotes, "='$1']"); if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))){try{var ret = matches.call(elem, expr); if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11){return ret}} catch (e){}}return Sizzle(expr, document, null, [elem]).length > 0}; Sizzle.contains = function(context, elem){if ((context.ownerDocument || context) !== document){setDocument(context)}return contains(context, elem)}; Sizzle.attr = function(elem, name){if ((elem.ownerDocument || elem) !== document){setDocument(elem)}var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase())?fn(elem, name, !documentIsHTML):undefined; return val !== undefined?val:support.attributes || !documentIsHTML?elem.getAttribute(name):(val = elem.getAttributeNode(name)) && val.specified?val.value:null}; Sizzle.error = function(msg){throw new Error("Syntax error, unrecognized expression: " + msg)}; Sizzle.uniqueSort = function(results){var elem, duplicates = [], j = 0, i = 0; hasDuplicate = !support.detectDuplicates; sortInput = !support.sortStable && results.slice(0); results.sort(sortOrder); if (hasDuplicate){while (elem = results[i++]){if (elem === results[i]){j = duplicates.push(i)}}while (j--){results.splice(duplicates[j], 1)}}sortInput = null; return results}; getText = Sizzle.getText = function(elem){var node, ret = "", i = 0, nodeType = elem.nodeType; if (!nodeType){while (node = elem[i++]){ret += getText(node)}} else if (nodeType === 1 || nodeType === 9 || nodeType === 11){if (typeof elem.textContent === "string"){return elem.textContent} else{for (elem = elem.firstChild; elem; elem = elem.nextSibling){ret += getText(elem)}}} else if (nodeType === 3 || nodeType === 4){return elem.nodeValue}return ret}; Expr = Sizzle.selectors = {cacheLength:50, createPseudo:markFunction, match:matchExpr, attrHandle:{}, find:{}, relative:{">":{dir:"parentNode", first:true}, " ":{dir:"parentNode"}, "+":{dir:"previousSibling", first:true}, "~":{dir:"previousSibling"}}, preFilter:{ATTR:function(match){match[1] = match[1].replace(runescape, funescape); match[3] = (match[3] || match[4] || match[5] || "").replace(runescape, funescape); if (match[2] === "~="){match[3] = " " + match[3] + " "}return match.slice(0, 4)}, CHILD:function(match){match[1] = match[1].toLowerCase(); if (match[1].slice(0, 3) === "nth"){if (!match[3]){Sizzle.error(match[0])}match[4] = + (match[4]?match[5] + (match[6] || 1):2 * (match[3] === "even" || match[3] === "odd")); match[5] = + (match[7] + match[8] || match[3] === "odd")} else if (match[3]){Sizzle.error(match[0])}return match}, PSEUDO:function(match){var excess, unquoted = !match[6] && match[2]; if (matchExpr["CHILD"].test(match[0])){return null}if (match[3]){match[2] = match[4] || match[5] || ""} else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(")", unquoted.length - excess) - unquoted.length)){match[0] = match[0].slice(0, excess); match[2] = unquoted.slice(0, excess)}return match.slice(0, 3)}}, filter:{TAG:function(nodeNameSelector){var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase(); return nodeNameSelector === "*"?function(){return true}:function(elem){return elem.nodeName && elem.nodeName.toLowerCase() === nodeName}}, CLASS:function(className){var pattern = classCache[className + " "]; return pattern || (pattern = new RegExp("(^|" + whitespace + ")" + className + "(" + whitespace + "|$)")) && classCache(className, function(elem){return pattern.test(typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== "undefined" && elem.getAttribute("class") || "")})}, ATTR:function(name, operator, check){return function(elem){var result = Sizzle.attr(elem, name); if (result == null){return operator === "!="}if (!operator){return true}result += ""; return operator === "="?result === check:operator === "!="?result !== check:operator === "^="?check && result.indexOf(check) === 0:operator === "*="?check && result.indexOf(check) > - 1:operator === "$="?check && result.slice( - check.length) === check:operator === "~="?(" " + result.replace(rwhitespace, " ") + " ").indexOf(check) > - 1:operator === "|="?result === check || result.slice(0, check.length + 1) === check + "-":false}}, CHILD:function(type, what, argument, first, last){var simple = type.slice(0, 3) !== "nth", forward = type.slice( - 4) !== "last", ofType = what === "of-type"; return first === 1 && last === 0?function(elem){return!!elem.parentNode}:function(elem, context, xml){var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward?"nextSibling":"previousSibling", parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType; if (parent){if (simple){while (dir){node = elem; while (node = node[dir]){if (ofType?node.nodeName.toLowerCase() === name:node.nodeType === 1){return false}}start = dir = type === "only" && !start && "nextSibling"}return true}start = [forward?parent.firstChild:parent.lastChild]; if (forward && useCache){outerCache = parent[expando] || (parent[expando] = {}); cache = outerCache[type] || []; nodeIndex = cache[0] === dirruns && cache[1]; diff = cache[0] === dirruns && cache[2]; node = nodeIndex && parent.childNodes[nodeIndex]; while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()){if (node.nodeType === 1 && ++diff && node === elem){outerCache[type] = [dirruns, nodeIndex, diff]; break}}} else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns){diff = cache[1]} else{while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()){if ((ofType?node.nodeName.toLowerCase() === name:node.nodeType === 1) && ++diff){if (useCache){(node[expando] || (node[expando] = {}))[type] = [dirruns, diff]}if (node === elem){break}}}}diff -= last; return diff === first || diff % first === 0 && diff / first >= 0}}}, PSEUDO:function(pseudo, argument){var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error("unsupported pseudo: " + pseudo); if (fn[expando]){return fn(argument)}if (fn.length > 1){args = [pseudo, pseudo, "", argument]; return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed, matches){var idx, matched = fn(seed, argument), i = matched.length; while (i--){idx = indexOf(seed, matched[i]); seed[idx] = !(matches[idx] = matched[i])}}):function(elem){return fn(elem, 0, args)}}return fn}}, pseudos:{not:markFunction(function(selector){var input = [], results = [], matcher = compile(selector.replace(rtrim, "$1")); return matcher[expando]?markFunction(function(seed, matches, context, xml){var elem, unmatched = matcher(seed, null, xml, []), i = seed.length; while (i--){if (elem = unmatched[i]){seed[i] = !(matches[i] = elem)}}}):function(elem, context, xml){input[0] = elem; matcher(input, null, xml, results); input[0] = null; return!results.pop()}}), has:markFunction(function(selector){return function(elem){return Sizzle(selector, elem).length > 0}}), contains:markFunction(function(text){text = text.replace(runescape, funescape); return function(elem){return(elem.textContent || elem.innerText || getText(elem)).indexOf(text) > - 1}}), lang:markFunction(function(lang){if (!ridentifier.test(lang || "")){Sizzle.error("unsupported lang: " + lang)}lang = lang.replace(runescape, funescape).toLowerCase(); return function(elem){var elemLang; do{if (elemLang = documentIsHTML?elem.lang:elem.getAttribute("xml:lang") || elem.getAttribute("lang")){elemLang = elemLang.toLowerCase(); return elemLang === lang || elemLang.indexOf(lang + "-") === 0}}while ((elem = elem.parentNode) && elem.nodeType === 1); return false}}), target:function(elem){var hash = window.location && window.location.hash; return hash && hash.slice(1) === elem.id}, root:function(elem){return elem === docElem}, focus:function(elem){return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex)}, enabled:function(elem){return elem.disabled === false}, disabled:function(elem){return elem.disabled === true}, checked:function(elem){var nodeName = elem.nodeName.toLowerCase(); return nodeName === "input" && !!elem.checked || nodeName === "option" && !!elem.selected}, selected:function(elem){if (elem.parentNode){elem.parentNode.selectedIndex}return elem.selected === true}, empty:function(elem){for (elem = elem.firstChild; elem; elem = elem.nextSibling){if (elem.nodeType < 6){return false}}return true}, parent:function(elem){return!Expr.pseudos["empty"](elem)}, header:function(elem){return rheader.test(elem.nodeName)}, input:function(elem){return rinputs.test(elem.nodeName)}, button:function(elem){var name = elem.nodeName.toLowerCase(); return name === "input" && elem.type === "button" || name === "button"}, text:function(elem){var attr; return elem.nodeName.toLowerCase() === "input" && elem.type === "text" && ((attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text")}, first:createPositionalPseudo(function(){return[0]}), last:createPositionalPseudo(function(matchIndexes, length){return[length - 1]}), eq:createPositionalPseudo(function(matchIndexes, length, argument){return[argument < 0?argument + length:argument]}), even:createPositionalPseudo(function(matchIndexes, length){var i = 0; for (; i < length; i += 2){matchIndexes.push(i)}return matchIndexes}), odd:createPositionalPseudo(function(matchIndexes, length){var i = 1; for (; i < length; i += 2){matchIndexes.push(i)}return matchIndexes}), lt:createPositionalPseudo(function(matchIndexes, length, argument){var i = argument < 0?argument + length:argument; for (; --i >= 0; ){matchIndexes.push(i)}return matchIndexes}), gt:createPositionalPseudo(function(matchIndexes, length, argument){var i = argument < 0?argument + length:argument; for (; ++i < length; ){matchIndexes.push(i)}return matchIndexes})}}; Expr.pseudos["nth"] = Expr.pseudos["eq"]; for (i in{radio:true, checkbox:true, file:true, password:true, image:true}){Expr.pseudos[i] = createInputPseudo(i)}for (i in{submit:true, reset:true}){Expr.pseudos[i] = createButtonPseudo(i)}function setFilters(){}setFilters.prototype = Expr.filters = Expr.pseudos; Expr.setFilters = new setFilters; tokenize = Sizzle.tokenize = function(selector, parseOnly){var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + " "]; if (cached){return parseOnly?0:cached.slice(0)}soFar = selector; groups = []; preFilters = Expr.preFilter; while (soFar){if (!matched || (match = rcomma.exec(soFar))){if (match){soFar = soFar.slice(match[0].length) || soFar}groups.push(tokens = [])}matched = false; if (match = rcombinators.exec(soFar)){matched = match.shift(); tokens.push({value:matched, type:match[0].replace(rtrim, " ")}); soFar = soFar.slice(matched.length)}for (type in Expr.filter){if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))){matched = match.shift(); tokens.push({value:matched, type:type, matches:match}); soFar = soFar.slice(matched.length)}}if (!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector, groups).slice(0)}; function toSelector(tokens){var i = 0, len = tokens.length, selector = ""; for (; i < len; i++){selector += tokens[i].value}return selector}function addCombinator(matcher, combinator, base){var dir = combinator.dir, checkNonElements = base && dir === "parentNode", doneName = done++; return combinator.first?function(elem, context, xml){while (elem = elem[dir]){if (elem.nodeType === 1 || checkNonElements){return matcher(elem, context, xml)}}}:function(elem, context, xml){var oldCache, outerCache, newCache = [dirruns, doneName]; if (xml){while (elem = elem[dir]){if (elem.nodeType === 1 || checkNonElements){if (matcher(elem, context, xml)){return true}}}} else{while (elem = elem[dir]){if (elem.nodeType === 1 || checkNonElements){outerCache = elem[expando] || (elem[expando] = {}); if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName){return newCache[2] = oldCache[2]} else{outerCache[dir] = newCache; if (newCache[2] = matcher(elem, context, xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length > 1?function(elem, context, xml){var i = matchers.length; while (i--){if (!matchers[i](elem, context, xml)){return false}}return true}:matchers[0]}function multipleContexts(selector, contexts, results){var i = 0, len = contexts.length; for (; i < len; i++){Sizzle(selector, contexts[i], results)}return results}function condense(unmatched, map, filter, context, xml){var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null; for (; i < len; i++){if (elem = unmatched[i]){if (!filter || filter(elem, context, xml)){newUnmatched.push(elem); if (mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector){if (postFilter && !postFilter[expando]){postFilter = setMatcher(postFilter)}if (postFinder && !postFinder[expando]){postFinder = setMatcher(postFinder, postSelector)}return markFunction(function(seed, results, context, xml){var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || "*", context.nodeType?[context]:context, []), matcherIn = preFilter && (seed || !selector)?condense(elems, preMap, preFilter, context, xml):elems, matcherOut = matcher?postFinder || (seed?preFilter:preexisting || postFilter)?[]:results:matcherIn; if (matcher){matcher(matcherIn, matcherOut, context, xml)}if (postFilter){temp = condense(matcherOut, postMap); postFilter(temp, [], context, xml); i = temp.length; while (i--){if (elem = temp[i]){matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem)}}}if (seed){if (postFinder || preFilter){if (postFinder){temp = []; i = matcherOut.length; while (i--){if (elem = matcherOut[i]){temp.push(matcherIn[i] = elem)}}postFinder(null, matcherOut = [], temp, xml)}i = matcherOut.length; while (i--){if ((elem = matcherOut[i]) && (temp = postFinder?indexOf(seed, elem):preMap[i]) > - 1){seed[temp] = !(results[temp] = elem)}}}} else{matcherOut = condense(matcherOut === results?matcherOut.splice(preexisting, matcherOut.length):matcherOut); if (postFinder){postFinder(null, results, matcherOut, xml)} else{push.apply(results, matcherOut)}}})}function matcherFromTokens(tokens){var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[" "], i = leadingRelative?1:0, matchContext = addCombinator(function(elem){return elem === checkContext}, implicitRelative, true), matchAnyContext = addCombinator(function(elem){return indexOf(checkContext, elem) > - 1}, implicitRelative, true), matchers = [function(elem, context, xml){var ret = !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType?matchContext(elem, context, xml):matchAnyContext(elem, context, xml)); checkContext = null; return ret}]; for (; i < len; i++){if (matcher = Expr.relative[tokens[i].type]){matchers = [addCombinator(elementMatcher(matchers), matcher)]} else{matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches); if (matcher[expando]){j = ++i; for (; j < len; j++){if (Expr.relative[tokens[j].type]){break}}return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({value:tokens[i - 2].type === " "?"*":""})).replace(rtrim, "$1"), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers, setMatchers){var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function(seed, context, xml, results, outermost){var elem, j, matcher, matchedCount = 0, i = "0", unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find["TAG"]("*", outermost), dirrunsUnique = dirruns += contextBackup == null?1:Math.random() || .1, len = elems.length; if (outermost){outermostContext = context !== document && context}for (; i !== len && (elem = elems[i]) != null; i++){if (byElement && elem){j = 0; while (matcher = elementMatchers[j++]){if (matcher(elem, context, xml)){results.push(elem); break}}if (outermost){dirruns = dirrunsUnique}}if (bySet){if (elem = !matcher && elem){matchedCount--}if (seed){unmatched.push(elem)}}}matchedCount += i; if (bySet && i !== matchedCount){j = 0; while (matcher = setMatchers[j++]){matcher(unmatched, setMatched, context, xml)}if (seed){if (matchedCount > 0){while (i--){if (!(unmatched[i] || setMatched[i])){setMatched[i] = pop.call(results)}}}setMatched = condense(setMatched)}push.apply(results, setMatched); if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1){Sizzle.uniqueSort(results)}}if (outermost){dirruns = dirrunsUnique; outermostContext = contextBackup}return unmatched}; return bySet?markFunction(superMatcher):superMatcher}compile = Sizzle.compile = function(selector, match){var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + " "]; if (!cached){if (!match){match = tokenize(selector)}i = match.length; while (i--){cached = matcherFromTokens(match[i]); if (cached[expando]){setMatchers.push(cached)} else{elementMatchers.push(cached)}}cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers)); cached.selector = selector}return cached}; select = Sizzle.select = function(selector, context, results, seed){var i, tokens, token, type, find, compiled = typeof selector === "function" && selector, match = !seed && tokenize(selector = compiled.selector || selector); results = results || []; if (match.length === 1){tokens = match[0] = match[0].slice(0); if (tokens.length > 2 && (token = tokens[0]).type === "ID" && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]){context = (Expr.find["ID"](token.matches[0].replace(runescape, funescape), context) || [])[0]; if (!context){return results} else if (compiled){context = context.parentNode}selector = selector.slice(tokens.shift().value.length)}i = matchExpr["needsContext"].test(selector)?0:tokens.length; while (i--){token = tokens[i]; if (Expr.relative[type = token.type]){break}if (find = Expr.find[type]){if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)){tokens.splice(i, 1); selector = seed.length && toSelector(tokens); if (!selector){push.apply(results, seed); return results}break}}}}(compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context); return results}; support.sortStable = expando.split("").sort(sortOrder).join("") === expando; support.detectDuplicates = !!hasDuplicate; setDocument(); support.sortDetached = assert(function(div1){return div1.compareDocumentPosition(document.createElement("div")) & 1}); if (!assert(function(div){div.innerHTML = "<a href='#'></a>"; return div.firstChild.getAttribute("href") === "#"})){addHandle("type|href|height|width", function(elem, name, isXML){if (!isXML){return elem.getAttribute(name, name.toLowerCase() === "type"?1:2)}})}if (!support.attributes || !assert(function(div){div.innerHTML = "<input/>"; div.firstChild.setAttribute("value", ""); return div.firstChild.getAttribute("value") === ""})){addHandle("value", function(elem, name, isXML){if (!isXML && elem.nodeName.toLowerCase() === "input"){return elem.defaultValue}})}if (!assert(function(div){return div.getAttribute("disabled") == null})){addHandle(booleans, function(elem, name, isXML){var val; if (!isXML){return elem[name] === true?name.toLowerCase():(val = elem.getAttributeNode(name)) && val.specified?val.value:null}})}return Sizzle}(window); jQuery.find = Sizzle; jQuery.expr = Sizzle.selectors; jQuery.expr[":"] = jQuery.expr.pseudos; jQuery.unique = Sizzle.uniqueSort; jQuery.text = Sizzle.getText; jQuery.isXMLDoc = Sizzle.isXML; jQuery.contains = Sizzle.contains; var rneedsContext = jQuery.expr.match.needsContext; var rsingleTag = /^<(\w+)\s*\/?>(?:<\/\1>|)$/; var risSimple = /^.[^:#\[\.,]*$/; function winnow(elements, qualifier, not){if (jQuery.isFunction(qualifier)){return jQuery.grep(elements, function(elem, i){return!!qualifier.call(elem, i, elem) !== not})}if (qualifier.nodeType){return jQuery.grep(elements, function(elem){return elem === qualifier !== not})}if (typeof qualifier === "string"){if (risSimple.test(qualifier)){return jQuery.filter(qualifier, elements, not)}qualifier = jQuery.filter(qualifier, elements)}return jQuery.grep(elements, function(elem){return indexOf.call(qualifier, elem) >= 0 !== not})}jQuery.filter = function(expr, elems, not){var elem = elems[0]; if (not){expr = ":not(" + expr + ")"}return elems.length === 1 && elem.nodeType === 1?jQuery.find.matchesSelector(elem, expr)?[elem]:[]:jQuery.find.matches(expr, jQuery.grep(elems, function(elem){return elem.nodeType === 1}))}; jQuery.fn.extend({find:function(selector){var i, len = this.length, ret = [], self = this; if (typeof selector !== "string"){return this.pushStack(jQuery(selector).filter(function(){for (i = 0; i < len; i++){if (jQuery.contains(self[i], this)){return true}}}))}for (i = 0; i < len; i++){jQuery.find(selector, self[i], ret)}ret = this.pushStack(len > 1?jQuery.unique(ret):ret); ret.selector = this.selector?this.selector + " " + selector:selector; return ret}, filter:function(selector){return this.pushStack(winnow(this, selector || [], false))}, not:function(selector){return this.pushStack(winnow(this, selector || [], true))}, is:function(selector){return!!winnow(this, typeof selector === "string" && rneedsContext.test(selector)?jQuery(selector):selector || [], false).length}}); var rootjQuery, rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, init = jQuery.fn.init = function(selector, context){var match, elem; if (!selector){return this}if (typeof selector === "string"){if (selector[0] === "<" && selector[selector.length - 1] === ">" && selector.length >= 3){match = [null, selector, null]} else{match = rquickExpr.exec(selector)}if (match && (match[1] || !context)){if (match[1]){context = context instanceof jQuery?context[0]:context; jQuery.merge(this, jQuery.parseHTML(match[1], context && context.nodeType?context.ownerDocument || context:document, true)); if (rsingleTag.test(match[1]) && jQuery.isPlainObject(context)){for (match in context){if (jQuery.isFunction(this[match])){this[match](context[match])} else{this.attr(match, context[match])}}}return this} else{elem = document.getElementById(match[2]); if (elem && elem.parentNode){this.length = 1; this[0] = elem}this.context = document; this.selector = selector; return this}} else if (!context || context.jquery){return(context || rootjQuery).find(selector)} else{return this.constructor(context).find(selector)}} else if (selector.nodeType){this.context = this[0] = selector; this.length = 1; return this} else if (jQuery.isFunction(selector)){return typeof rootjQuery.ready !== "undefined"?rootjQuery.ready(selector):selector(jQuery)}if (selector.selector !== undefined){this.selector = selector.selector; this.context = selector.context}return jQuery.makeArray(selector, this)}; init.prototype = jQuery.fn; rootjQuery = jQuery(document); var rparentsprev = /^(?:parents|prev(?:Until|All))/, guaranteedUnique = {children:true, contents:true, next:true, prev:true}; jQuery.extend({dir:function(elem, dir, until){var matched = [], truncate = until !== undefined; while ((elem = elem[dir]) && elem.nodeType !== 9){if (elem.nodeType === 1){if (truncate && jQuery(elem).is(until)){break}matched.push(elem)}}return matched}, sibling:function(n, elem){var matched = []; for (; n; n = n.nextSibling){if (n.nodeType === 1 && n !== elem){matched.push(n)}}return matched}}); jQuery.fn.extend({has:function(target){var targets = jQuery(target, this), l = targets.length; return this.filter(function(){var i = 0; for (; i < l; i++){if (jQuery.contains(this, targets[i])){return true}}})}, closest:function(selectors, context){var cur, i = 0, l = this.length, matched = [], pos = rneedsContext.test(selectors) || typeof selectors !== "string"?jQuery(selectors, context || this.context):0; for (; i < l; i++){for (cur = this[i]; cur && cur !== context; cur = cur.parentNode){if (cur.nodeType < 11 && (pos?pos.index(cur) > - 1:cur.nodeType === 1 && jQuery.find.matchesSelector(cur, selectors))){matched.push(cur); break}}}return this.pushStack(matched.length > 1?jQuery.unique(matched):matched)}, index:function(elem){if (!elem){return this[0] && this[0].parentNode?this.first().prevAll().length: - 1}if (typeof elem === "string"){return indexOf.call(jQuery(elem), this[0])}return indexOf.call(this, elem.jquery?elem[0]:elem)}, add:function(selector, context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(), jQuery(selector, context))))}, addBack:function(selector){return this.add(selector == null?this.prevObject:this.prevObject.filter(selector))}}); function sibling(cur, dir){while ((cur = cur[dir]) && cur.nodeType !== 1){}return cur}jQuery.each({parent:function(elem){var parent = elem.parentNode; return parent && parent.nodeType !== 11?parent:null}, parents:function(elem){return jQuery.dir(elem, "parentNode")}, parentsUntil:function(elem, i, until){return jQuery.dir(elem, "parentNode", until)}, next:function(elem){return sibling(elem, "nextSibling")}, prev:function(elem){return sibling(elem, "previousSibling")}, nextAll:function(elem){return jQuery.dir(elem, "nextSibling")}, prevAll:function(elem){return jQuery.dir(elem, "previousSibling")}, nextUntil:function(elem, i, until){return jQuery.dir(elem, "nextSibling", until)}, prevUntil:function(elem, i, until){return jQuery.dir(elem, "previousSibling", until)}, siblings:function(elem){return jQuery.sibling((elem.parentNode || {}).firstChild, elem)}, children:function(elem){return jQuery.sibling(elem.firstChild)}, contents:function(elem){return elem.contentDocument || jQuery.merge([], elem.childNodes)}}, function(name, fn){jQuery.fn[name] = function(until, selector){var matched = jQuery.map(this, fn, until); if (name.slice( - 5) !== "Until"){selector = until}if (selector && typeof selector === "string"){matched = jQuery.filter(selector, matched)}if (this.length > 1){if (!guaranteedUnique[name]){jQuery.unique(matched)}if (rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}}); var rnotwhite = /\S+/g; var optionsCache = {}; function createOptions(options){var object = optionsCache[options] = {}; jQuery.each(options.match(rnotwhite) || [], function(_, flag){object[flag] = true}); return object}jQuery.Callbacks = function(options){options = typeof options === "string"?optionsCache[options] || createOptions(options):jQuery.extend({}, options); var memory, fired, firing, firingStart, firingLength, firingIndex, list = [], stack = !options.once && [], fire = function(data){memory = options.memory && data; fired = true; firingIndex = firingStart || 0; firingStart = 0; firingLength = list.length; firing = true; for (; list && firingIndex < firingLength; firingIndex++){if (list[firingIndex].apply(data[0], data[1]) === false && options.stopOnFalse){memory = false; break}}firing = false; if (list){if (stack){if (stack.length){fire(stack.shift())}} else if (memory){list = []} else{self.disable()}}}, self = {add:function(){if (list){var start = list.length; (function add(args){jQuery.each(args, function(_, arg){var type = jQuery.type(arg); if (type === "function"){if (!options.unique || !self.has(arg)){list.push(arg)}} else if (arg && arg.length && type !== "string"){add(arg)}})})(arguments); if (firing){firingLength = list.length} else if (memory){firingStart = start; fire(memory)}}return this}, remove:function(){if (list){jQuery.each(arguments, function(_, arg){var index; while ((index = jQuery.inArray(arg, list, index)) > - 1){list.splice(index, 1); if (firing){if (index <= firingLength){firingLength--}if (index <= firingIndex){firingIndex--}}}})}return this}, has:function(fn){return fn?jQuery.inArray(fn, list) > - 1:!!(list && list.length)}, empty:function(){list = []; firingLength = 0; return this}, disable:function(){list = stack = memory = undefined; return this}, disabled:function(){return!list}, lock:function(){stack = undefined; if (!memory){self.disable()}return this}, locked:function(){return!stack}, fireWith:function(context, args){if (list && (!fired || stack)){args = args || []; args = [context, args.slice?args.slice():args]; if (firing){stack.push(args)} else{fire(args)}}return this}, fire:function(){self.fireWith(this, arguments); return this}, fired:function(){return!!fired}}; return self}; jQuery.extend({Deferred:function(func){var tuples = [["resolve", "done", jQuery.Callbacks("once memory"), "resolved"], ["reject", "fail", jQuery.Callbacks("once memory"), "rejected"], ["notify", "progress", jQuery.Callbacks("memory")]], state = "pending", promise = {state:function(){return state}, always:function(){deferred.done(arguments).fail(arguments); return this}, then:function(){var fns = arguments; return jQuery.Deferred(function(newDefer){jQuery.each(tuples, function(i, tuple){var fn = jQuery.isFunction(fns[i]) && fns[i]; deferred[tuple[1]](function(){var returned = fn && fn.apply(this, arguments); if (returned && jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)} else{newDefer[tuple[0] + "With"](this === promise?newDefer.promise():this, fn?[returned]:arguments)}})}); fns = null}).promise()}, promise:function(obj){return obj != null?jQuery.extend(obj, promise):promise}}, deferred = {}; promise.pipe = promise.then; jQuery.each(tuples, function(i, tuple){var list = tuple[2], stateString = tuple[3]; promise[tuple[1]] = list.add; if (stateString){list.add(function(){state = stateString}, tuples[i ^ 1][2].disable, tuples[2][2].lock)}deferred[tuple[0]] = function(){deferred[tuple[0] + "With"](this === deferred?promise:this, arguments); return this}; deferred[tuple[0] + "With"] = list.fireWith}); promise.promise(deferred); if (func){func.call(deferred, deferred)}return deferred}, when:function(subordinate){var i = 0, resolveValues = slice.call(arguments), length = resolveValues.length, remaining = length !== 1 || subordinate && jQuery.isFunction(subordinate.promise)?length:0, deferred = remaining === 1?subordinate:jQuery.Deferred(), updateFunc = function(i, contexts, values){return function(value){contexts[i] = this; values[i] = arguments.length > 1?slice.call(arguments):value; if (values === progressValues){deferred.notifyWith(contexts, values)} else if (!--remaining){deferred.resolveWith(contexts, values)}}}, progressValues, progressContexts, resolveContexts; if (length > 1){progressValues = new Array(length); progressContexts = new Array(length); resolveContexts = new Array(length); for (; i < length; i++){if (resolveValues[i] && jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i, resolveContexts, resolveValues)).fail(deferred.reject).progress(updateFunc(i, progressContexts, progressValues))} else{--remaining}}}if (!remaining){deferred.resolveWith(resolveContexts, resolveValues)}return deferred.promise()}}); var readyList; jQuery.fn.ready = function(fn){jQuery.ready.promise().done(fn); return this}; jQuery.extend({isReady:false, readyWait:1, holdReady:function(hold){if (hold){jQuery.readyWait++} else{jQuery.ready(true)}}, ready:function(wait){if (wait === true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady = true; if (wait !== true && --jQuery.readyWait > 0){return}readyList.resolveWith(document, [jQuery]); if (jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready"); jQuery(document).off("ready")}}}); function completed(){document.removeEventListener("DOMContentLoaded", completed, false); window.removeEventListener("load", completed, false); jQuery.ready()}jQuery.ready.promise = function(obj){if (!readyList){readyList = jQuery.Deferred(); if (document.readyState === "complete"){setTimeout(jQuery.ready)} else{document.addEventListener("DOMContentLoaded", completed, false); window.addEventListener("load", completed, false)}}return readyList.promise(obj)}; jQuery.ready.promise(); var access = jQuery.access = function(elems, fn, key, value, chainable, emptyGet, raw){var i = 0, len = elems.length, bulk = key == null; if (jQuery.type(key) === "object"){chainable = true; for (i in key){jQuery.access(elems, fn, i, key[i], true, emptyGet, raw)}} else if (value !== undefined){chainable = true; if (!jQuery.isFunction(value)){raw = true}if (bulk){if (raw){fn.call(elems, value); fn = null} else{bulk = fn; fn = function(elem, key, value){return bulk.call(jQuery(elem), value)}}}if (fn){for (; i < len; i++){fn(elems[i], key, raw?value:value.call(elems[i], i, fn(elems[i], key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0], key):emptyGet}; jQuery.acceptData = function(owner){return owner.nodeType === 1 || owner.nodeType === 9 || ! + owner.nodeType}; function Data(){Object.defineProperty(this.cache = {}, 0, {get:function(){return{}}}); this.expando = jQuery.expando + Data.uid++}Data.uid = 1; Data.accepts = jQuery.acceptData; Data.prototype = {key:function(owner){if (!Data.accepts(owner)){return 0}var descriptor = {}, unlock = owner[this.expando]; if (!unlock){unlock = Data.uid++; try{descriptor[this.expando] = {value:unlock}; Object.defineProperties(owner, descriptor)} catch (e){descriptor[this.expando] = unlock; jQuery.extend(owner, descriptor)}}if (!this.cache[unlock]){this.cache[unlock] = {}}return unlock}, set:function(owner, data, value){var prop, unlock = this.key(owner), cache = this.cache[unlock]; if (typeof data === "string"){cache[data] = value} else{if (jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock], data)} else{for (prop in data){cache[prop] = data[prop]}}}return cache}, get:function(owner, key){var cache = this.cache[this.key(owner)]; return key === undefined?cache:cache[key]}, access:function(owner, key, value){var stored; if (key === undefined || key && typeof key === "string" && value === undefined){stored = this.get(owner, key); return stored !== undefined?stored:this.get(owner, jQuery.camelCase(key))}this.set(owner, key, value); return value !== undefined?value:key}, remove:function(owner, key){var i, name, camel, unlock = this.key(owner), cache = this.cache[unlock]; if (key === undefined){this.cache[unlock] = {}} else{if (jQuery.isArray(key)){name = key.concat(key.map(jQuery.camelCase))} else{camel = jQuery.camelCase(key); if (key in cache){name = [key, camel]} else{name = camel; name = name in cache?[name]:name.match(rnotwhite) || []}}i = name.length; while (i--){delete cache[name[i]]}}}, hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]] || {})}, discard:function(owner){if (owner[this.expando]){delete this.cache[owner[this.expando]]}}}; var data_priv = new Data; var data_user = new Data; var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, rmultiDash = /([A-Z])/g; function dataAttr(elem, key, data){var name; if (data === undefined && elem.nodeType === 1){name = "data-" + key.replace(rmultiDash, "-$1").toLowerCase(); data = elem.getAttribute(name); if (typeof data === "string"){try{data = data === "true"?true:data === "false"?false:data === "null"?null: + data + "" === data? + data:rbrace.test(data)?jQuery.parseJSON(data):data} catch (e){}data_user.set(elem, key, data)} else{data = undefined}}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem) || data_priv.hasData(elem)}, data:function(elem, name, data){return data_user.access(elem, name, data)}, removeData:function(elem, name){data_user.remove(elem, name)}, _data:function(elem, name, data){return data_priv.access(elem, name, data)}, _removeData:function(elem, name){data_priv.remove(elem, name)}}); jQuery.fn.extend({data:function(key, value){var i, name, data, elem = this[0], attrs = elem && elem.attributes; if (key === undefined){if (this.length){data = data_user.get(elem); if (elem.nodeType === 1 && !data_priv.get(elem, "hasDataAttrs")){i = attrs.length; while (i--){if (attrs[i]){name = attrs[i].name; if (name.indexOf("data-") === 0){name = jQuery.camelCase(name.slice(5)); dataAttr(elem, name, data[name])}}}data_priv.set(elem, "hasDataAttrs", true)}}return data}if (typeof key === "object"){return this.each(function(){data_user.set(this, key)})}return access(this, function(value){var data, camelKey = jQuery.camelCase(key); if (elem && value === undefined){data = data_user.get(elem, key); if (data !== undefined){return data}data = data_user.get(elem, camelKey); if (data !== undefined){return data}data = dataAttr(elem, camelKey, undefined); if (data !== undefined){return data}return}this.each(function(){var data = data_user.get(this, camelKey); data_user.set(this, camelKey, value); if (key.indexOf("-") !== - 1 && data !== undefined){data_user.set(this, key, value)}})}, null, value, arguments.length > 1, null, true)}, removeData:function(key){return this.each(function(){data_user.remove(this, key)})}}); jQuery.extend({queue:function(elem, type, data){var queue; if (elem){type = (type || "fx") + "queue"; queue = data_priv.get(elem, type); if (data){if (!queue || jQuery.isArray(data)){queue = data_priv.access(elem, type, jQuery.makeArray(data))} else{queue.push(data)}}return queue || []}}, dequeue:function(elem, type){type = type || "fx"; var queue = jQuery.queue(elem, type), startLength = queue.length, fn = queue.shift(), hooks = jQuery._queueHooks(elem, type), next = function(){jQuery.dequeue(elem, type)}; if (fn === "inprogress"){fn = queue.shift(); startLength--}if (fn){if (type === "fx"){queue.unshift("inprogress")}delete hooks.stop; fn.call(elem, next, hooks)}if (!startLength && hooks){hooks.empty.fire()}}, _queueHooks:function(elem, type){var key = type + "queueHooks"; return data_priv.get(elem, key) || data_priv.access(elem, key, {empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem, [type + "queue", key])})})}}); jQuery.fn.extend({queue:function(type, data){var setter = 2; if (typeof type !== "string"){data = type; type = "fx"; setter--}if (arguments.length < setter){return jQuery.queue(this[0], type)}return data === undefined?this:this.each(function(){var queue = jQuery.queue(this, type, data); jQuery._queueHooks(this, type); if (type === "fx" && queue[0] !== "inprogress"){jQuery.dequeue(this, type)}})}, dequeue:function(type){return this.each(function(){jQuery.dequeue(this, type)})}, clearQueue:function(type){return this.queue(type || "fx", [])}, promise:function(type, obj){var tmp, count = 1, defer = jQuery.Deferred(), elements = this, i = this.length, resolve = function(){if (!--count){defer.resolveWith(elements, [elements])}}; if (typeof type !== "string"){obj = type; type = undefined}type = type || "fx"; while (i--){tmp = data_priv.get(elements[i], type + "queueHooks"); if (tmp && tmp.empty){count++; tmp.empty.add(resolve)}}resolve(); return defer.promise(obj)}}); var pnum = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source; var cssExpand = ["Top", "Right", "Bottom", "Left"]; var isHidden = function(elem, el){elem = el || elem; return jQuery.css(elem, "display") === "none" || !jQuery.contains(elem.ownerDocument, elem)}; var rcheckableType = /^(?:checkbox|radio)$/i; (function(){var fragment = document.createDocumentFragment(), div = fragment.appendChild(document.createElement("div")), input = document.createElement("input"); input.setAttribute("type", "radio"); input.setAttribute("checked", "checked"); input.setAttribute("name", "t"); div.appendChild(input); support.checkClone = div.cloneNode(true).cloneNode(true).lastChild.checked; div.innerHTML = "<textarea>x</textarea>"; support.noCloneChecked = !!div.cloneNode(true).lastChild.defaultValue})(); var strundefined = typeof undefined; support.focusinBubbles = "onfocusin"in window; var rkeyEvent = /^key/, rmouseEvent = /^(?:mouse|pointer|contextmenu)|click/, rfocusMorph = /^(?:focusinfocus|focusoutblur)$/, rtypenamespace = /^([^.]*)(?:\.(.+)|)$/; function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement} catch (err){}}jQuery.event = {global:{}, add:function(elem, types, handler, data, selector){var handleObjIn, eventHandle, tmp, events, t, handleObj, special, handlers, type, namespaces, origType, elemData = data_priv.get(elem); if (!elemData){return}if (handler.handler){handleObjIn = handler; handler = handleObjIn.handler; selector = handleObjIn.selector}if (!handler.guid){handler.guid = jQuery.guid++}if (!(events = elemData.events)){events = elemData.events = {}}if (!(eventHandle = elemData.handle)){eventHandle = elemData.handle = function(e){return typeof jQuery !== strundefined && jQuery.event.triggered !== e.type?jQuery.event.dispatch.apply(elem, arguments):undefined}}types = (types || "").match(rnotwhite) || [""]; t = types.length; while (t--){tmp = rtypenamespace.exec(types[t]) || []; type = origType = tmp[1]; namespaces = (tmp[2] || "").split(".").sort(); if (!type){continue}special = jQuery.event.special[type] || {}; type = (selector?special.delegateType:special.bindType) || type; special = jQuery.event.special[type] || {}; handleObj = jQuery.extend({type:type, origType:origType, data:data, handler:handler, guid:handler.guid, selector:selector, needsContext:selector && jQuery.expr.match.needsContext.test(selector), namespace:namespaces.join(".")}, handleObjIn); if (!(handlers = events[type])){handlers = events[type] = []; handlers.delegateCount = 0; if (!special.setup || special.setup.call(elem, data, namespaces, eventHandle) === false){if (elem.addEventListener){elem.addEventListener(type, eventHandle, false)}}}if (special.add){special.add.call(elem, handleObj); if (!handleObj.handler.guid){handleObj.handler.guid = handler.guid}}if (selector){handlers.splice(handlers.delegateCount++, 0, handleObj)} else{handlers.push(handleObj)}jQuery.event.global[type] = true}}, remove:function(elem, types, handler, selector, mappedTypes){var j, origCount, tmp, events, t, handleObj, special, handlers, type, namespaces, origType, elemData = data_priv.hasData(elem) && data_priv.get(elem); if (!elemData || !(events = elemData.events)){return}types = (types || "").match(rnotwhite) || [""]; t = types.length; while (t--){tmp = rtypenamespace.exec(types[t]) || []; type = origType = tmp[1]; namespaces = (tmp[2] || "").split(".").sort(); if (!type){for (type in events){jQuery.event.remove(elem, type + types[t], handler, selector, true)}continue}special = jQuery.event.special[type] || {}; type = (selector?special.delegateType:special.bindType) || type; handlers = events[type] || []; tmp = tmp[2] && new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)"); origCount = j = handlers.length; while (j--){handleObj = handlers[j]; if ((mappedTypes || origType === handleObj.origType) && (!handler || handler.guid === handleObj.guid) && (!tmp || tmp.test(handleObj.namespace)) && (!selector || selector === handleObj.selector || selector === "**" && handleObj.selector)){handlers.splice(j, 1); if (handleObj.selector){handlers.delegateCount--}if (special.remove){special.remove.call(elem, handleObj)}}}if (origCount && !handlers.length){if (!special.teardown || special.teardown.call(elem, namespaces, elemData.handle) === false){jQuery.removeEvent(elem, type, elemData.handle)}delete events[type]}}if (jQuery.isEmptyObject(events)){delete elemData.handle; data_priv.remove(elem, "events")}}, trigger:function(event, data, elem, onlyHandlers){var i, cur, tmp, bubbleType, ontype, handle, special, eventPath = [elem || document], type = hasOwn.call(event, "type")?event.type:event, namespaces = hasOwn.call(event, "namespace")?event.namespace.split("."):[]; cur = tmp = elem = elem || document; if (elem.nodeType === 3 || elem.nodeType === 8){return}if (rfocusMorph.test(type + jQuery.event.triggered)){return}if (type.indexOf(".") >= 0){namespaces = type.split("."); type = namespaces.shift(); namespaces.sort()}ontype = type.indexOf(":") < 0 && "on" + type; event = event[jQuery.expando]?event:new jQuery.Event(type, typeof event === "object" && event); event.isTrigger = onlyHandlers?2:3; event.namespace = namespaces.join("."); event.namespace_re = event.namespace?new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)"):null; event.result = undefined; if (!event.target){event.target = elem}data = data == null?[event]:jQuery.makeArray(data, [event]); special = jQuery.event.special[type] || {}; if (!onlyHandlers && special.trigger && special.trigger.apply(elem, data) === false){return}if (!onlyHandlers && !special.noBubble && !jQuery.isWindow(elem)){bubbleType = special.delegateType || type; if (!rfocusMorph.test(bubbleType + type)){cur = cur.parentNode}for (; cur; cur = cur.parentNode){eventPath.push(cur); tmp = cur}if (tmp === (elem.ownerDocument || document)){eventPath.push(tmp.defaultView || tmp.parentWindow || window)}}i = 0; while ((cur = eventPath[i++]) && !event.isPropagationStopped()){event.type = i > 1?bubbleType:special.bindType || type; handle = (data_priv.get(cur, "events") || {})[event.type] && data_priv.get(cur, "handle"); if (handle){handle.apply(cur, data)}handle = ontype && cur[ontype]; if (handle && handle.apply && jQuery.acceptData(cur)){event.result = handle.apply(cur, data); if (event.result === false){event.preventDefault()}}}event.type = type; if (!onlyHandlers && !event.isDefaultPrevented()){if ((!special._default || special._default.apply(eventPath.pop(), data) === false) && jQuery.acceptData(elem)){if (ontype && jQuery.isFunction(elem[type]) && !jQuery.isWindow(elem)){tmp = elem[ontype]; if (tmp){elem[ontype] = null}jQuery.event.triggered = type; elem[type](); jQuery.event.triggered = undefined; if (tmp){elem[ontype] = tmp}}}}return event.result}, dispatch:function(event){event = jQuery.event.fix(event); var i, j, ret, matched, handleObj, handlerQueue = [], args = slice.call(arguments), handlers = (data_priv.get(this, "events") || {})[event.type] || [], special = jQuery.event.special[event.type] || {}; args[0] = event; event.delegateTarget = this; if (special.preDispatch && special.preDispatch.call(this, event) === false){return}handlerQueue = jQuery.event.handlers.call(this, event, handlers); i = 0; while ((matched = handlerQueue[i++]) && !event.isPropagationStopped()){event.currentTarget = matched.elem; j = 0; while ((handleObj = matched.handlers[j++]) && !event.isImmediatePropagationStopped()){if (!event.namespace_re || event.namespace_re.test(handleObj.namespace)){event.handleObj = handleObj; event.data = handleObj.data; ret = ((jQuery.event.special[handleObj.origType] || {}).handle || handleObj.handler).apply(matched.elem, args); if (ret !== undefined){if ((event.result = ret) === false){event.preventDefault(); event.stopPropagation()}}}}}if (special.postDispatch){special.postDispatch.call(this, event)}return event.result}, handlers:function(event, handlers){var i, matches, sel, handleObj, handlerQueue = [], delegateCount = handlers.delegateCount, cur = event.target; if (delegateCount && cur.nodeType && (!event.button || event.type !== "click")){for (; cur !== this; cur = cur.parentNode || this){if (cur.disabled !== true || event.type !== "click"){matches = []; for (i = 0; i < delegateCount; i++){handleObj = handlers[i]; sel = handleObj.selector + " "; if (matches[sel] === undefined){matches[sel] = handleObj.needsContext?jQuery(sel, this).index(cur) >= 0:jQuery.find(sel, this, null, [cur]).length}if (matches[sel]){matches.push(handleObj)}}if (matches.length){handlerQueue.push({elem:cur, handlers:matches})}}}}if (delegateCount < handlers.length){handlerQueue.push({elem:this, handlers:handlers.slice(delegateCount)})}return handlerQueue}, props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks:{}, keyHooks:{props:"char charCode key keyCode".split(" "), filter:function(event, original){if (event.which == null){event.which = original.charCode != null?original.charCode:original.keyCode}return event}}, mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter:function(event, original){var eventDoc, doc, body, button = original.button; if (event.pageX == null && original.clientX != null){eventDoc = event.target.ownerDocument || document; doc = eventDoc.documentElement; body = eventDoc.body; event.pageX = original.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0); event.pageY = original.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0)}if (!event.which && button !== undefined){event.which = button & 1?1:button & 2?3:button & 4?2:0}return event}}, fix:function(event){if (event[jQuery.expando]){return event}var i, prop, copy, type = event.type, originalEvent = event, fixHook = this.fixHooks[type]; if (!fixHook){this.fixHooks[type] = fixHook = rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy = fixHook.props?this.props.concat(fixHook.props):this.props; event = new jQuery.Event(originalEvent); i = copy.length; while (i--){prop = copy[i]; event[prop] = originalEvent[prop]}if (!event.target){event.target = document}if (event.target.nodeType === 3){event.target = event.target.parentNode}return fixHook.filter?fixHook.filter(event, originalEvent):event}, special:{load:{noBubble:true}, focus:{trigger:function(){if (this !== safeActiveElement() && this.focus){this.focus(); return false}}, delegateType:"focusin"}, blur:{trigger:function(){if (this === safeActiveElement() && this.blur){this.blur(); return false}}, delegateType:"focusout"}, click:{trigger:function(){if (this.type === "checkbox" && this.click && jQuery.nodeName(this, "input")){this.click(); return false}}, _default:function(event){return jQuery.nodeName(event.target, "a")}}, beforeunload:{postDispatch:function(event){if (event.result !== undefined && event.originalEvent){event.originalEvent.returnValue = event.result}}}}, simulate:function(type, elem, event, bubble){var e = jQuery.extend(new jQuery.Event, event, {type:type, isSimulated:true, originalEvent:{}}); if (bubble){jQuery.event.trigger(e, null, elem)} else{jQuery.event.dispatch.call(elem, e)}if (e.isDefaultPrevented()){event.preventDefault()}}}; jQuery.removeEvent = function(elem, type, handle){if (elem.removeEventListener){elem.removeEventListener(type, handle, false)}}; jQuery.Event = function(src, props){if (!(this instanceof jQuery.Event)){return new jQuery.Event(src, props)}if (src && src.type){this.originalEvent = src; this.type = src.type; this.isDefaultPrevented = src.defaultPrevented || src.defaultPrevented === undefined && src.returnValue === false?returnTrue:returnFalse} else{this.type = src}if (props){jQuery.extend(this, props)}this.timeStamp = src && src.timeStamp || jQuery.now(); this[jQuery.expando] = true}; jQuery.Event.prototype = {isDefaultPrevented:returnFalse, isPropagationStopped:returnFalse, isImmediatePropagationStopped:returnFalse, preventDefault:function(){var e = this.originalEvent; this.isDefaultPrevented = returnTrue; if (e && e.preventDefault){e.preventDefault()}}, stopPropagation:function(){var e = this.originalEvent; this.isPropagationStopped = returnTrue; if (e && e.stopPropagation){e.stopPropagation()}}, stopImmediatePropagation:function(){var e = this.originalEvent; this.isImmediatePropagationStopped = returnTrue; if (e && e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}}; jQuery.each({mouseenter:"mouseover", mouseleave:"mouseout", pointerenter:"pointerover", pointerleave:"pointerout"}, function(orig, fix){jQuery.event.special[orig] = {delegateType:fix, bindType:fix, handle:function(event){var ret, target = this, related = event.relatedTarget, handleObj = event.handleObj; if (!related || related !== target && !jQuery.contains(target, related)){event.type = handleObj.origType; ret = handleObj.handler.apply(this, arguments); event.type = fix}return ret}}}); if (!support.focusinBubbles){jQuery.each({focus:"focusin", blur:"focusout"}, function(orig, fix){var handler = function(event){jQuery.event.simulate(fix, event.target, jQuery.event.fix(event), true)}; jQuery.event.special[fix] = {setup:function(){var doc = this.ownerDocument || this, attaches = data_priv.access(doc, fix); if (!attaches){doc.addEventListener(orig, handler, true)}data_priv.access(doc, fix, (attaches || 0) + 1)}, teardown:function(){var doc = this.ownerDocument || this, attaches = data_priv.access(doc, fix) - 1; if (!attaches){doc.removeEventListener(orig, handler, true); data_priv.remove(doc, fix)} else{data_priv.access(doc, fix, attaches)}}}})}jQuery.fn.extend({on:function(types, selector, data, fn, one){var origFn, type; if (typeof types === "object"){if (typeof selector !== "string"){data = data || selector; selector = undefined}for (type in types){this.on(type, selector, data, types[type], one)}return this}if (data == null && fn == null){fn = selector; data = selector = undefined} else if (fn == null){if (typeof selector === "string"){fn = data; data = undefined} else{fn = data; data = selector; selector = undefined}}if (fn === false){fn = returnFalse} else if (!fn){return this}if (one === 1){origFn = fn; fn = function(event){jQuery().off(event); return origFn.apply(this, arguments)}; fn.guid = origFn.guid || (origFn.guid = jQuery.guid++)}return this.each(function(){jQuery.event.add(this, types, fn, data, selector)})}, one:function(types, selector, data, fn){return this.on(types, selector, data, fn, 1)}, off:function(types, selector, fn){var handleObj, type; if (types && types.preventDefault && types.handleObj){handleObj = types.handleObj; jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType + "." + handleObj.namespace:handleObj.origType, handleObj.selector, handleObj.handler); return this}if (typeof types === "object"){for (type in types){this.off(type, selector, types[type])}return this}if (selector === false || typeof selector === "function"){fn = selector; selector = undefined}if (fn === false){fn = returnFalse}return this.each(function(){jQuery.event.remove(this, types, fn, selector)})}, trigger:function(type, data){return this.each(function(){jQuery.event.trigger(type, data, this)})}, triggerHandler:function(type, data){var elem = this[0]; if (elem){return jQuery.event.trigger(type, data, elem, true)}}}); var rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, rtagName = /<([\w:]+)/, rhtml = /<|&#?\w+;/, rnoInnerhtml = /<(?:script|style|link)/i, rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i, rscriptType = /^$|\/(?:java|ecma)script/i, rscriptTypeMasked = /^true\/(.*)/, rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, wrapMap = {option:[1, "<select multiple='multiple'>", "</select>"], thead:[1, "<table>", "</table>"], col:[2, "<table><colgroup>", "</colgroup></table>"], tr:[2, "<table><tbody>", "</tbody></table>"], td:[3, "<table><tbody><tr>", "</tr></tbody></table>"], _default:[0, "", ""]}; wrapMap.optgroup = wrapMap.option; wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead; wrapMap.th = wrapMap.td; function manipulationTarget(elem, content){return jQuery.nodeName(elem, "table") && jQuery.nodeName(content.nodeType !== 11?content:content.firstChild, "tr")?elem.getElementsByTagName("tbody")[0] || elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type = (elem.getAttribute("type") !== null) + "/" + elem.type; return elem}function restoreScript(elem){var match = rscriptTypeMasked.exec(elem.type); if (match){elem.type = match[1]} else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems, refElements){var i = 0, l = elems.length; for (; i < l; i++){data_priv.set(elems[i], "globalEval", !refElements || data_priv.get(refElements[i], "globalEval"))}}function cloneCopyEvent(src, dest){var i, l, type, pdataOld, pdataCur, udataOld, udataCur, events; if (dest.nodeType !== 1){return}if (data_priv.hasData(src)){pdataOld = data_priv.access(src); pdataCur = data_priv.set(dest, pdataOld); events = pdataOld.events; if (events){delete pdataCur.handle; pdataCur.events = {}; for (type in events){for (i = 0, l = events[type].length; i < l; i++){jQuery.event.add(dest, type, events[type][i])}}}}if (data_user.hasData(src)){udataOld = data_user.access(src); udataCur = jQuery.extend({}, udataOld); data_user.set(dest, udataCur)}}function getAll(context, tag){var ret = context.getElementsByTagName?context.getElementsByTagName(tag || "*"):context.querySelectorAll?context.querySelectorAll(tag || "*"):[]; return tag === undefined || tag && jQuery.nodeName(context, tag)?jQuery.merge([context], ret):ret}function fixInput(src, dest){var nodeName = dest.nodeName.toLowerCase(); if (nodeName === "input" && rcheckableType.test(src.type)){dest.checked = src.checked} else if (nodeName === "input" || nodeName === "textarea"){dest.defaultValue = src.defaultValue}}jQuery.extend({clone:function(elem, dataAndEvents, deepDataAndEvents){var i, l, srcElements, destElements, clone = elem.cloneNode(true), inPage = jQuery.contains(elem.ownerDocument, elem); if (!support.noCloneChecked && (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem)){destElements = getAll(clone); srcElements = getAll(elem); for (i = 0, l = srcElements.length; i < l; i++){fixInput(srcElements[i], destElements[i])}}if (dataAndEvents){if (deepDataAndEvents){srcElements = srcElements || getAll(elem); destElements = destElements || getAll(clone); for (i = 0, l = srcElements.length; i < l; i++){cloneCopyEvent(srcElements[i], destElements[i])}} else{cloneCopyEvent(elem, clone)}}destElements = getAll(clone, "script"); if (destElements.length > 0){setGlobalEval(destElements, !inPage && getAll(elem, "script"))}return clone}, buildFragment:function(elems, context, scripts, selection){var elem, tmp, tag, wrap, contains, j, fragment = context.createDocumentFragment(), nodes = [], i = 0, l = elems.length; for (; i < l; i++){elem = elems[i]; if (elem || elem === 0){if (jQuery.type(elem) === "object"){jQuery.merge(nodes, elem.nodeType?[elem]:elem)} else if (!rhtml.test(elem)){nodes.push(context.createTextNode(elem))} else{tmp = tmp || fragment.appendChild(context.createElement("div")); tag = (rtagName.exec(elem) || ["", ""])[1].toLowerCase(); wrap = wrapMap[tag] || wrapMap._default; tmp.innerHTML = wrap[1] + elem.replace(rxhtmlTag, "<$1></$2>") + wrap[2]; j = wrap[0]; while (j--){tmp = tmp.lastChild}jQuery.merge(nodes, tmp.childNodes); tmp = fragment.firstChild; tmp.textContent = ""}}}fragment.textContent = ""; i = 0; while (elem = nodes[i++]){if (selection && jQuery.inArray(elem, selection) !== - 1){continue}contains = jQuery.contains(elem.ownerDocument, elem); tmp = getAll(fragment.appendChild(elem), "script"); if (contains){setGlobalEval(tmp)}if (scripts){j = 0; while (elem = tmp[j++]){if (rscriptType.test(elem.type || "")){scripts.push(elem)}}}}return fragment}, cleanData:function(elems){var data, elem, type, key, special = jQuery.event.special, i = 0; for (; (elem = elems[i]) !== undefined; i++){if (jQuery.acceptData(elem)){key = elem[data_priv.expando]; if (key && (data = data_priv.cache[key])){if (data.events){for (type in data.events){if (special[type]){jQuery.event.remove(elem, type)} else{jQuery.removeEvent(elem, type, data.handle)}}}if (data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}}}); jQuery.fn.extend({text:function(value){return access(this, function(value){return value === undefined?jQuery.text(this):this.empty().each(function(){if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9){this.textContent = value}})}, null, value, arguments.length)}, append:function(){return this.domManip(arguments, function(elem){if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9){var target = manipulationTarget(this, elem); target.appendChild(elem)}})}, prepend:function(){return this.domManip(arguments, function(elem){if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9){var target = manipulationTarget(this, elem); target.insertBefore(elem, target.firstChild)}})}, before:function(){return this.domManip(arguments, function(elem){if (this.parentNode){this.parentNode.insertBefore(elem, this)}})}, after:function(){return this.domManip(arguments, function(elem){if (this.parentNode){this.parentNode.insertBefore(elem, this.nextSibling)}})}, remove:function(selector, keepData){var elem, elems = selector?jQuery.filter(selector, this):this, i = 0; for (; (elem = elems[i]) != null; i++){if (!keepData && elem.nodeType === 1){jQuery.cleanData(getAll(elem))}if (elem.parentNode){if (keepData && jQuery.contains(elem.ownerDocument, elem)){setGlobalEval(getAll(elem, "script"))}elem.parentNode.removeChild(elem)}}return this}, empty:function(){var elem, i = 0; for (; (elem = this[i]) != null; i++){if (elem.nodeType === 1){jQuery.cleanData(getAll(elem, false)); elem.textContent = ""}}return this}, clone:function(dataAndEvents, deepDataAndEvents){dataAndEvents = dataAndEvents == null?false:dataAndEvents; deepDataAndEvents = deepDataAndEvents == null?dataAndEvents:deepDataAndEvents; return this.map(function(){return jQuery.clone(this, dataAndEvents, deepDataAndEvents)})}, html:function(value){return access(this, function(value){var elem = this[0] || {}, i = 0, l = this.length; if (value === undefined && elem.nodeType === 1){return elem.innerHTML}if (typeof value === "string" && !rnoInnerhtml.test(value) && !wrapMap[(rtagName.exec(value) || ["", ""])[1].toLowerCase()]){value = value.replace(rxhtmlTag, "<$1></$2>"); try{for (; i < l; i++){elem = this[i] || {}; if (elem.nodeType === 1){jQuery.cleanData(getAll(elem, false)); elem.innerHTML = value}}elem = 0} catch (e){}}if (elem){this.empty().append(value)}}, null, value, arguments.length)}, replaceWith:function(){var arg = arguments[0]; this.domManip(arguments, function(elem){arg = this.parentNode; jQuery.cleanData(getAll(this)); if (arg){arg.replaceChild(elem, this)}}); return arg && (arg.length || arg.nodeType)?this:this.remove()}, detach:function(selector){return this.remove(selector, true)}, domManip:function(args, callback){args = concat.apply([], args); var fragment, first, scripts, hasScripts, node, doc, i = 0, l = this.length, set = this, iNoClone = l - 1, value = args[0], isFunction = jQuery.isFunction(value); if (isFunction || l > 1 && typeof value === "string" && !support.checkClone && rchecked.test(value)){return this.each(function(index){var self = set.eq(index); if (isFunction){args[0] = value.call(this, index, self.html())}self.domManip(args, callback)})}if (l){fragment = jQuery.buildFragment(args, this[0].ownerDocument, false, this); first = fragment.firstChild; if (fragment.childNodes.length === 1){fragment = first}if (first){scripts = jQuery.map(getAll(fragment, "script"), disableScript); hasScripts = scripts.length; for (; i < l; i++){node = fragment; if (i !== iNoClone){node = jQuery.clone(node, true, true); if (hasScripts){jQuery.merge(scripts, getAll(node, "script"))}}callback.call(this[i], node, i)}if (hasScripts){doc = scripts[scripts.length - 1].ownerDocument; jQuery.map(scripts, restoreScript); for (i = 0; i < hasScripts; i++){node = scripts[i]; if (rscriptType.test(node.type || "") && !data_priv.access(node, "globalEval") && jQuery.contains(doc, node)){if (node.src){if (jQuery._evalUrl){jQuery._evalUrl(node.src)}} else{jQuery.globalEval(node.textContent.replace(rcleanScript, ""))}}}}}}return this}}); jQuery.each({appendTo:"append", prependTo:"prepend", insertBefore:"before", insertAfter:"after", replaceAll:"replaceWith"}, function(name, original){jQuery.fn[name] = function(selector){var elems, ret = [], insert = jQuery(selector), last = insert.length - 1, i = 0; for (; i <= last; i++){elems = i === last?this:this.clone(true); jQuery(insert[i])[original](elems); push.apply(ret, elems.get())}return this.pushStack(ret)}}); var iframe, elemdisplay = {}; function actualDisplay(name, doc){var style, elem = jQuery(doc.createElement(name)).appendTo(doc.body), display = window.getDefaultComputedStyle && (style = window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0], "display"); elem.detach(); return display}function defaultDisplay(nodeName){var doc = document, display = elemdisplay[nodeName]; if (!display){display = actualDisplay(nodeName, doc); if (display === "none" || !display){iframe = (iframe || jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement); doc = iframe[0].contentDocument; doc.write(); doc.close(); display = actualDisplay(nodeName, doc); iframe.detach()}elemdisplay[nodeName] = display}return display}var rmargin = /^margin/; var rnumnonpx = new RegExp("^(" + pnum + ")(?!px)[a-z%]+$", "i"); var getStyles = function(elem){if (elem.ownerDocument.defaultView.opener){return elem.ownerDocument.defaultView.getComputedStyle(elem, null)}return window.getComputedStyle(elem, null)}; function curCSS(elem, name, computed){var width, minWidth, maxWidth, ret, style = elem.style; computed = computed || getStyles(elem); if (computed){ret = computed.getPropertyValue(name) || computed[name]}if (computed){if (ret === "" && !jQuery.contains(elem.ownerDocument, elem)){ret = jQuery.style(elem, name)}if (rnumnonpx.test(ret) && rmargin.test(name)){width = style.width; minWidth = style.minWidth; maxWidth = style.maxWidth; style.minWidth = style.maxWidth = style.width = ret; ret = computed.width; style.width = width; style.minWidth = minWidth; style.maxWidth = maxWidth}}return ret !== undefined?ret + "":ret}function addGetHookIf(conditionFn, hookFn){return{get:function(){if (conditionFn()){delete this.get; return}return(this.get = hookFn).apply(this, arguments)}}}(function(){var pixelPositionVal, boxSizingReliableVal, docElem = document.documentElement, container = document.createElement("div"), div = document.createElement("div"); if (!div.style){return}div.style.backgroundClip = "content-box"; div.cloneNode(true).style.backgroundClip = ""; support.clearCloneStyle = div.style.backgroundClip === "content-box"; container.style.cssText = "border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;" + "position:absolute"; container.appendChild(div); function computePixelPositionAndBoxSizingReliable(){div.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;" + "box-sizing:border-box;display:block;margin-top:1%;top:1%;" + "border:1px;padding:1px;width:4px;position:absolute"; div.innerHTML = ""; docElem.appendChild(container); var divStyle = window.getComputedStyle(div, null); pixelPositionVal = divStyle.top !== "1%"; boxSizingReliableVal = divStyle.width === "4px"; docElem.removeChild(container)}if (window.getComputedStyle){jQuery.extend(support, {pixelPosition:function(){computePixelPositionAndBoxSizingReliable(); return pixelPositionVal}, boxSizingReliable:function(){if (boxSizingReliableVal == null){computePixelPositionAndBoxSizingReliable()}return boxSizingReliableVal}, reliableMarginRight:function(){var ret, marginDiv = div.appendChild(document.createElement("div")); marginDiv.style.cssText = div.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;" + "box-sizing:content-box;display:block;margin:0;border:0;padding:0"; marginDiv.style.marginRight = marginDiv.style.width = "0"; div.style.width = "1px"; docElem.appendChild(container); ret = !parseFloat(window.getComputedStyle(marginDiv, null).marginRight); docElem.removeChild(container); div.removeChild(marginDiv); return ret}})}})(); jQuery.swap = function(elem, options, callback, args){var ret, name, old = {}; for (name in options){old[name] = elem.style[name]; elem.style[name] = options[name]}ret = callback.apply(elem, args || []); for (name in options){elem.style[name] = old[name]}return ret}; var rdisplayswap = /^(none|table(?!-c[ea]).+)/, rnumsplit = new RegExp("^(" + pnum + ")(.*)$", "i"), rrelNum = new RegExp("^([+-])=(" + pnum + ")", "i"), cssShow = {position:"absolute", visibility:"hidden", display:"block"}, cssNormalTransform = {letterSpacing:"0", fontWeight:"400"}, cssPrefixes = ["Webkit", "O", "Moz", "ms"]; function vendorPropName(style, name){if (name in style){return name}var capName = name[0].toUpperCase() + name.slice(1), origName = name, i = cssPrefixes.length; while (i--){name = cssPrefixes[i] + capName; if (name in style){return name}}return origName}function setPositiveNumber(elem, value, subtract){var matches = rnumsplit.exec(value); return matches?Math.max(0, matches[1] - (subtract || 0)) + (matches[2] || "px"):value}function augmentWidthOrHeight(elem, name, extra, isBorderBox, styles){var i = extra === (isBorderBox?"border":"content")?4:name === "width"?1:0, val = 0; for (; i < 4; i += 2){if (extra === "margin"){val += jQuery.css(elem, extra + cssExpand[i], true, styles)}if (isBorderBox){if (extra === "content"){val -= jQuery.css(elem, "padding" + cssExpand[i], true, styles)}if (extra !== "margin"){val -= jQuery.css(elem, "border" + cssExpand[i] + "Width", true, styles)}} else{val += jQuery.css(elem, "padding" + cssExpand[i], true, styles); if (extra !== "padding"){val += jQuery.css(elem, "border" + cssExpand[i] + "Width", true, styles)}}}return val}function getWidthOrHeight(elem, name, extra){var valueIsBorderBox = true, val = name === "width"?elem.offsetWidth:elem.offsetHeight, styles = getStyles(elem), isBorderBox = jQuery.css(elem, "boxSizing", false, styles) === "border-box"; if (val <= 0 || val == null){val = curCSS(elem, name, styles); if (val < 0 || val == null){val = elem.style[name]}if (rnumnonpx.test(val)){return val}valueIsBorderBox = isBorderBox && (support.boxSizingReliable() || val === elem.style[name]); val = parseFloat(val) || 0}return val + augmentWidthOrHeight(elem, name, extra || (isBorderBox?"border":"content"), valueIsBorderBox, styles) + "px"}function showHide(elements, show){var display, elem, hidden, values = [], index = 0, length = elements.length; for (; index < length; index++){elem = elements[index]; if (!elem.style){continue}values[index] = data_priv.get(elem, "olddisplay"); display = elem.style.display; if (show){if (!values[index] && display === "none"){elem.style.display = ""}if (elem.style.display === "" && isHidden(elem)){values[index] = data_priv.access(elem, "olddisplay", defaultDisplay(elem.nodeName))}} else{hidden = isHidden(elem); if (display !== "none" || !hidden){data_priv.set(elem, "olddisplay", hidden?display:jQuery.css(elem, "display"))}}}for (index = 0; index < length; index++){elem = elements[index]; if (!elem.style){continue}if (!show || elem.style.display === "none" || elem.style.display === ""){elem.style.display = show?values[index] || "":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem, computed){if (computed){var ret = curCSS(elem, "opacity"); return ret === ""?"1":ret}}}}, cssNumber:{columnCount:true, fillOpacity:true, flexGrow:true, flexShrink:true, fontWeight:true, lineHeight:true, opacity:true, order:true, orphans:true, widows:true, zIndex:true, zoom:true}, cssProps:{float:"cssFloat"}, style:function(elem, name, value, extra){if (!elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style){return}var ret, type, hooks, origName = jQuery.camelCase(name), style = elem.style; name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(style, origName)); hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName]; if (value !== undefined){type = typeof value; if (type === "string" && (ret = rrelNum.exec(value))){value = (ret[1] + 1) * ret[2] + parseFloat(jQuery.css(elem, name)); type = "number"}if (value == null || value !== value){return}if (type === "number" && !jQuery.cssNumber[origName]){value += "px"}if (!support.clearCloneStyle && value === "" && name.indexOf("background") === 0){style[name] = "inherit"}if (!hooks || !("set"in hooks) || (value = hooks.set(elem, value, extra)) !== undefined){style[name] = value}} else{if (hooks && "get"in hooks && (ret = hooks.get(elem, false, extra)) !== undefined){return ret}return style[name]}}, css:function(elem, name, extra, styles){var val, num, hooks, origName = jQuery.camelCase(name); name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(elem.style, origName)); hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName]; if (hooks && "get"in hooks){val = hooks.get(elem, true, extra)}if (val === undefined){val = curCSS(elem, name, styles)}if (val === "normal" && name in cssNormalTransform){val = cssNormalTransform[name]}if (extra === "" || extra){num = parseFloat(val); return extra === true || jQuery.isNumeric(num)?num || 0:val}return val}}); jQuery.each(["height", "width"], function(i, name){jQuery.cssHooks[name] = {get:function(elem, computed, extra){if (computed){return rdisplayswap.test(jQuery.css(elem, "display")) && elem.offsetWidth === 0?jQuery.swap(elem, cssShow, function(){return getWidthOrHeight(elem, name, extra)}):getWidthOrHeight(elem, name, extra)}}, set:function(elem, value, extra){var styles = extra && getStyles(elem); return setPositiveNumber(elem, value, extra?augmentWidthOrHeight(elem, name, extra, jQuery.css(elem, "boxSizing", false, styles) === "border-box", styles):0)}}}); jQuery.cssHooks.marginRight = addGetHookIf(support.reliableMarginRight, function(elem, computed){if (computed){return jQuery.swap(elem, {display:"inline-block"}, curCSS, [elem, "marginRight"])}}); jQuery.each({margin:"", padding:"", border:"Width"}, function(prefix, suffix){jQuery.cssHooks[prefix + suffix] = {expand:function(value){var i = 0, expanded = {}, parts = typeof value === "string"?value.split(" "):[value]; for (; i < 4; i++){expanded[prefix + cssExpand[i] + suffix] = parts[i] || parts[i - 2] || parts[0]}return expanded}}; if (!rmargin.test(prefix)){jQuery.cssHooks[prefix + suffix].set = setPositiveNumber}}); jQuery.fn.extend({css:function(name, value){return access(this, function(elem, name, value){var styles, len, map = {}, i = 0; if (jQuery.isArray(name)){styles = getStyles(elem); len = name.length; for (; i < len; i++){map[name[i]] = jQuery.css(elem, name[i], false, styles)}return map}return value !== undefined?jQuery.style(elem, name, value):jQuery.css(elem, name)}, name, value, arguments.length > 1)}, show:function(){return showHide(this, true)}, hide:function(){return showHide(this)}, toggle:function(state){if (typeof state === "boolean"){return state?this.show():this.hide()}return this.each(function(){if (isHidden(this)){jQuery(this).show()} else{jQuery(this).hide()}})}}); function Tween(elem, options, prop, end, easing){return new Tween.prototype.init(elem, options, prop, end, easing)}jQuery.Tween = Tween; Tween.prototype = {constructor:Tween, init:function(elem, options, prop, end, easing, unit){this.elem = elem; this.prop = prop; this.easing = easing || "swing"; this.options = options; this.start = this.now = this.cur(); this.end = end; this.unit = unit || (jQuery.cssNumber[prop]?"":"px")}, cur:function(){var hooks = Tween.propHooks[this.prop]; return hooks && hooks.get?hooks.get(this):Tween.propHooks._default.get(this)}, run:function(percent){var eased, hooks = Tween.propHooks[this.prop]; if (this.options.duration){this.pos = eased = jQuery.easing[this.easing](percent, this.options.duration * percent, 0, 1, this.options.duration)} else{this.pos = eased = percent}this.now = (this.end - this.start) * eased + this.start; if (this.options.step){this.options.step.call(this.elem, this.now, this)}if (hooks && hooks.set){hooks.set(this)} else{Tween.propHooks._default.set(this)}return this}}; Tween.prototype.init.prototype = Tween.prototype; Tween.propHooks = {_default:{get:function(tween){var result; if (tween.elem[tween.prop] != null && (!tween.elem.style || tween.elem.style[tween.prop] == null)){return tween.elem[tween.prop]}result = jQuery.css(tween.elem, tween.prop, ""); return!result || result === "auto"?0:result}, set:function(tween){if (jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)} else if (tween.elem.style && (tween.elem.style[jQuery.cssProps[tween.prop]] != null || jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem, tween.prop, tween.now + tween.unit)} else{tween.elem[tween.prop] = tween.now}}}}; Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {set:function(tween){if (tween.elem.nodeType && tween.elem.parentNode){tween.elem[tween.prop] = tween.now}}}; jQuery.easing = {linear:function(p){return p}, swing:function(p){return.5 - Math.cos(p * Math.PI) / 2}}; jQuery.fx = Tween.prototype.init; jQuery.fx.step = {}; var fxNow, timerId, rfxtypes = /^(?:toggle|show|hide)$/, rfxnum = new RegExp("^(?:([+-])=|)(" + pnum + ")([a-z%]*)$", "i"), rrun = /queueHooks$/, animationPrefilters = [defaultPrefilter], tweeners = {"*":[function(prop, value){var tween = this.createTween(prop, value), target = tween.cur(), parts = rfxnum.exec(value), unit = parts && parts[3] || (jQuery.cssNumber[prop]?"":"px"), start = (jQuery.cssNumber[prop] || unit !== "px" && + target) && rfxnum.exec(jQuery.css(tween.elem, prop)), scale = 1, maxIterations = 20; if (start && start[3] !== unit){unit = unit || start[3]; parts = parts || []; start = + target || 1; do{scale = scale || ".5"; start = start / scale; jQuery.style(tween.elem, prop, start + unit)}while (scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations)}if (parts){start = tween.start = + start || + target || 0; tween.unit = unit; tween.end = parts[1]?start + (parts[1] + 1) * parts[2]: + parts[2]}return tween}]}; function createFxNow(){setTimeout(function(){fxNow = undefined}); return fxNow = jQuery.now()}function genFx(type, includeWidth){var which, i = 0, attrs = {height:type}; includeWidth = includeWidth?1:0; for (; i < 4; i += 2 - includeWidth){which = cssExpand[i]; attrs["margin" + which] = attrs["padding" + which] = type}if (includeWidth){attrs.opacity = attrs.width = type}return attrs}function createTween(value, prop, animation){var tween, collection = (tweeners[prop] || []).concat(tweeners["*"]), index = 0, length = collection.length; for (; index < length; index++){if (tween = collection[index].call(animation, prop, value)){return tween}}}function defaultPrefilter(elem, props, opts){var prop, value, toggle, tween, hooks, oldfire, display, checkDisplay, anim = this, orig = {}, style = elem.style, hidden = elem.nodeType && isHidden(elem), dataShow = data_priv.get(elem, "fxshow"); if (!opts.queue){hooks = jQuery._queueHooks(elem, "fx"); if (hooks.unqueued == null){hooks.unqueued = 0; oldfire = hooks.empty.fire; hooks.empty.fire = function(){if (!hooks.unqueued){oldfire()}}}hooks.unqueued++; anim.always(function(){anim.always(function(){hooks.unqueued--; if (!jQuery.queue(elem, "fx").length){hooks.empty.fire()}})})}if (elem.nodeType === 1 && ("height"in props || "width"in props)){opts.overflow = [style.overflow, style.overflowX, style.overflowY]; display = jQuery.css(elem, "display"); checkDisplay = display === "none"?data_priv.get(elem, "olddisplay") || defaultDisplay(elem.nodeName):display; if (checkDisplay === "inline" && jQuery.css(elem, "float") === "none"){style.display = "inline-block"}}if (opts.overflow){style.overflow = "hidden"; anim.always(function(){style.overflow = opts.overflow[0]; style.overflowX = opts.overflow[1]; style.overflowY = opts.overflow[2]})}for (prop in props){value = props[prop]; if (rfxtypes.exec(value)){delete props[prop]; toggle = toggle || value === "toggle"; if (value === (hidden?"hide":"show")){if (value === "show" && dataShow && dataShow[prop] !== undefined){hidden = true} else{continue}}orig[prop] = dataShow && dataShow[prop] || jQuery.style(elem, prop)} else{display = undefined}}if (!jQuery.isEmptyObject(orig)){if (dataShow){if ("hidden"in dataShow){hidden = dataShow.hidden}} else{dataShow = data_priv.access(elem, "fxshow", {})}if (toggle){dataShow.hidden = !hidden}if (hidden){jQuery(elem).show()} else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop; data_priv.remove(elem, "fxshow"); for (prop in orig){jQuery.style(elem, prop, orig[prop])}}); for (prop in orig){tween = createTween(hidden?dataShow[prop]:0, prop, anim); if (!(prop in dataShow)){dataShow[prop] = tween.start; if (hidden){tween.end = tween.start; tween.start = prop === "width" || prop === "height"?1:0}}}} else if ((display === "none"?defaultDisplay(elem.nodeName):display) === "inline"){style.display = display}}function propFilter(props, specialEasing){var index, name, easing, value, hooks; for (index in props){name = jQuery.camelCase(index); easing = specialEasing[name]; value = props[index]; if (jQuery.isArray(value)){easing = value[1]; value = props[index] = value[0]}if (index !== name){props[name] = value; delete props[index]}hooks = jQuery.cssHooks[name]; if (hooks && "expand"in hooks){value = hooks.expand(value); delete props[name]; for (index in value){if (!(index in props)){props[index] = value[index]; specialEasing[index] = easing}}} else{specialEasing[name] = easing}}}function Animation(elem, properties, options){var result, stopped, index = 0, length = animationPrefilters.length, deferred = jQuery.Deferred().always(function(){delete tick.elem}), tick = function(){if (stopped){return false}var currentTime = fxNow || createFxNow(), remaining = Math.max(0, animation.startTime + animation.duration - currentTime), temp = remaining / animation.duration || 0, percent = 1 - temp, index = 0, length = animation.tweens.length; for (; index < length; index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem, [animation, percent, remaining]); if (percent < 1 && length){return remaining} else{deferred.resolveWith(elem, [animation]); return false}}, animation = deferred.promise({elem:elem, props:jQuery.extend({}, properties), opts:jQuery.extend(true, {specialEasing:{}}, options), originalProperties:properties, originalOptions:options, startTime:fxNow || createFxNow(), duration:options.duration, tweens:[], createTween:function(prop, end){var tween = jQuery.Tween(elem, animation.opts, prop, end, animation.opts.specialEasing[prop] || animation.opts.easing); animation.tweens.push(tween); return tween}, stop:function(gotoEnd){var index = 0, length = gotoEnd?animation.tweens.length:0; if (stopped){return this}stopped = true; for (; index < length; index++){animation.tweens[index].run(1)}if (gotoEnd){deferred.resolveWith(elem, [animation, gotoEnd])} else{deferred.rejectWith(elem, [animation, gotoEnd])}return this}}), props = animation.props; propFilter(props, animation.opts.specialEasing); for (; index < length; index++){result = animationPrefilters[index].call(animation, elem, props, animation.opts); if (result){return result}}jQuery.map(props, createTween, animation); if (jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem, animation)}jQuery.fx.timer(jQuery.extend(tick, {elem:elem, anim:animation, queue:animation.opts.queue})); return animation.progress(animation.opts.progress).done(animation.opts.done, animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation = jQuery.extend(Animation, {tweener:function(props, callback){if (jQuery.isFunction(props)){callback = props; props = ["*"]} else{props = props.split(" ")}var prop, index = 0, length = props.length; for (; index < length; index++){prop = props[index]; tweeners[prop] = tweeners[prop] || []; tweeners[prop].unshift(callback)}}, prefilter:function(callback, prepend){if (prepend){animationPrefilters.unshift(callback)} else{animationPrefilters.push(callback)}}}); jQuery.speed = function(speed, easing, fn){var opt = speed && typeof speed === "object"?jQuery.extend({}, speed):{complete:fn || !fn && easing || jQuery.isFunction(speed) && speed, duration:speed, easing:fn && easing || easing && !jQuery.isFunction(easing) && easing}; opt.duration = jQuery.fx.off?0:typeof opt.duration === "number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default; if (opt.queue == null || opt.queue === true){opt.queue = "fx"}opt.old = opt.complete; opt.complete = function(){if (jQuery.isFunction(opt.old)){opt.old.call(this)}if (opt.queue){jQuery.dequeue(this, opt.queue)}}; return opt}; jQuery.fn.extend({fadeTo:function(speed, to, easing, callback){return this.filter(isHidden).css("opacity", 0).show().end().animate({opacity:to}, speed, easing, callback)}, animate:function(prop, speed, easing, callback){var empty = jQuery.isEmptyObject(prop), optall = jQuery.speed(speed, easing, callback), doAnimation = function(){var anim = Animation(this, jQuery.extend({}, prop), optall); if (empty || data_priv.get(this, "finish")){anim.stop(true)}}; doAnimation.finish = doAnimation; return empty || optall.queue === false?this.each(doAnimation):this.queue(optall.queue, doAnimation)}, stop:function(type, clearQueue, gotoEnd){var stopQueue = function(hooks){var stop = hooks.stop; delete hooks.stop; stop(gotoEnd)}; if (typeof type !== "string"){gotoEnd = clearQueue; clearQueue = type; type = undefined}if (clearQueue && type !== false){this.queue(type || "fx", [])}return this.each(function(){var dequeue = true, index = type != null && type + "queueHooks", timers = jQuery.timers, data = data_priv.get(this); if (index){if (data[index] && data[index].stop){stopQueue(data[index])}} else{for (index in data){if (data[index] && data[index].stop && rrun.test(index)){stopQueue(data[index])}}}for (index = timers.length; index--; ){if (timers[index].elem === this && (type == null || timers[index].queue === type)){timers[index].anim.stop(gotoEnd); dequeue = false; timers.splice(index, 1)}}if (dequeue || !gotoEnd){jQuery.dequeue(this, type)}})}, finish:function(type){if (type !== false){type = type || "fx"}return this.each(function(){var index, data = data_priv.get(this), queue = data[type + "queue"], hooks = data[type + "queueHooks"], timers = jQuery.timers, length = queue?queue.length:0; data.finish = true; jQuery.queue(this, type, []); if (hooks && hooks.stop){hooks.stop.call(this, true)}for (index = timers.length; index--; ){if (timers[index].elem === this && timers[index].queue === type){timers[index].anim.stop(true); timers.splice(index, 1)}}for (index = 0; index < length; index++){if (queue[index] && queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}}); jQuery.each(["toggle", "show", "hide"], function(i, name){var cssFn = jQuery.fn[name]; jQuery.fn[name] = function(speed, easing, callback){return speed == null || typeof speed === "boolean"?cssFn.apply(this, arguments):this.animate(genFx(name, true), speed, easing, callback)}}); jQuery.each({slideDown:genFx("show"), slideUp:genFx("hide"), slideToggle:genFx("toggle"), fadeIn:{opacity:"show"}, fadeOut:{opacity:"hide"}, fadeToggle:{opacity:"toggle"}}, function(name, props){jQuery.fn[name] = function(speed, easing, callback){return this.animate(props, speed, easing, callback)}}); jQuery.timers = []; jQuery.fx.tick = function(){var timer, i = 0, timers = jQuery.timers; fxNow = jQuery.now(); for (; i < timers.length; i++){timer = timers[i]; if (!timer() && timers[i] === timer){timers.splice(i--, 1)}}if (!timers.length){jQuery.fx.stop()}fxNow = undefined}; jQuery.fx.timer = function(timer){jQuery.timers.push(timer); if (timer()){jQuery.fx.start()} else{jQuery.timers.pop()}}; jQuery.fx.interval = 13; jQuery.fx.start = function(){if (!timerId){timerId = setInterval(jQuery.fx.tick, jQuery.fx.interval)}}; jQuery.fx.stop = function(){clearInterval(timerId); timerId = null}; jQuery.fx.speeds = {slow:600, fast:200, _default:400}; jQuery.fn.delay = function(time, type){time = jQuery.fx?jQuery.fx.speeds[time] || time:time; type = type || "fx"; return this.queue(type, function(next, hooks){var timeout = setTimeout(next, time); hooks.stop = function(){clearTimeout(timeout)}})}; (function(){var input = document.createElement("input"), select = document.createElement("select"), opt = select.appendChild(document.createElement("option")); input.type = "checkbox"; support.checkOn = input.value !== ""; support.optSelected = opt.selected; select.disabled = true; support.optDisabled = !opt.disabled; input = document.createElement("input"); input.value = "t"; input.type = "radio"; support.radioValue = input.value === "t"})(); var nodeHook, boolHook, attrHandle = jQuery.expr.attrHandle; jQuery.fn.extend({attr:function(name, value){return access(this, jQuery.attr, name, value, arguments.length > 1)}, removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this, name)})}}); jQuery.extend({attr:function(elem, name, value){var hooks, ret, nType = elem.nodeType; if (!elem || nType === 3 || nType === 8 || nType === 2){return}if (typeof elem.getAttribute === strundefined){return jQuery.prop(elem, name, value)}if (nType !== 1 || !jQuery.isXMLDoc(elem)){name = name.toLowerCase(); hooks = jQuery.attrHooks[name] || (jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if (value !== undefined){if (value === null){jQuery.removeAttr(elem, name)} else if (hooks && "set"in hooks && (ret = hooks.set(elem, value, name)) !== undefined){return ret} else{elem.setAttribute(name, value + ""); return value}} else if (hooks && "get"in hooks && (ret = hooks.get(elem, name)) !== null){return ret} else{ret = jQuery.find.attr(elem, name); return ret == null?undefined:ret}}, removeAttr:function(elem, value){var name, propName, i = 0, attrNames = value && value.match(rnotwhite); if (attrNames && elem.nodeType === 1){while (name = attrNames[i++]){propName = jQuery.propFix[name] || name; if (jQuery.expr.match.bool.test(name)){elem[propName] = false}elem.removeAttribute(name)}}}, attrHooks:{type:{set:function(elem, value){if (!support.radioValue && value === "radio" && jQuery.nodeName(elem, "input")){var val = elem.value; elem.setAttribute("type", value); if (val){elem.value = val}return value}}}}}); boolHook = {set:function(elem, value, name){if (value === false){jQuery.removeAttr(elem, name)} else{elem.setAttribute(name, name)}return name}}; jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g), function(i, name){var getter = attrHandle[name] || jQuery.find.attr; attrHandle[name] = function(elem, name, isXML){var ret, handle; if (!isXML){handle = attrHandle[name]; attrHandle[name] = ret; ret = getter(elem, name, isXML) != null?name.toLowerCase():null; attrHandle[name] = handle}return ret}}); var rfocusable = /^(?:input|select|textarea|button)$/i; jQuery.fn.extend({prop:function(name, value){return access(this, jQuery.prop, name, value, arguments.length > 1)}, removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name] || name]})}}); jQuery.extend({propFix:{for :"htmlFor", class:"className"}, prop:function(elem, name, value){var ret, hooks, notxml, nType = elem.nodeType; if (!elem || nType === 3 || nType === 8 || nType === 2){return}notxml = nType !== 1 || !jQuery.isXMLDoc(elem); if (notxml){name = jQuery.propFix[name] || name; hooks = jQuery.propHooks[name]}if (value !== undefined){return hooks && "set"in hooks && (ret = hooks.set(elem, value, name)) !== undefined?ret:elem[name] = value} else{return hooks && "get"in hooks && (ret = hooks.get(elem, name)) !== null?ret:elem[name]}}, propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex") || rfocusable.test(elem.nodeName) || elem.href?elem.tabIndex: - 1}}}}); if (!support.optSelected){jQuery.propHooks.selected = {get:function(elem){var parent = elem.parentNode; if (parent && parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function(){jQuery.propFix[this.toLowerCase()] = this}); var rclass = /[\t\r\n\f]/g; jQuery.fn.extend({addClass:function(value){var classes, elem, cur, clazz, j, finalValue, proceed = typeof value === "string" && value, i = 0, len = this.length; if (jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this, j, this.className))})}if (proceed){classes = (value || "").match(rnotwhite) || []; for (; i < len; i++){elem = this[i]; cur = elem.nodeType === 1 && (elem.className?(" " + elem.className + " ").replace(rclass, " "):" "); if (cur){j = 0; while (clazz = classes[j++]){if (cur.indexOf(" " + clazz + " ") < 0){cur += clazz + " "}}finalValue = jQuery.trim(cur); if (elem.className !== finalValue){elem.className = finalValue}}}}return this}, removeClass:function(value){var classes, elem, cur, clazz, j, finalValue, proceed = arguments.length === 0 || typeof value === "string" && value, i = 0, len = this.length; if (jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this, j, this.className))})}if (proceed){classes = (value || "").match(rnotwhite) || []; for (; i < len; i++){elem = this[i]; cur = elem.nodeType === 1 && (elem.className?(" " + elem.className + " ").replace(rclass, " "):""); if (cur){j = 0; while (clazz = classes[j++]){while (cur.indexOf(" " + clazz + " ") >= 0){cur = cur.replace(" " + clazz + " ", " ")}}finalValue = value?jQuery.trim(cur):""; if (elem.className !== finalValue){elem.className = finalValue}}}}return this}, toggleClass:function(value, stateVal){var type = typeof value; if (typeof stateVal === "boolean" && type === "string"){return stateVal?this.addClass(value):this.removeClass(value)}if (jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this, i, this.className, stateVal), stateVal)})}return this.each(function(){if (type === "string"){var className, i = 0, self = jQuery(this), classNames = value.match(rnotwhite) || []; while (className = classNames[i++]){if (self.hasClass(className)){self.removeClass(className)} else{self.addClass(className)}}} else if (type === strundefined || type === "boolean"){if (this.className){data_priv.set(this, "__className__", this.className)}this.className = this.className || value === false?"":data_priv.get(this, "__className__") || ""}})}, hasClass:function(selector){var className = " " + selector + " ", i = 0, l = this.length; for (; i < l; i++){if (this[i].nodeType === 1 && (" " + this[i].className + " ").replace(rclass, " ").indexOf(className) >= 0){return true}}return false}}); var rreturn = /\r/g; jQuery.fn.extend({val:function(value){var hooks, ret, isFunction, elem = this[0]; if (!arguments.length){if (elem){hooks = jQuery.valHooks[elem.type] || jQuery.valHooks[elem.nodeName.toLowerCase()]; if (hooks && "get"in hooks && (ret = hooks.get(elem, "value")) !== undefined){return ret}ret = elem.value; return typeof ret === "string"?ret.replace(rreturn, ""):ret == null?"":ret}return}isFunction = jQuery.isFunction(value); return this.each(function(i){var val; if (this.nodeType !== 1){return}if (isFunction){val = value.call(this, i, jQuery(this).val())} else{val = value}if (val == null){val = ""} else if (typeof val === "number"){val += ""} else if (jQuery.isArray(val)){val = jQuery.map(val, function(value){return value == null?"":value + ""})}hooks = jQuery.valHooks[this.type] || jQuery.valHooks[this.nodeName.toLowerCase()]; if (!hooks || !("set"in hooks) || hooks.set(this, val, "value") === undefined){this.value = val}})}}); jQuery.extend({valHooks:{option:{get:function(elem){var val = jQuery.find.attr(elem, "value"); return val != null?val:jQuery.trim(jQuery.text(elem))}}, select:{get:function(elem){var value, option, options = elem.options, index = elem.selectedIndex, one = elem.type === "select-one" || index < 0, values = one?null:[], max = one?index + 1:options.length, i = index < 0?max:one?index:0; for (; i < max; i++){option = options[i]; if ((option.selected || i === index) && (support.optDisabled?!option.disabled:option.getAttribute("disabled") === null) && (!option.parentNode.disabled || !jQuery.nodeName(option.parentNode, "optgroup"))){value = jQuery(option).val(); if (one){return value}values.push(value)}}return values}, set:function(elem, value){var optionSet, option, options = elem.options, values = jQuery.makeArray(value), i = options.length; while (i--){option = options[i]; if (option.selected = jQuery.inArray(option.value, values) >= 0){optionSet = true}}if (!optionSet){elem.selectedIndex = - 1}return values}}}}); jQuery.each(["radio", "checkbox"], function(){jQuery.valHooks[this] = {set:function(elem, value){if (jQuery.isArray(value)){return elem.checked = jQuery.inArray(jQuery(elem).val(), value) >= 0}}}; if (!support.checkOn){jQuery.valHooks[this].get = function(elem){return elem.getAttribute("value") === null?"on":elem.value}}}); jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick " + "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " + "change select submit keydown keypress keyup error contextmenu").split(" "), function(i, name){jQuery.fn[name] = function(data, fn){return arguments.length > 0?this.on(name, null, data, fn):this.trigger(name)}}); jQuery.fn.extend({hover:function(fnOver, fnOut){return this.mouseenter(fnOver).mouseleave(fnOut || fnOver)}, bind:function(types, data, fn){return this.on(types, null, data, fn)}, unbind:function(types, fn){return this.off(types, null, fn)}, delegate:function(selector, types, data, fn){return this.on(types, selector, data, fn)}, undelegate:function(selector, types, fn){return arguments.length === 1?this.off(selector, "**"):this.off(types, selector || "**", fn)}}); var nonce = jQuery.now(); var rquery = /\?/; jQuery.parseJSON = function(data){return JSON.parse(data + "")}; jQuery.parseXML = function(data){var xml, tmp; if (!data || typeof data !== "string"){return null}try{tmp = new DOMParser; xml = tmp.parseFromString(data, "text/xml")} catch (e){xml = undefined}if (!xml || xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: " + data)}return xml}; var rhash = /#.*$/, rts = /([?&])_=[^&]*/, rheaders = /^(.*?):[ \t]*([^\r\n]*)$/gm, rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, rnoContent = /^(?:GET|HEAD)$/, rprotocol = /^\/\//, rurl = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/, prefilters = {}, transports = {}, allTypes = "*/".concat("*"), ajaxLocation = window.location.href, ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []; function addToPrefiltersOrTransports(structure){return function(dataTypeExpression, func){if (typeof dataTypeExpression !== "string"){func = dataTypeExpression; dataTypeExpression = "*"}var dataType, i = 0, dataTypes = dataTypeExpression.toLowerCase().match(rnotwhite) || []; if (jQuery.isFunction(func)){while (dataType = dataTypes[i++]){if (dataType[0] === "+"){dataType = dataType.slice(1) || "*"; (structure[dataType] = structure[dataType] || []).unshift(func)} else{(structure[dataType] = structure[dataType] || []).push(func)}}}}}function inspectPrefiltersOrTransports(structure, options, originalOptions, jqXHR){var inspected = {}, seekingTransport = structure === transports; function inspect(dataType){var selected; inspected[dataType] = true; jQuery.each(structure[dataType] || [], function(_, prefilterOrFactory){var dataTypeOrTransport = prefilterOrFactory(options, originalOptions, jqXHR); if (typeof dataTypeOrTransport === "string" && !seekingTransport && !inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport); inspect(dataTypeOrTransport); return false} else if (seekingTransport){return!(selected = dataTypeOrTransport)}}); return selected}return inspect(options.dataTypes[0]) || !inspected["*"] && inspect("*")}function ajaxExtend(target, src){var key, deep, flatOptions = jQuery.ajaxSettings.flatOptions || {}; for (key in src){if (src[key] !== undefined){(flatOptions[key]?target:deep || (deep = {}))[key] = src[key]}}if (deep){jQuery.extend(true, target, deep)}return target}function ajaxHandleResponses(s, jqXHR, responses){var ct, type, finalDataType, firstDataType, contents = s.contents, dataTypes = s.dataTypes; while (dataTypes[0] === "*"){dataTypes.shift(); if (ct === undefined){ct = s.mimeType || jqXHR.getResponseHeader("Content-Type")}}if (ct){for (type in contents){if (contents[type] && contents[type].test(ct)){dataTypes.unshift(type); break}}}if (dataTypes[0]in responses){finalDataType = dataTypes[0]} else{for (type in responses){if (!dataTypes[0] || s.converters[type + " " + dataTypes[0]]){finalDataType = type; break}if (!firstDataType){firstDataType = type}}finalDataType = finalDataType || firstDataType}if (finalDataType){if (finalDataType !== dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s, response, jqXHR, isSuccess){var conv2, current, conv, tmp, prev, converters = {}, dataTypes = s.dataTypes.slice(); if (dataTypes[1]){for (conv in s.converters){converters[conv.toLowerCase()] = s.converters[conv]}}current = dataTypes.shift(); while (current){if (s.responseFields[current]){jqXHR[s.responseFields[current]] = response}if (!prev && isSuccess && s.dataFilter){response = s.dataFilter(response, s.dataType)}prev = current; current = dataTypes.shift(); if (current){if (current === "*"){current = prev} else if (prev !== "*" && prev !== current){conv = converters[prev + " " + current] || converters["* " + current]; if (!conv){for (conv2 in converters){tmp = conv2.split(" "); if (tmp[1] === current){conv = converters[prev + " " + tmp[0]] || converters["* " + tmp[0]]; if (conv){if (conv === true){conv = converters[conv2]} else if (converters[conv2] !== true){current = tmp[0]; dataTypes.unshift(tmp[1])}break}}}}if (conv !== true){if (conv && s["throws"]){response = conv(response)} else{try{response = conv(response)} catch (e){return{state:"parsererror", error:conv?e:"No conversion from " + prev + " to " + current}}}}}}}return{state:"success", data:response}}jQuery.extend({active:0, lastModified:{}, etag:{}, ajaxSettings:{url:ajaxLocation, type:"GET", isLocal:rlocalProtocol.test(ajaxLocParts[1]), global:true, processData:true, async:true, contentType:"application/x-www-form-urlencoded; charset=UTF-8", accepts:{"*":allTypes, text:"text/plain", html:"text/html", xml:"application/xml, text/xml", json:"application/json, text/javascript"}, contents:{xml:/xml/, html:/html/, json:/json/}, responseFields:{xml:"responseXML", text:"responseText", json:"responseJSON"}, converters:{"* text":String, "text html":true, "text json":jQuery.parseJSON, "text xml":jQuery.parseXML}, flatOptions:{url:true, context:true}}, ajaxSetup:function(target, settings){return settings?ajaxExtend(ajaxExtend(target, jQuery.ajaxSettings), settings):ajaxExtend(jQuery.ajaxSettings, target)}, ajaxPrefilter:addToPrefiltersOrTransports(prefilters), ajaxTransport:addToPrefiltersOrTransports(transports), ajax:function(url, options){if (typeof url === "object"){options = url; url = undefined}options = options || {}; var transport, cacheURL, responseHeadersString, responseHeaders, timeoutTimer, parts, fireGlobals, i, s = jQuery.ajaxSetup({}, options), callbackContext = s.context || s, globalEventContext = s.context && (callbackContext.nodeType || callbackContext.jquery)?jQuery(callbackContext):jQuery.event, deferred = jQuery.Deferred(), completeDeferred = jQuery.Callbacks("once memory"), statusCode = s.statusCode || {}, requestHeaders = {}, requestHeadersNames = {}, state = 0, strAbort = "canceled", jqXHR = {readyState:0, getResponseHeader:function(key){var match; if (state === 2){if (!responseHeaders){responseHeaders = {}; while (match = rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()] = match[2]}}match = responseHeaders[key.toLowerCase()]}return match == null?null:match}, getAllResponseHeaders:function(){return state === 2?responseHeadersString:null}, setRequestHeader:function(name, value){var lname = name.toLowerCase(); if (!state){name = requestHeadersNames[lname] = requestHeadersNames[lname] || name; requestHeaders[name] = value}return this}, overrideMimeType:function(type){if (!state){s.mimeType = type}return this}, statusCode:function(map){var code; if (map){if (state < 2){for (code in map){statusCode[code] = [statusCode[code], map[code]]}} else{jqXHR.always(map[jqXHR.status])}}return this}, abort:function(statusText){var finalText = statusText || strAbort; if (transport){transport.abort(finalText)}done(0, finalText); return this}}; deferred.promise(jqXHR).complete = completeDeferred.add; jqXHR.success = jqXHR.done; jqXHR.error = jqXHR.fail; s.url = ((url || s.url || ajaxLocation) + "").replace(rhash, "").replace(rprotocol, ajaxLocParts[1] + "//"); s.type = options.method || options.type || s.method || s.type; s.dataTypes = jQuery.trim(s.dataType || "*").toLowerCase().match(rnotwhite) || [""]; if (s.crossDomain == null){parts = rurl.exec(s.url.toLowerCase()); s.crossDomain = !!(parts && (parts[1] !== ajaxLocParts[1] || parts[2] !== ajaxLocParts[2] || (parts[3] || (parts[1] === "http:"?"80":"443")) !== (ajaxLocParts[3] || (ajaxLocParts[1] === "http:"?"80":"443"))))}if (s.data && s.processData && typeof s.data !== "string"){s.data = jQuery.param(s.data, s.traditional)}inspectPrefiltersOrTransports(prefilters, s, options, jqXHR); if (state === 2){return jqXHR}fireGlobals = jQuery.event && s.global; if (fireGlobals && jQuery.active++ === 0){jQuery.event.trigger("ajaxStart")}s.type = s.type.toUpperCase(); s.hasContent = !rnoContent.test(s.type); cacheURL = s.url; if (!s.hasContent){if (s.data){cacheURL = s.url += (rquery.test(cacheURL)?"&":"?") + s.data; delete s.data}if (s.cache === false){s.url = rts.test(cacheURL)?cacheURL.replace(rts, "$1_=" + nonce++):cacheURL + (rquery.test(cacheURL)?"&":"?") + "_=" + nonce++}}if (s.ifModified){if (jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since", jQuery.lastModified[cacheURL])}if (jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match", jQuery.etag[cacheURL])}}if (s.data && s.hasContent && s.contentType !== false || options.contentType){jqXHR.setRequestHeader("Content-Type", s.contentType)}jqXHR.setRequestHeader("Accept", s.dataTypes[0] && s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]] + (s.dataTypes[0] !== "*"?", " + allTypes + "; q=0.01":""):s.accepts["*"]); for (i in s.headers){jqXHR.setRequestHeader(i, s.headers[i])}if (s.beforeSend && (s.beforeSend.call(callbackContext, jqXHR, s) === false || state === 2)){return jqXHR.abort()}strAbort = "abort"; for (i in{success:1, error:1, complete:1}){jqXHR[i](s[i])}transport = inspectPrefiltersOrTransports(transports, s, options, jqXHR); if (!transport){done( - 1, "No Transport")} else{jqXHR.readyState = 1; if (fireGlobals){globalEventContext.trigger("ajaxSend", [jqXHR, s])}if (s.async && s.timeout > 0){timeoutTimer = setTimeout(function(){jqXHR.abort("timeout")}, s.timeout)}try{state = 1; transport.send(requestHeaders, done)} catch (e){if (state < 2){done( - 1, e)} else{throw e}}}function done(status, nativeStatusText, responses, headers){var isSuccess, success, error, response, modified, statusText = nativeStatusText; if (state === 2){return}state = 2; if (timeoutTimer){clearTimeout(timeoutTimer)}transport = undefined; responseHeadersString = headers || ""; jqXHR.readyState = status > 0?4:0; isSuccess = status >= 200 && status < 300 || status === 304; if (responses){response = ajaxHandleResponses(s, jqXHR, responses)}response = ajaxConvert(s, response, jqXHR, isSuccess); if (isSuccess){if (s.ifModified){modified = jqXHR.getResponseHeader("Last-Modified"); if (modified){jQuery.lastModified[cacheURL] = modified}modified = jqXHR.getResponseHeader("etag"); if (modified){jQuery.etag[cacheURL] = modified}}if (status === 204 || s.type === "HEAD"){statusText = "nocontent"} else if (status === 304){statusText = "notmodified"} else{statusText = response.state; success = response.data; error = response.error; isSuccess = !error}} else{error = statusText; if (status || !statusText){statusText = "error"; if (status < 0){status = 0}}}jqXHR.status = status; jqXHR.statusText = (nativeStatusText || statusText) + ""; if (isSuccess){deferred.resolveWith(callbackContext, [success, statusText, jqXHR])} else{deferred.rejectWith(callbackContext, [jqXHR, statusText, error])}jqXHR.statusCode(statusCode); statusCode = undefined; if (fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError", [jqXHR, s, isSuccess?success:error])}completeDeferred.fireWith(callbackContext, [jqXHR, statusText]); if (fireGlobals){globalEventContext.trigger("ajaxComplete", [jqXHR, s]); if (!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR}, getJSON:function(url, data, callback){return jQuery.get(url, data, callback, "json")}, getScript:function(url, callback){return jQuery.get(url, undefined, callback, "script")}}); jQuery.each(["get", "post"], function(i, method){jQuery[method] = function(url, data, callback, type){if (jQuery.isFunction(data)){type = type || callback; callback = data; data = undefined}return jQuery.ajax({url:url, type:method, dataType:type, data:data, success:callback})}}); jQuery._evalUrl = function(url){return jQuery.ajax({url:url, type:"GET", dataType:"script", async:false, global:false, throws:true})}; jQuery.fn.extend({wrapAll:function(html){var wrap; if (jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this, i))})}if (this[0]){wrap = jQuery(html, this[0].ownerDocument).eq(0).clone(true); if (this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem = this; while (elem.firstElementChild){elem = elem.firstElementChild}return elem}).append(this)}return this}, wrapInner:function(html){if (jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this, i))})}return this.each(function(){var self = jQuery(this), contents = self.contents(); if (contents.length){contents.wrapAll(html)} else{self.append(html)}})}, wrap:function(html){var isFunction = jQuery.isFunction(html); return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this, i):html)})}, unwrap:function(){return this.parent().each(function(){if (!jQuery.nodeName(this, "body")){jQuery(this).replaceWith(this.childNodes)}}).end()}}); jQuery.expr.filters.hidden = function(elem){return elem.offsetWidth <= 0 && elem.offsetHeight <= 0}; jQuery.expr.filters.visible = function(elem){return!jQuery.expr.filters.hidden(elem)}; var r20 = /%20/g, rbracket = /\[\]$/, rCRLF = /\r?\n/g, rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i, rsubmittable = /^(?:input|select|textarea|keygen)/i; function buildParams(prefix, obj, traditional, add){var name; if (jQuery.isArray(obj)){jQuery.each(obj, function(i, v){if (traditional || rbracket.test(prefix)){add(prefix, v)} else{buildParams(prefix + "[" + (typeof v === "object"?i:"") + "]", v, traditional, add)}})} else if (!traditional && jQuery.type(obj) === "object"){for (name in obj){buildParams(prefix + "[" + name + "]", obj[name], traditional, add)}} else{add(prefix, obj)}}jQuery.param = function(a, traditional){var prefix, s = [], add = function(key, value){value = jQuery.isFunction(value)?value():value == null?"":value; s[s.length] = encodeURIComponent(key) + "=" + encodeURIComponent(value)}; if (traditional === undefined){traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional}if (jQuery.isArray(a) || a.jquery && !jQuery.isPlainObject(a)){jQuery.each(a, function(){add(this.name, this.value)})} else{for (prefix in a){buildParams(prefix, a[prefix], traditional, add)}}return s.join("&").replace(r20, "+")}; jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())}, serializeArray:function(){return this.map(function(){var elements = jQuery.prop(this, "elements"); return elements?jQuery.makeArray(elements):this}).filter(function(){var type = this.type; return this.name && !jQuery(this).is(":disabled") && rsubmittable.test(this.nodeName) && !rsubmitterTypes.test(type) && (this.checked || !rcheckableType.test(type))}).map(function(i, elem){var val = jQuery(this).val(); return val == null?null:jQuery.isArray(val)?jQuery.map(val, function(val){return{name:elem.name, value:val.replace(rCRLF, "\r\n")}}):{name:elem.name, value:val.replace(rCRLF, "\r\n")}}).get()}}); jQuery.ajaxSettings.xhr = function(){try{return new XMLHttpRequest} catch (e){}}; var xhrId = 0, xhrCallbacks = {}, xhrSuccessStatus = {0:200, 1223:204}, xhrSupported = jQuery.ajaxSettings.xhr(); if (window.attachEvent){window.attachEvent("onunload", function(){for (var key in xhrCallbacks){xhrCallbacks[key]()}})}support.cors = !!xhrSupported && "withCredentials"in xhrSupported; support.ajax = xhrSupported = !!xhrSupported; jQuery.ajaxTransport(function(options){var callback; if (support.cors || xhrSupported && !options.crossDomain){return{send:function(headers, complete){var i, xhr = options.xhr(), id = ++xhrId; xhr.open(options.type, options.url, options.async, options.username, options.password); if (options.xhrFields){for (i in options.xhrFields){xhr[i] = options.xhrFields[i]}}if (options.mimeType && xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if (!options.crossDomain && !headers["X-Requested-With"]){headers["X-Requested-With"] = "XMLHttpRequest"}for (i in headers){xhr.setRequestHeader(i, headers[i])}callback = function(type){return function(){if (callback){delete xhrCallbacks[id]; callback = xhr.onload = xhr.onerror = null; if (type === "abort"){xhr.abort()} else if (type === "error"){complete(xhr.status, xhr.statusText)} else{complete(xhrSuccessStatus[xhr.status] || xhr.status, xhr.statusText, typeof xhr.responseText === "string"?{text:xhr.responseText}:undefined, xhr.getAllResponseHeaders())}}}}; xhr.onload = callback(); xhr.onerror = callback("error"); callback = xhrCallbacks[id] = callback("abort"); try{xhr.send(options.hasContent && options.data || null)} catch (e){if (callback){throw e}}}, abort:function(){if (callback){callback()}}}}}); jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents:{script:/(?:java|ecma)script/}, converters:{"text script":function(text){jQuery.globalEval(text); return text}}}); jQuery.ajaxPrefilter("script", function(s){if (s.cache === undefined){s.cache = false}if (s.crossDomain){s.type = "GET"}}); jQuery.ajaxTransport("script", function(s){if (s.crossDomain){var script, callback; return{send:function(_, complete){script = jQuery("<script>").prop({async:true, charset:s.scriptCharset, src:s.url}).on("load error", callback = function(evt){script.remove(); callback = null; if (evt){complete(evt.type === "error"?404:200, evt.type)}}); document.head.appendChild(script[0])}, abort:function(){if (callback){callback()}}}}}); var oldCallbacks = [], rjsonp = /(=)\?(?=&|$)|\?\?/; jQuery.ajaxSetup({jsonp:"callback", jsonpCallback:function(){var callback = oldCallbacks.pop() || jQuery.expando + "_" + nonce++; this[callback] = true; return callback}}); jQuery.ajaxPrefilter("json jsonp", function(s, originalSettings, jqXHR){var callbackName, overwritten, responseContainer, jsonProp = s.jsonp !== false && (rjsonp.test(s.url)?"url":typeof s.data === "string" && !(s.contentType || "").indexOf("application/x-www-form-urlencoded") && rjsonp.test(s.data) && "data"); if (jsonProp || s.dataTypes[0] === "jsonp"){callbackName = s.jsonpCallback = jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback; if (jsonProp){s[jsonProp] = s[jsonProp].replace(rjsonp, "$1" + callbackName)} else if (s.jsonp !== false){s.url += (rquery.test(s.url)?"&":"?") + s.jsonp + "=" + callbackName}s.converters["script json"] = function(){if (!responseContainer){jQuery.error(callbackName + " was not called")}return responseContainer[0]}; s.dataTypes[0] = "json"; overwritten = window[callbackName]; window[callbackName] = function(){responseContainer = arguments}; jqXHR.always(function(){window[callbackName] = overwritten; if (s[callbackName]){s.jsonpCallback = originalSettings.jsonpCallback; oldCallbacks.push(callbackName)}if (responseContainer && jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer = overwritten = undefined}); return"script"}}); jQuery.parseHTML = function(data, context, keepScripts){if (!data || typeof data !== "string"){return null}if (typeof context === "boolean"){keepScripts = context; context = false}context = context || document; var parsed = rsingleTag.exec(data), scripts = !keepScripts && []; if (parsed){return[context.createElement(parsed[1])]}parsed = jQuery.buildFragment([data], context, scripts); if (scripts && scripts.length){jQuery(scripts).remove()}return jQuery.merge([], parsed.childNodes)}; var _load = jQuery.fn.load; jQuery.fn.load = function(url, params, callback){if (typeof url !== "string" && _load){return _load.apply(this, arguments)}var selector, type, response, self = this, off = url.indexOf(" "); if (off >= 0){selector = jQuery.trim(url.slice(off)); url = url.slice(0, off)}if (jQuery.isFunction(params)){callback = params; params = undefined} else if (params && typeof params === "object"){type = "POST"}if (self.length > 0){jQuery.ajax({url:url, type:type, dataType:"html", data:params}).done(function(responseText){response = arguments; self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback && function(jqXHR, status){self.each(callback, response || [jqXHR.responseText, status, jqXHR])})}return this}; jQuery.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function(i, type){jQuery.fn[type] = function(fn){return this.on(type, fn)}}); jQuery.expr.filters.animated = function(elem){return jQuery.grep(jQuery.timers, function(fn){return elem === fn.elem}).length}; var docElem = window.document.documentElement; function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType === 9 && elem.defaultView}jQuery.offset = {setOffset:function(elem, options, i){var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = jQuery.css(elem, "position"), curElem = jQuery(elem), props = {}; if (position === "static"){elem.style.position = "relative"}curOffset = curElem.offset(); curCSSTop = jQuery.css(elem, "top"); curCSSLeft = jQuery.css(elem, "left"); calculatePosition = (position === "absolute" || position === "fixed") && (curCSSTop + curCSSLeft).indexOf("auto") > - 1; if (calculatePosition){curPosition = curElem.position(); curTop = curPosition.top; curLeft = curPosition.left} else{curTop = parseFloat(curCSSTop) || 0; curLeft = parseFloat(curCSSLeft) || 0}if (jQuery.isFunction(options)){options = options.call(elem, i, curOffset)}if (options.top != null){props.top = options.top - curOffset.top + curTop}if (options.left != null){props.left = options.left - curOffset.left + curLeft}if ("using"in options){options.using.call(elem, props)} else{curElem.css(props)}}}; jQuery.fn.extend({offset:function(options){if (arguments.length){return options === undefined?this:this.each(function(i){jQuery.offset.setOffset(this, options, i)})}var docElem, win, elem = this[0], box = {top:0, left:0}, doc = elem && elem.ownerDocument; if (!doc){return}docElem = doc.documentElement; if (!jQuery.contains(docElem, elem)){return box}if (typeof elem.getBoundingClientRect !== strundefined){box = elem.getBoundingClientRect()}win = getWindow(doc); return{top:box.top + win.pageYOffset - docElem.clientTop, left:box.left + win.pageXOffset - docElem.clientLeft}}, position:function(){if (!this[0]){return}var offsetParent, offset, elem = this[0], parentOffset = {top:0, left:0}; if (jQuery.css(elem, "position") === "fixed"){offset = elem.getBoundingClientRect()} else{offsetParent = this.offsetParent(); offset = this.offset(); if (!jQuery.nodeName(offsetParent[0], "html")){parentOffset = offsetParent.offset()}parentOffset.top += jQuery.css(offsetParent[0], "borderTopWidth", true); parentOffset.left += jQuery.css(offsetParent[0], "borderLeftWidth", true)}return{top:offset.top - parentOffset.top - jQuery.css(elem, "marginTop", true), left:offset.left - parentOffset.left - jQuery.css(elem, "marginLeft", true)}}, offsetParent:function(){return this.map(function(){var offsetParent = this.offsetParent || docElem; while (offsetParent && (!jQuery.nodeName(offsetParent, "html") && jQuery.css(offsetParent, "position") === "static")){offsetParent = offsetParent.offsetParent}return offsetParent || docElem})}}); jQuery.each({scrollLeft:"pageXOffset", scrollTop:"pageYOffset"}, function(method, prop){var top = "pageYOffset" === prop; jQuery.fn[method] = function(val){return access(this, function(elem, method, val){var win = getWindow(elem); if (val === undefined){return win?win[prop]:elem[method]}if (win){win.scrollTo(!top?val:window.pageXOffset, top?val:window.pageYOffset)} else{elem[method] = val}}, method, val, arguments.length, null)}}); jQuery.each(["top", "left"], function(i, prop){jQuery.cssHooks[prop] = addGetHookIf(support.pixelPosition, function(elem, computed){if (computed){computed = curCSS(elem, prop); return rnumnonpx.test(computed)?jQuery(elem).position()[prop] + "px":computed}})}); jQuery.each({Height:"height", Width:"width"}, function(name, type){jQuery.each({padding:"inner" + name, content:type, "":"outer" + name}, function(defaultExtra, funcName){jQuery.fn[funcName] = function(margin, value){var chainable = arguments.length && (defaultExtra || typeof margin !== "boolean"), extra = defaultExtra || (margin === true || value === true?"margin":"border"); return access(this, function(elem, type, value){var doc; if (jQuery.isWindow(elem)){return elem.document.documentElement["client" + name]}if (elem.nodeType === 9){doc = elem.documentElement; return Math.max(elem.body["scroll" + name], doc["scroll" + name], elem.body["offset" + name], doc["offset" + name], doc["client" + name])}return value === undefined?jQuery.css(elem, type, extra):jQuery.style(elem, type, value, extra)}, type, chainable?margin:undefined, chainable, null)}})}); jQuery.fn.size = function(){return this.length}; jQuery.fn.andSelf = jQuery.fn.addBack; if (typeof define === "function" && define.amd){define("jquery", [], function(){return jQuery})}var _jQuery = window.jQuery, _$ = window.$; jQuery.noConflict = function(deep){if (window.$ === jQuery){window.$ = _$}if (deep && window.jQuery === jQuery){window.jQuery = _jQuery}return jQuery}; if (typeof noGlobal === strundefined){window.jQuery = window.$ = jQuery}return jQuery}); (function($){var Base64 = function(){var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="; var obj = {encode:function(input){var output = ""; var chr1, chr2, chr3; var enc1, enc2, enc3, enc4; var i = 0; do{chr1 = input.charCodeAt(i++); chr2 = input.charCodeAt(i++); chr3 = input.charCodeAt(i++); enc1 = chr1 >> 2; enc2 = (chr1 & 3) << 4 | chr2 >> 4; enc3 = (chr2 & 15) << 2 | chr3 >> 6; enc4 = chr3 & 63; if (isNaN(chr2)){enc3 = enc4 = 64} else if (isNaN(chr3)){enc4 = 64}output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4)}while (i < input.length); return output}, decode:function(input){var output = ""; var chr1, chr2, chr3; var enc1, enc2, enc3, enc4; var i = 0; input = input.replace(/[^A-Za-z0-9\+\/\=]/g, ""); do{enc1 = keyStr.indexOf(input.charAt(i++)); enc2 = keyStr.indexOf(input.charAt(i++)); enc3 = keyStr.indexOf(input.charAt(i++)); enc4 = keyStr.indexOf(input.charAt(i++)); chr1 = enc1 << 2 | enc2 >> 4; chr2 = (enc2 & 15) << 4 | enc3 >> 2; chr3 = (enc3 & 3) << 6 | enc4; output = output + String.fromCharCode(chr1); if (enc3 != 64){output = output + String.fromCharCode(chr2)}if (enc4 != 64){output = output + String.fromCharCode(chr3)}}while (i < input.length); return output}}; return obj}(); var MD5 = function(){var hexcase = 0; var b64pad = ""; var chrsz = 8; var safe_add = function(x, y){var lsw = (x & 65535) + (y & 65535); var msw = (x >> 16) + (y >> 16) + (lsw >> 16); return msw << 16 | lsw & 65535}; var bit_rol = function(num, cnt){return num << cnt | num >>> 32 - cnt}; var str2binl = function(str){var bin = []; var mask = (1 << chrsz) - 1; for (var i = 0; i < str.length * chrsz; i += chrsz){bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << i % 32}return bin}; var binl2str = function(bin){var str = ""; var mask = (1 << chrsz) - 1; for (var i = 0; i < bin.length * 32; i += chrsz){str += String.fromCharCode(bin[i >> 5] >>> i % 32 & mask)}return str}; var binl2hex = function(binarray){var hex_tab = hexcase?"0123456789ABCDEF":"0123456789abcdef"; var str = ""; for (var i = 0; i < binarray.length * 4; i++){str += hex_tab.charAt(binarray[i >> 2] >> i % 4 * 8 + 4 & 15) + hex_tab.charAt(binarray[i >> 2] >> i % 4 * 8 & 15)}return str}; var binl2b64 = function(binarray){var tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"; var str = ""; var triplet, j; for (var i = 0; i < binarray.length * 4; i += 3){triplet = (binarray[i >> 2] >> 8 * (i % 4) & 255) << 16 | (binarray[i + 1 >> 2] >> 8 * ((i + 1) % 4) & 255) << 8 | binarray[i + 2 >> 2] >> 8 * ((i + 2) % 4) & 255; for (j = 0; j < 4; j++){if (i * 8 + j * 6 > binarray.length * 32){str += b64pad} else{str += tab.charAt(triplet >> 6 * (3 - j) & 63)}}}return str}; var md5_cmn = function(q, a, b, x, s, t){return safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s), b)}; var md5_ff = function(a, b, c, d, x, s, t){return md5_cmn(b & c | ~b & d, a, b, x, s, t)}; var md5_gg = function(a, b, c, d, x, s, t){return md5_cmn(b & d | c & ~d, a, b, x, s, t)}; var md5_hh = function(a, b, c, d, x, s, t){return md5_cmn(b ^ c ^ d, a, b, x, s, t)}; var md5_ii = function(a, b, c, d, x, s, t){return md5_cmn(c ^ (b | ~d), a, b, x, s, t)}; var core_md5 = function(x, len){x[len >> 5] |= 128 << len % 32; x[(len + 64 >>> 9 << 4) + 14] = len; var a = 1732584193; var b = - 271733879; var c = - 1732584194; var d = 271733878; var olda, oldb, oldc, oldd; for (var i = 0; i < x.length; i += 16){olda = a; oldb = b; oldc = c; oldd = d; a = md5_ff(a, b, c, d, x[i + 0], 7, - 680876936); d = md5_ff(d, a, b, c, x[i + 1], 12, - 389564586); c = md5_ff(c, d, a, b, x[i + 2], 17, 606105819); b = md5_ff(b, c, d, a, x[i + 3], 22, - 1044525330); a = md5_ff(a, b, c, d, x[i + 4], 7, - 176418897); d = md5_ff(d, a, b, c, x[i + 5], 12, 1200080426); c = md5_ff(c, d, a, b, x[i + 6], 17, - 1473231341); b = md5_ff(b, c, d, a, x[i + 7], 22, - 45705983); a = md5_ff(a, b, c, d, x[i + 8], 7, 1770035416); d = md5_ff(d, a, b, c, x[i + 9], 12, - 1958414417); c = md5_ff(c, d, a, b, x[i + 10], 17, - 42063); b = md5_ff(b, c, d, a, x[i + 11], 22, - 1990404162); a = md5_ff(a, b, c, d, x[i + 12], 7, 1804603682); d = md5_ff(d, a, b, c, x[i + 13], 12, - 40341101); c = md5_ff(c, d, a, b, x[i + 14], 17, - 1502002290); b = md5_ff(b, c, d, a, x[i + 15], 22, 1236535329); a = md5_gg(a, b, c, d, x[i + 1], 5, - 165796510); d = md5_gg(d, a, b, c, x[i + 6], 9, - 1069501632); c = md5_gg(c, d, a, b, x[i + 11], 14, 643717713); b = md5_gg(b, c, d, a, x[i + 0], 20, - 373897302); a = md5_gg(a, b, c, d, x[i + 5], 5, - 701558691); d = md5_gg(d, a, b, c, x[i + 10], 9, 38016083); c = md5_gg(c, d, a, b, x[i + 15], 14, - 660478335); b = md5_gg(b, c, d, a, x[i + 4], 20, - 405537848); a = md5_gg(a, b, c, d, x[i + 9], 5, 568446438); d = md5_gg(d, a, b, c, x[i + 14], 9, - 1019803690); c = md5_gg(c, d, a, b, x[i + 3], 14, - 187363961); b = md5_gg(b, c, d, a, x[i + 8], 20, 1163531501); a = md5_gg(a, b, c, d, x[i + 13], 5, - 1444681467); d = md5_gg(d, a, b, c, x[i + 2], 9, - 51403784); c = md5_gg(c, d, a, b, x[i + 7], 14, 1735328473); b = md5_gg(b, c, d, a, x[i + 12], 20, - 1926607734); a = md5_hh(a, b, c, d, x[i + 5], 4, - 378558); d = md5_hh(d, a, b, c, x[i + 8], 11, - 2022574463); c = md5_hh(c, d, a, b, x[i + 11], 16, 1839030562); b = md5_hh(b, c, d, a, x[i + 14], 23, - 35309556); a = md5_hh(a, b, c, d, x[i + 1], 4, - 1530992060); d = md5_hh(d, a, b, c, x[i + 4], 11, 1272893353); c = md5_hh(c, d, a, b, x[i + 7], 16, - 155497632); b = md5_hh(b, c, d, a, x[i + 10], 23, - 1094730640); a = md5_hh(a, b, c, d, x[i + 13], 4, 681279174); d = md5_hh(d, a, b, c, x[i + 0], 11, - 358537222); c = md5_hh(c, d, a, b, x[i + 3], 16, - 722521979); b = md5_hh(b, c, d, a, x[i + 6], 23, 76029189); a = md5_hh(a, b, c, d, x[i + 9], 4, - 640364487); d = md5_hh(d, a, b, c, x[i + 12], 11, - 421815835); c = md5_hh(c, d, a, b, x[i + 15], 16, 530742520); b = md5_hh(b, c, d, a, x[i + 2], 23, - 995338651); a = md5_ii(a, b, c, d, x[i + 0], 6, - 198630844); d = md5_ii(d, a, b, c, x[i + 7], 10, 1126891415); c = md5_ii(c, d, a, b, x[i + 14], 15, - 1416354905); b = md5_ii(b, c, d, a, x[i + 5], 21, - 57434055); a = md5_ii(a, b, c, d, x[i + 12], 6, 1700485571); d = md5_ii(d, a, b, c, x[i + 3], 10, - 1894986606); c = md5_ii(c, d, a, b, x[i + 10], 15, - 1051523); b = md5_ii(b, c, d, a, x[i + 1], 21, - 2054922799); a = md5_ii(a, b, c, d, x[i + 8], 6, 1873313359); d = md5_ii(d, a, b, c, x[i + 15], 10, - 30611744); c = md5_ii(c, d, a, b, x[i + 6], 15, - 1560198380); b = md5_ii(b, c, d, a, x[i + 13], 21, 1309151649); a = md5_ii(a, b, c, d, x[i + 4], 6, - 145523070); d = md5_ii(d, a, b, c, x[i + 11], 10, - 1120210379); c = md5_ii(c, d, a, b, x[i + 2], 15, 718787259); b = md5_ii(b, c, d, a, x[i + 9], 21, - 343485551); a = safe_add(a, olda); b = safe_add(b, oldb); c = safe_add(c, oldc); d = safe_add(d, oldd)}return[a, b, c, d]}; var core_hmac_md5 = function(key, data){var bkey = str2binl(key); if (bkey.length > 16){bkey = core_md5(bkey, key.length * chrsz)}var ipad = new Array(16), opad = new Array(16); for (var i = 0; i < 16; i++){ipad[i] = bkey[i] ^ 909522486; opad[i] = bkey[i] ^ 1549556828}var hash = core_md5(ipad.concat(str2binl(data)), 512 + data.length * chrsz); return core_md5(opad.concat(hash), 512 + 128)}; var obj = {hexdigest:function(s){return binl2hex(core_md5(str2binl(s), s.length * chrsz))}, b64digest:function(s){return binl2b64(core_md5(str2binl(s), s.length * chrsz))}, hash:function(s){return binl2str(core_md5(str2binl(s), s.length * chrsz))}, hmac_hexdigest:function(key, data){return binl2hex(core_hmac_md5(key, data))}, hmac_b64digest:function(key, data){return binl2b64(core_hmac_md5(key, data))}, hmac_hash:function(key, data){return binl2str(core_hmac_md5(key, data))}, test:function(){return MD5.hexdigest("abc") === "900150983cd24fb0d6963f7d28e17f72"}}; return obj}(); if (!Function.prototype.bind){Function.prototype.bind = function(obj){var func = this; return function(){return func.apply(obj, arguments)}}}if (!Function.prototype.prependArg){Function.prototype.prependArg = function(arg){var func = this; return function(){var newargs = [arg]; for (var i = 0; i < arguments.length; i++){newargs.push(arguments[i])}return func.apply(this, newargs)}}}if (!Array.prototype.indexOf){Array.prototype.indexOf = function(elt){var len = this.length; var from = Number(arguments[1]) || 0; from = from < 0?Math.ceil(from):Math.floor(from); if (from < 0){from += len}for (; from < len; from++){if (from in this && this[from] === elt){return from}}return - 1}}(function(callback){var Strophe; function $build(name, attrs){return new Strophe.Builder(name, attrs)}function $msg(attrs){return new Strophe.Builder("message", attrs)}function $iq(attrs){return new Strophe.Builder("iq", attrs)}function $pres(attrs){return new Strophe.Builder("presence", attrs)}Strophe = {VERSION:"1.0.1", NS:{HTTPBIND:"http://jabber.org/protocol/httpbind", BOSH:"urn:xmpp:xbosh", CLIENT:"jabber:client", AUTH:"jabber:iq:auth", ROSTER:"jabber:iq:roster", PROFILE:"jabber:iq:profile", DISCO_INFO:"http://jabber.org/protocol/disco#info", DISCO_ITEMS:"http://jabber.org/protocol/disco#items", MUC:"http://jabber.org/protocol/muc", SASL:"urn:ietf:params:xml:ns:xmpp-sasl", STREAM:"http://etherx.jabber.org/streams", BIND:"urn:ietf:params:xml:ns:xmpp-bind", SESSION:"urn:ietf:params:xml:ns:xmpp-session", VERSION:"jabber:iq:version", STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"}, addNamespace:function(name, value){Strophe.NS[name] = value}, Status:{ERROR:0, CONNECTING:1, CONNFAIL:2, AUTHENTICATING:3, AUTHFAIL:4, CONNECTED:5, DISCONNECTED:6, DISCONNECTING:7, ATTACHED:8}, LogLevel:{DEBUG:0, INFO:1, WARN:2, ERROR:3, FATAL:4}, ElementType:{NORMAL:1, TEXT:3}, TIMEOUT:1.1, SECONDARY_TIMEOUT:.1, forEachChild:function(elem, elemName, func){var i, childNode; for (i = 0; i < elem.childNodes.length; i++){childNode = elem.childNodes[i]; if (childNode.nodeType == Strophe.ElementType.NORMAL && (!elemName || this.isTagEqual(childNode, elemName))){func(childNode)}}}, isTagEqual:function(el, name){return el.tagName.toLowerCase() == name.toLowerCase()}, _xmlGenerator:null, _makeGenerator:function(){var doc; if (window.ActiveXObject){doc = new ActiveXObject("Microsoft.XMLDOM"); doc.appendChild(doc.createElement("strophe"))} else{doc = document.implementation.createDocument("jabber:client", "strophe", null)}return doc}, xmlElement:function(name){if (!name){return null}var node = null; if (!Strophe._xmlGenerator){Strophe._xmlGenerator = Strophe._makeGenerator()}node = Strophe._xmlGenerator.createElement(name); var a, i, k; for (a = 1; a < arguments.length; a++){if (!arguments[a]){continue}if (typeof arguments[a] == "string" || typeof arguments[a] == "number"){node.appendChild(Strophe.xmlTextNode(arguments[a]))} else if (typeof arguments[a] == "object" && typeof arguments[a].sort == "function"){for (i = 0; i < arguments[a].length; i++){if (typeof arguments[a][i] == "object" && typeof arguments[a][i].sort == "function"){node.setAttribute(arguments[a][i][0], arguments[a][i][1])}}} else if (typeof arguments[a] == "object"){for (k in arguments[a]){if (arguments[a].hasOwnProperty(k)){node.setAttribute(k, arguments[a][k])}}}}return node}, xmlescape:function(text){if (!text)return""; if (text.constructor != Array){text = text.replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")} else{for (var i = 0; i < text.length; i++){text[i] = text[i].replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")}}return text}, xmlTextNode:function(text){text = Strophe.xmlescape(text); if (!Strophe._xmlGenerator){Strophe._xmlGenerator = Strophe._makeGenerator()}return Strophe._xmlGenerator.createTextNode(text)}, getText:function(elem){if (!elem){return null}var str = ""; if (elem.childNodes.length === 0 && elem.nodeType == Strophe.ElementType.TEXT){str += elem.nodeValue}for (var i = 0; i < elem.childNodes.length; i++){if (elem.childNodes[i].nodeType == Strophe.ElementType.TEXT){str += elem.childNodes[i].nodeValue}}return str}, copyElement:function(elem){var i, el; if (elem.nodeType == Strophe.ElementType.NORMAL){el = Strophe.xmlElement(elem.tagName); for (i = 0; i < elem.attributes.length; i++){el.setAttribute(elem.attributes[i].nodeName.toLowerCase(), elem.attributes[i].value)}for (i = 0; i < elem.childNodes.length; i++){el.appendChild(Strophe.copyElement(elem.childNodes[i]))}} else if (elem.nodeType == Strophe.ElementType.TEXT){el = Strophe.xmlTextNode(elem.nodeValue)}return el}, escapeNode:function(node){return node.replace(/^\s+|\s+$/g, "").replace(/\\/g, "\\5c").replace(/ /g, "\\20").replace(/\"/g, "\\22").replace(/\&/g, "\\26").replace(/\'/g, "\\27").replace(/\//g, "\\2f").replace(/:/g, "\\3a").replace(/</g, "\\3c").replace(/>/g, "\\3e").replace(/@/g, "\\40")}, unescapeNode:function(node){return node.replace(/\\20/g, " ").replace(/\\22/g, '"').replace(/\\26/g, "&").replace(/\\27/g, "'").replace(/\\2f/g, "/").replace(/\\3a/g, ":").replace(/\\3c/g, "<").replace(/\\3e/g, ">").replace(/\\40/g, "@").replace(/\\5c/g, "\\")}, getNodeFromJid:function(jid){if (jid.indexOf("@") < 0){return null}return jid.split("@")[0]}, getDomainFromJid:function(jid){var bare = Strophe.getBareJidFromJid(jid); if (bare.indexOf("@") < 0){return bare} else{var parts = bare.split("@"); parts.splice(0, 1); return parts.join("@")}}, getResourceFromJid:function(jid){var s = jid.split("/"); if (s.length < 2){return null}s.splice(0, 1); return s.join("/")}, getBareJidFromJid:function(jid){return jid.split("/")[0]}, log:function(level, msg){return}, debug:function(msg){this.log(this.LogLevel.DEBUG, msg)}, info:function(msg){this.log(this.LogLevel.INFO, msg)}, warn:function(msg){this.log(this.LogLevel.WARN, msg)}, error:function(msg){this.log(this.LogLevel.ERROR, msg)}, fatal:function(msg){this.log(this.LogLevel.FATAL, msg)}, serialize:function(elem){var result; if (!elem){return null}if (typeof elem.tree === "function"){elem = elem.tree()}var nodeName = elem.nodeName; var i, child; if (elem.getAttribute("_realname")){nodeName = elem.getAttribute("_realname")}result = "<" + nodeName; for (i = 0; i < elem.attributes.length; i++){if (elem.attributes[i].nodeName != "_realname"){result += " " + elem.attributes[i].nodeName.toLowerCase() + "='" + elem.attributes[i].value.replace("&", "&amp;").replace("'", "&apos;").replace("<", "&lt;") + "'"}}if (elem.childNodes.length > 0){result += ">"; for (i = 0; i < elem.childNodes.length; i++){child = elem.childNodes[i]; if (child.nodeType == Strophe.ElementType.NORMAL){result += Strophe.serialize(child)} else if (child.nodeType == Strophe.ElementType.TEXT){result += child.nodeValue}}result += "</" + nodeName + ">"} else{result += "/>"}return result}, _requestId:0, _connectionPlugins:{}, addConnectionPlugin:function(name, ptype){Strophe._connectionPlugins[name] = ptype}}; Strophe.Builder = function(name, attrs){if (name == "presence" || name == "message" || name == "iq"){if (attrs && !attrs.xmlns){attrs.xmlns = Strophe.NS.CLIENT} else if (!attrs){attrs = {xmlns:Strophe.NS.CLIENT}}}this.nodeTree = Strophe.xmlElement(name, attrs); this.node = this.nodeTree}; Strophe.Builder.prototype = {tree:function(){return this.nodeTree}, toString:function(){return Strophe.serialize(this.nodeTree)}, up:function(){this.node = this.node.parentNode; return this}, attrs:function(moreattrs){for (var k in moreattrs){if (moreattrs.hasOwnProperty(k)){this.node.setAttribute(k, moreattrs[k])}}return this}, c:function(name, attrs){var child = Strophe.xmlElement(name, attrs); this.node.appendChild(child); this.node = child; return this}, cnode:function(elem){this.node.appendChild(elem); this.node = elem; return this}, t:function(text){var child = Strophe.xmlTextNode(text); this.node.appendChild(child); return this}}; Strophe.Handler = function(handler, ns, name, type, id, from, options){this.handler = handler; this.ns = ns; this.name = name; this.type = type; this.id = id; this.options = options || {matchbare:false}; if (!this.options.matchBare){this.options.matchBare = false}if (this.options.matchBare){this.from = Strophe.getBareJidFromJid(from)} else{this.from = from}this.user = true}; Strophe.Handler.prototype = {isMatch:function(elem){var nsMatch; var from = null; if (this.options.matchBare){from = Strophe.getBareJidFromJid(elem.getAttribute("from"))} else{from = elem.getAttribute("from")}nsMatch = false; if (!this.ns){nsMatch = true} else{var self = this; Strophe.forEachChild(elem, null, function(elem){if (elem.getAttribute("xmlns") == self.ns){nsMatch = true}}); nsMatch = nsMatch || elem.getAttribute("xmlns") == this.ns}if (nsMatch && (!this.name || Strophe.isTagEqual(elem, this.name)) && (!this.type || elem.getAttribute("type") === this.type) && (!this.id || elem.getAttribute("id") === this.id) && (!this.from || from === this.from)){return true}return false}, run:function(elem){var result = null; try{result = this.handler(elem)} catch (e){if (e.sourceURL){Strophe.fatal("error: " + this.handler + " " + e.sourceURL + ":" + e.line + " - " + e.name + ": " + e.message)} else if (e.fileName){if (typeof console != "undefined"){console.trace(); console.error(this.handler, " - error - ", e, e.message)}Strophe.fatal("error: " + this.handler + " " + e.fileName + ":" + e.lineNumber + " - " + e.name + ": " + e.message)} else{Strophe.fatal("error: " + this.handler)}throw e}return result}, toString:function(){return"{Handler: " + this.handler + "(" + this.name + "," + this.id + "," + this.ns + ")}"}}; Strophe.TimedHandler = function(period, handler){this.period = period; this.handler = handler; this.lastCalled = (new Date).getTime(); this.user = true}; Strophe.TimedHandler.prototype = {run:function(){this.lastCalled = (new Date).getTime(); return this.handler()}, reset:function(){this.lastCalled = (new Date).getTime()}, toString:function(){return"{TimedHandler: " + this.handler + "(" + this.period + ")}"}}; Strophe.Request = function(elem, func, rid, sends){this.id = ++Strophe._requestId; this.xmlData = elem; this.data = Strophe.serialize(elem); this.origFunc = func; this.func = func; this.rid = rid; this.date = NaN; this.sends = sends || 0; this.abort = false; this.dead = null; this.age = function(){if (!this.date){return 0}var now = new Date; return(now - this.date) / 1e3}; this.timeDead = function(){if (!this.dead){return 0}var now = new Date; return(now - this.dead) / 1e3}; this.xhr = this._newXHR()}; Strophe.Request.prototype = {getResponse:function(){var node = null; if (this.xhr.responseXML && this.xhr.responseXML.documentElement){node = this.xhr.responseXML.documentElement; if (node.tagName == "parsererror"){Strophe.error("invalid response received"); Strophe.error("responseText: " + this.xhr.responseText); Strophe.error("responseXML: " + Strophe.serialize(this.xhr.responseXML)); throw"parsererror"}} else if (this.xhr.responseText){Strophe.error("invalid response received"); Strophe.error("responseText: " + this.xhr.responseText); Strophe.error("responseXML: " + Strophe.serialize(this.xhr.responseXML))}return node}, _newXHR:function(){var xhr = null; if (window.XMLHttpRequest){xhr = new XMLHttpRequest; if (xhr.overrideMimeType){xhr.overrideMimeType("text/xml")}} else if (window.ActiveXObject){xhr = new ActiveXObject("Microsoft.XMLHTTP")}xhr.onreadystatechange = this.func.prependArg(this); return xhr}}; Strophe.Connection = function(service){this.service = service; this.jid = ""; this.rid = Math.floor(Math.random() * 4294967295); this.sid = null; this.streamId = null; this.do_session = false; this.do_bind = false; this.timedHandlers = []; this.handlers = []; this.removeTimeds = []; this.removeHandlers = []; this.addTimeds = []; this.addHandlers = []; this._idleTimeout = null; this._disconnectTimeout = null; this.authenticated = false; this.disconnecting = false; this.connected = false; this.errors = 0; this.paused = false; this.hold = 1; this.wait = 60; this.window = 5; this._data = []; this._requests = []; this._uniqueId = Math.round(Math.random() * 1e4); this._sasl_success_handler = null; this._sasl_failure_handler = null; this._sasl_challenge_handler = null; this._idleTimeout = setTimeout(this._onIdle.bind(this), 100); for (var k in Strophe._connectionPlugins){if (Strophe._connectionPlugins.hasOwnProperty(k)){var ptype = Strophe._connectionPlugins[k]; var F = function(){}; F.prototype = ptype; this[k] = new F; this[k].init(this)}}}; Strophe.Connection.prototype = {reset:function(){this.rid = Math.floor(Math.random() * 4294967295); this.sid = null; this.streamId = null; this.do_session = false; this.do_bind = false; this.timedHandlers = []; this.handlers = []; this.removeTimeds = []; this.removeHandlers = []; this.addTimeds = []; this.addHandlers = []; this.authenticated = false; this.disconnecting = false; this.connected = false; this.errors = 0; this._requests = []; this._uniqueId = Math.round(Math.random() * 1e4)}, pause:function(){this.paused = true}, resume:function(){this.paused = false}, getUniqueId:function(suffix){if (typeof suffix == "string" || typeof suffix == "number"){return++this._uniqueId + ":" + suffix} else{return++this._uniqueId + ""}}, connect:function(jid, pass, callback, wait, hold){this.jid = jid; this.pass = pass; this.connect_callback = callback; this.disconnecting = false; this.connected = false; this.authenticated = false; this.errors = 0; this.wait = wait || this.wait; this.hold = hold || this.hold; this.domain = Strophe.getDomainFromJid(this.jid); var body = this._buildBody().attrs({to:this.domain, "xml:lang":"en", wait:this.wait, hold:this.hold, content:"text/xml; charset=utf-8", ver:"1.6", "xmpp:version":"1.0", "xmlns:xmpp":Strophe.NS.BOSH}); this._changeConnectStatus(Strophe.Status.CONNECTING, null); this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)), body.tree().getAttribute("rid"))); this._throttledRequestHandler()}, attach:function(jid, sid, rid, callback, wait, hold, wind){this.jid = jid; this.sid = sid; this.rid = rid; this.connect_callback = callback; this.domain = Strophe.getDomainFromJid(this.jid); this.authenticated = true; this.connected = true; this.wait = wait || this.wait; this.hold = hold || this.hold; this.window = wind || this.window; this._changeConnectStatus(Strophe.Status.ATTACHED, null)}, xmlInput:function(elem){return}, xmlOutput:function(elem){return}, rawInput:function(data){return}, rawOutput:function(data){return}, send:function(elem){if (elem === null){return}if (typeof elem.sort === "function"){for (var i = 0; i < elem.length; i++){this._queueData(elem[i])}} else if (typeof elem.tree === "function"){this._queueData(elem.tree())} else{this._queueData(elem)}this._throttledRequestHandler(); clearTimeout(this._idleTimeout); this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)}, flush:function(){clearTimeout(this._idleTimeout); this._onIdle()}, sendIQ:function(elem, callback, errback, timeout){var timeoutHandler = null; var that = this; if (typeof elem.tree === "function"){elem = elem.tree()}var id = elem.getAttribute("id"); if (!id){id = this.getUniqueId("sendIQ"); elem.setAttribute("id", id)}var handler = this.addHandler(function(stanza){if (timeoutHandler){that.deleteTimedHandler(timeoutHandler)}var iqtype = stanza.getAttribute("type"); if (iqtype === "result"){if (callback){callback(stanza)}} else if (iqtype === "error"){if (errback){errback(stanza)}} else{throw{name:"StropheError", message:"Got bad IQ type of " + iqtype}}}, null, "iq", null, id); if (timeout){timeoutHandler = this.addTimedHandler(timeout, function(){that.deleteHandler(handler); if (errback){errback(null)}return false})}this.send(elem); return id}, _queueData:function(element){if (element === null || !element.tagName || !element.childNodes){throw{name:"StropheError", message:"Cannot queue non-DOMElement."}}this._data.push(element)}, _sendRestart:function(){this._data.push("restart"); this._throttledRequestHandler(); clearTimeout(this._idleTimeout); this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)}, addTimedHandler:function(period, handler){var thand = new Strophe.TimedHandler(period, handler); this.addTimeds.push(thand); return thand}, deleteTimedHandler:function(handRef){this.removeTimeds.push(handRef)}, addHandler:function(handler, ns, name, type, id, from, options){var hand = new Strophe.Handler(handler, ns, name, type, id, from, options); this.addHandlers.push(hand); return hand}, deleteHandler:function(handRef){this.removeHandlers.push(handRef)}, disconnect:function(reason){this._changeConnectStatus(Strophe.Status.DISCONNECTING, reason); Strophe.info("Disconnect was called because: " + reason); if (this.connected){this._disconnectTimeout = this._addSysTimedHandler(3e3, this._onDisconnectTimeout.bind(this)); this._sendTerminate()}}, _changeConnectStatus:function(status, condition){for (var k in Strophe._connectionPlugins){if (Strophe._connectionPlugins.hasOwnProperty(k)){var plugin = this[k]; if (plugin.statusChanged){try{plugin.statusChanged(status, condition)} catch (err){Strophe.error("" + k + " plugin caused an exception " + "changing status: " + err)}}}}if (this.connect_callback){try{this.connect_callback(status, condition)} catch (e){Strophe.error("User connection callback caused an " + "exception: " + e)}}}, _buildBody:function(){var bodyWrap = $build("body", {rid:this.rid++, xmlns:Strophe.NS.HTTPBIND}); if (this.sid !== null){bodyWrap.attrs({sid:this.sid})}return bodyWrap}, _removeRequest:function(req){Strophe.debug("removing request"); var i; for (i = this._requests.length - 1; i >= 0; i--){if (req == this._requests[i]){this._requests.splice(i, 1)}}req.xhr.onreadystatechange = function(){}; this._throttledRequestHandler()}, _restartRequest:function(i){var req = this._requests[i]; if (req.dead === null){req.dead = new Date}this._processRequest(i)}, _processRequest:function(i){var req = this._requests[i]; var reqStatus = - 1; try{if (req.xhr.readyState == 4){reqStatus = req.xhr.status}} catch (e){Strophe.error("caught an error in _requests[" + i + "], reqStatus: " + reqStatus)}if (typeof reqStatus == "undefined"){reqStatus = - 1}var time_elapsed = req.age(); var primaryTimeout = !isNaN(time_elapsed) && time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait); var secondaryTimeout = req.dead !== null && req.timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait); var requestCompletedWithServerError = req.xhr.readyState == 4 && (reqStatus < 1 || reqStatus >= 500); if (primaryTimeout || secondaryTimeout || requestCompletedWithServerError){if (secondaryTimeout){Strophe.error("Request " + this._requests[i].id + " timed out (secondary), restarting")}req.abort = true; req.xhr.abort(); req.xhr.onreadystatechange = function(){}; this._requests[i] = new Strophe.Request(req.xmlData, req.origFunc, req.rid, req.sends); req = this._requests[i]}if (req.xhr.readyState === 0){Strophe.debug("request id " + req.id + "." + req.sends + " posting"); req.date = new Date; try{req.xhr.open("POST", this.service, true)} catch (e2){Strophe.error("XHR open failed: " + e2.message); if (!this.connected){this._changeConnectStatus(Strophe.Status.CONNFAIL, "bad-service")}this.disconnect(); return}var sendFunc = function(){req.xhr.send(req.data)}; if (req.sends > 1){var backoff = Math.pow(req.sends, 3) * 1e3; setTimeout(sendFunc, backoff)} else{sendFunc()}req.sends++; this.xmlOutput(req.xmlData); this.rawOutput(req.data)} else{Strophe.debug("_processRequest: " + (i === 0?"first":"second") + " request has readyState of " + req.xhr.readyState)}}, _throttledRequestHandler:function(){if (!this._requests){Strophe.debug("_throttledRequestHandler called with " + "undefined requests")} else{Strophe.debug("_throttledRequestHandler called with " + this._requests.length + " requests")}if (!this._requests || this._requests.length === 0){return}if (this._requests.length > 0){this._processRequest(0)}if (this._requests.length > 1 && Math.abs(this._requests[0].rid - this._requests[1].rid) < this.window - 1){this._processRequest(1)}}, _onRequestStateChange:function(func, req){Strophe.debug("request id " + req.id + "." + req.sends + " state changed to " + req.xhr.readyState); if (req.abort){req.abort = false; return}var reqStatus; if (req.xhr.readyState == 4){reqStatus = 0; try{reqStatus = req.xhr.status} catch (e){}if (typeof reqStatus == "undefined"){reqStatus = 0}if (this.disconnecting){if (reqStatus >= 400){this._hitError(reqStatus); return}}var reqIs0 = this._requests[0] == req; var reqIs1 = this._requests[1] == req; if (reqStatus > 0 && reqStatus < 500 || req.sends > 5){this._removeRequest(req); Strophe.debug("request id " + req.id + " should now be removed")}if (reqStatus == 200){if (reqIs1 || reqIs0 && this._requests.length > 0 && this._requests[0].age() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)){this._restartRequest(0)}Strophe.debug("request id " + req.id + "." + req.sends + " got 200"); func(req); this.errors = 0} else{Strophe.error("request id " + req.id + "." + req.sends + " error " + reqStatus + " happened"); if (reqStatus === 0 || reqStatus >= 400 && reqStatus < 600 || reqStatus >= 12e3){this._hitError(reqStatus); if (reqStatus >= 400 && reqStatus < 500){this._changeConnectStatus(Strophe.Status.DISCONNECTING, null); this._doDisconnect()}}}if (!(reqStatus > 0 && reqStatus < 1e4 || req.sends > 5)){this._throttledRequestHandler()}}}, _hitError:function(reqStatus){this.errors++; Strophe.warn("request errored, status: " + reqStatus + ", number of errors: " + this.errors); if (this.errors > 4){this._onDisconnectTimeout()}}, _doDisconnect:function(){Strophe.info("_doDisconnect was called"); this.authenticated = false; this.disconnecting = false; this.sid = null; this.streamId = null; this.rid = Math.floor(Math.random() * 4294967295); if (this.connected){this._changeConnectStatus(Strophe.Status.DISCONNECTED, null); this.connected = false}this.handlers = []; this.timedHandlers = []; this.removeTimeds = []; this.removeHandlers = []; this.addTimeds = []; this.addHandlers = []}, _dataRecv:function(req){try{var elem = req.getResponse()} catch (e){if (e != "parsererror"){throw e}this.disconnect("strophe-parsererror")}if (elem === null){return}this.xmlInput(elem); this.rawInput(Strophe.serialize(elem)); var i, hand; while (this.removeHandlers.length > 0){hand = this.removeHandlers.pop(); i = this.handlers.indexOf(hand); if (i >= 0){this.handlers.splice(i, 1)}}while (this.addHandlers.length > 0){this.handlers.push(this.addHandlers.pop())}if (this.disconnecting && this._requests.length === 0){this.deleteTimedHandler(this._disconnectTimeout); this._disconnectTimeout = null; this._doDisconnect(); return}var typ = elem.getAttribute("type"); var cond, conflict; if (typ !== null && typ == "terminate"){cond = elem.getAttribute("condition"); conflict = elem.getElementsByTagName("conflict"); if (cond !== null){if (cond == "remote-stream-error" && conflict.length > 0){cond = "conflict"}this._changeConnectStatus(Strophe.Status.CONNFAIL, cond)} else{this._changeConnectStatus(Strophe.Status.CONNFAIL, "unknown")}this.disconnect(); return}var self = this; Strophe.forEachChild(elem, null, function(child){var i, newList; newList = self.handlers; self.handlers = []; for (i = 0; i < newList.length; i++){var hand = newList[i]; if (hand.isMatch(child) && (self.authenticated || !hand.user)){if (hand.run(child)){self.handlers.push(hand)}} else{self.handlers.push(hand)}}})}, _sendTerminate:function(){Strophe.info("_sendTerminate was called"); var body = this._buildBody().attrs({type:"terminate"}); if (this.authenticated){body.c("presence", {xmlns:Strophe.NS.CLIENT, type:"unavailable"})}this.disconnecting = true; var req = new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)), body.tree().getAttribute("rid")); req.syncRequest = "boolean" === typeof req.syncRequest?req.syncRequest:true; while (this._requests.length > 0)this._requests.pop(); this._requests.push(req); this._throttledRequestHandler()}, _connect_cb:function(req){Strophe.info("_connect_cb was called"); this.connected = true; var bodyWrap = req.getResponse(); if (!bodyWrap){return}this.xmlInput(bodyWrap); this.rawInput(Strophe.serialize(bodyWrap)); var typ = bodyWrap.getAttribute("type"); var cond, conflict; if (typ !== null && typ == "terminate"){cond = bodyWrap.getAttribute("condition"); conflict = bodyWrap.getElementsByTagName("conflict"); if (cond !== null){if (cond == "remote-stream-error" && conflict.length > 0){cond = "conflict"}this._changeConnectStatus(Strophe.Status.CONNFAIL, cond)} else{this._changeConnectStatus(Strophe.Status.CONNFAIL, "unknown")}return}if (!this.sid){this.sid = bodyWrap.getAttribute("sid")}if (!this.stream_id){this.stream_id = bodyWrap.getAttribute("authid")}var wind = bodyWrap.getAttribute("requests"); if (wind){this.window = parseInt(wind, 10)}var hold = bodyWrap.getAttribute("hold"); if (hold){this.hold = parseInt(hold, 10)}var wait = bodyWrap.getAttribute("wait"); if (wait){this.wait = parseInt(wait, 10)}var do_sasl_plain = false; var do_sasl_digest_md5 = false; var do_sasl_anonymous = false; var mechanisms = bodyWrap.getElementsByTagName("mechanism"); var i, mech, auth_str, hashed_auth_str; if (mechanisms.length > 0){for (i = 0; i < mechanisms.length; i++){mech = Strophe.getText(mechanisms[i]); if (mech == "DIGEST-MD5"){do_sasl_digest_md5 = true} else if (mech == "PLAIN"){do_sasl_plain = true} else if (mech == "ANONYMOUS"){do_sasl_anonymous = true}}} else{var body = this._buildBody(); this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)), body.tree().getAttribute("rid"))); this._throttledRequestHandler(); return}if (Strophe.getNodeFromJid(this.jid) === null && do_sasl_anonymous){this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null); this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, "success", null, null); this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, "failure", null, null); this.send($build("auth", {xmlns:Strophe.NS.SASL, mechanism:"ANONYMOUS"}).tree())} else if (Strophe.getNodeFromJid(this.jid) === null){this._changeConnectStatus(Strophe.Status.CONNFAIL, "x-strophe-bad-non-anon-jid"); this.disconnect()} else if (do_sasl_digest_md5){this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null); this._sasl_challenge_handler = this._addSysHandler(this._sasl_challenge1_cb.bind(this), null, "challenge", null, null); this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, "failure", null, null); this.send($build("auth", {xmlns:Strophe.NS.SASL, mechanism:"DIGEST-MD5"}).tree())} else if (do_sasl_plain){auth_str = Strophe.getBareJidFromJid(this.jid); auth_str = auth_str + "\0"; auth_str = auth_str + Strophe.getNodeFromJid(this.jid); auth_str = auth_str + "\0"; auth_str = auth_str + this.pass; this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null); this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, "success", null, null); this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, "failure", null, null); hashed_auth_str = Base64.encode(auth_str); this.send($build("auth", {xmlns:Strophe.NS.SASL, mechanism:"PLAIN"}).t(hashed_auth_str).tree())} else{this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null); this._addSysHandler(this._auth1_cb.bind(this), null, null, null, "_auth_1"); this.send($iq({type:"get", to:this.domain, id:"_auth_1"}).c("query", {xmlns:Strophe.NS.AUTH}).c("username", {}).t(Strophe.getNodeFromJid(this.jid)).tree())}}, _sasl_challenge1_cb:function(elem){var attribMatch = /([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/; var challenge = Base64.decode(Strophe.getText(elem)); var cnonce = MD5.hexdigest(Math.random() * 1234567890); var realm = ""; var host = null; var nonce = ""; var qop = ""; var matches; this.deleteHandler(this._sasl_failure_handler); while (challenge.match(attribMatch)){matches = challenge.match(attribMatch); challenge = challenge.replace(matches[0], ""); matches[2] = matches[2].replace(/^"(.+)"$/, "$1"); switch (matches[1]){case"realm":realm = matches[2]; break; case"nonce":nonce = matches[2]; break; case"qop":qop = matches[2]; break; case"host":host = matches[2]; break}}var digest_uri = "xmpp/" + this.domain; if (host !== null){digest_uri = digest_uri + "/" + host}var A1 = MD5.hash(Strophe.getNodeFromJid(this.jid) + ":" + realm + ":" + this.pass) + ":" + nonce + ":" + cnonce; var A2 = "AUTHENTICATE:" + digest_uri; var responseText = ""; responseText += "username=" + this._quote(Strophe.getNodeFromJid(this.jid)) + ","; responseText += "realm=" + this._quote(realm) + ","; responseText += "nonce=" + this._quote(nonce) + ","; responseText += "cnonce=" + this._quote(cnonce) + ","; responseText += 'nc="00000001",'; responseText += 'qop="auth",'; responseText += "digest-uri=" + this._quote(digest_uri) + ","; responseText += "response=" + this._quote(MD5.hexdigest(MD5.hexdigest(A1) + ":" + nonce + ":00000001:" + cnonce + ":auth:" + MD5.hexdigest(A2))) + ","; responseText += 'charset="utf-8"'; this._sasl_challenge_handler = this._addSysHandler(this._sasl_challenge2_cb.bind(this), null, "challenge", null, null); this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, "success", null, null); this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, "failure", null, null); this.send($build("response", {xmlns:Strophe.NS.SASL}).t(Base64.encode(responseText)).tree()); return false}, _quote:function(str){return'"' + str.replace(/\\/g, "\\\\").replace(/"/g, '\\"') + '"'}, _sasl_challenge2_cb:function(elem){this.deleteHandler(this._sasl_success_handler); this.deleteHandler(this._sasl_failure_handler); this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, "success", null, null); this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, "failure", null, null); this.send($build("response", {xmlns:Strophe.NS.SASL}).tree()); return false}, _auth1_cb:function(elem){var iq = $iq({type:"set", id:"_auth_2"}).c("query", {xmlns:Strophe.NS.AUTH}).c("username", {}).t(Strophe.getNodeFromJid(this.jid)).up().c("password").t(this.pass); if (!Strophe.getResourceFromJid(this.jid)){this.jid = Strophe.getBareJidFromJid(this.jid) + "/strophe"}iq.up().c("resource", {}).t(Strophe.getResourceFromJid(this.jid)); this._addSysHandler(this._auth2_cb.bind(this), null, null, null, "_auth_2"); this.send(iq.tree()); return false}, _sasl_success_cb:function(elem){Strophe.info("SASL authentication succeeded."); this.deleteHandler(this._sasl_failure_handler); this._sasl_failure_handler = null; if (this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler); this._sasl_challenge_handler = null}this._addSysHandler(this._sasl_auth1_cb.bind(this), null, "stream:features", null, null); this._sendRestart(); return false}, _sasl_auth1_cb:function(elem){var i, child; for (i = 0; i < elem.childNodes.length; i++){child = elem.childNodes[i]; if (child.nodeName == "bind"){this.do_bind = true}if (child.nodeName == "session"){this.do_session = true}}if (!this.do_bind){this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); return false} else{this._addSysHandler(this._sasl_bind_cb.bind(this), null, null, null, "_bind_auth_2"); var resource = Strophe.getResourceFromJid(this.jid); if (resource){this.send($iq({type:"set", id:"_bind_auth_2"}).c("bind", {xmlns:Strophe.NS.BIND}).c("resource", {}).t(resource).tree())} else{this.send($iq({type:"set", id:"_bind_auth_2"}).c("bind", {xmlns:Strophe.NS.BIND}).tree())}}return false}, _sasl_bind_cb:function(elem){if (elem.getAttribute("type") == "error"){Strophe.info("SASL binding failed."); this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); return false}var bind = elem.getElementsByTagName("bind"); var jidNode; if (bind.length > 0){jidNode = bind[0].getElementsByTagName("jid"); if (jidNode.length > 0){this.jid = Strophe.getText(jidNode[0]); if (this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this), null, null, null, "_session_auth_2"); this.send($iq({type:"set", id:"_session_auth_2"}).c("session", {xmlns:Strophe.NS.SESSION}).tree())} else{this.authenticated = true; this._changeConnectStatus(Strophe.Status.CONNECTED, null)}}} else{Strophe.info("SASL binding failed."); this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); return false}}, _sasl_session_cb:function(elem){if (elem.getAttribute("type") == "result"){this.authenticated = true; this._changeConnectStatus(Strophe.Status.CONNECTED, null)} else if (elem.getAttribute("type") == "error"){Strophe.info("Session creation failed."); this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); return false}return false}, _sasl_failure_cb:function(elem){if (this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler); this._sasl_success_handler = null}if (this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler); this._sasl_challenge_handler = null}this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); return false}, _auth2_cb:function(elem){if (elem.getAttribute("type") == "result"){this.authenticated = true; this._changeConnectStatus(Strophe.Status.CONNECTED, null)} else if (elem.getAttribute("type") == "error"){this._changeConnectStatus(Strophe.Status.AUTHFAIL, null); this.disconnect()}return false}, _addSysTimedHandler:function(period, handler){var thand = new Strophe.TimedHandler(period, handler); thand.user = false; this.addTimeds.push(thand); return thand}, _addSysHandler:function(handler, ns, name, type, id){var hand = new Strophe.Handler(handler, ns, name, type, id); hand.user = false; this.addHandlers.push(hand); return hand}, _onDisconnectTimeout:function(){Strophe.info("_onDisconnectTimeout was called"); var req; while (this._requests.length > 0){req = this._requests.pop(); req.abort = true; req.xhr.abort(); req.xhr.onreadystatechange = function(){}}this._doDisconnect(); return false}, _onIdle:function(){var i, thand, since, newList; while (this.removeTimeds.length > 0){thand = this.removeTimeds.pop(); i = this.timedHandlers.indexOf(thand); if (i >= 0){this.timedHandlers.splice(i, 1)}}while (this.addTimeds.length > 0){this.timedHandlers.push(this.addTimeds.pop())}var now = (new Date).getTime(); newList = []; for (i = 0; i < this.timedHandlers.length; i++){thand = this.timedHandlers[i]; if (this.authenticated || !thand.user){since = thand.lastCalled + thand.period; if (since - now <= 0){if (thand.run()){newList.push(thand)}} else{newList.push(thand)}}}this.timedHandlers = newList; var body, time_elapsed; if (this.authenticated && this._requests.length === 0 && this._data.length === 0 && !this.disconnecting){Strophe.info("no requests during idle cycle, sending " + "blank request"); this._data.push(null)}if (this._requests.length < 2 && this._data.length > 0 && !this.paused){body = this._buildBody(); for (i = 0; i < this._data.length; i++){if (this._data[i] !== null){if (this._data[i] === "restart"){body.attrs({to:this.domain, "xml:lang":"en", "xmpp:restart":"true", "xmlns:xmpp":Strophe.NS.BOSH})} else{body.cnode(this._data[i]).up()}}}delete this._data; this._data = []; this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)), body.tree().getAttribute("rid"))); this._processRequest(this._requests.length - 1)}if (this._requests.length > 0){time_elapsed = this._requests[0].age(); if (this._requests[0].dead !== null){if (this._requests[0].timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)){this._throttledRequestHandler()}}if (time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait)){Strophe.warn("Request " + this._requests[0].id + " timed out, over " + Math.floor(Strophe.TIMEOUT * this.wait) + " seconds since last activity"); this._throttledRequestHandler()}}clearTimeout(this._idleTimeout); this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)}}; if (callback){callback(Strophe, $build, $msg, $iq, $pres)}})(function(){window.Strophe = arguments[0]; window.$build = arguments[1]; window.$msg = arguments[2]; window.$iq = arguments[3]; window.$pres = arguments[4]}); var eGainLibrarySettings = function(){this.IsDevelopmentModeOn = false; this.IsDebugOn = false; this.CORSHost = ""; this.ChatPauseInSec = 30; this.eGainContextPath = ""}; window.egChatFrameIdentifier = 2; window.eGainLibrarySettings = eGainLibrarySettings; var eGainLibrary = function(librarySettings){var _this = this; this.Datatype = {CustomerObject:function(){this.Locale = {Language:"en", Country:"US"}; this.PrimaryKey = {Name:"", Value:""}; this.PrimaryKeyParams = {PRIMARY_KEY_EMAIL:"Email", PRIMARY_KEY_PHONE:"Phone"}; this.SetPrimaryKey = function(primaryKey, primaryKeyValue){this.PrimaryKey.Name = primaryKey; this.PrimaryKey.Value = primaryKeyValue}; this.CustomerParameters = []; this.AddCustomerParameter = function(customerParam){this.CustomerParameters.push(customerParam)}}, CustomerParameter:function(){this.eGainParentObject = ""; this.eGainChildObject = ""; this.eGainParamName = ""; this.eGainAttribute = ""; this.eGainValue = ""; this.eGainMinLength = ""; this.eGainMaxLength = ""; this.eGainRequired = ""; this.eGainFieldType = ""; this.eGainValidationString = ""}, EventHandlers:function(){this.OnConnectionInitialized = {}; this.OnConnectSuccess = {}; this.OnConnectionComplete = {}; this.OnConnectionFailure = {}; this.OnConnectionPaused = {}; this.OnConnectionResumed = {}; this.OnConnectionAttached = {}; this.OnConnectionAttachedFailure = {}; this.OnConnectionFailure = {}; this.OnDuplicateSession = {}; this.OnAgentsNotAvailable = {}; this.OnSysemMessageReceived = {}; this.OnGetQueueCurrentStatus = {}; this.OnMessagePropertyLoad = {}; this.OnErrorOccured = {}}, ResultObject:function(){this.StatusCode = ""; this.StatusMessage = ""; this.IsSuccess = false}}; this.ConnectionParameters = []; this.AddConnectionParameter = function(paramName, paramValue){if (paramName && paramValue){var obj = {}; obj[paramName] = paramValue; this.ConnectionParameters.push(obj)}}; var _egainLib = this; var _isDevelopmentModeOn = librarySettings?librarySettings.IsDevelopmentModeOn:false; var _corsHost = ""; var _eGainContextPath = librarySettings?librarySettings.eGainContextPath:""; _eGainContextPath = _eGainContextPath?_eGainContextPath:""; var _entryPointId; var _connection = null; var _connected = false; var connectionFailure = false; var languageCode; var countryCode; var _templateName; var _version; var BOSH_SERVICE; var MESSAGING_URL; var CUSTOM_MESSAGING_URL; var MASKING_URL; var _video = false; var _videoURLParam = ""; var _avmode = null; var _avmodeURLParam = ""; var _onConnectionInitialized; var _onConnectSuccess; var _onConnectionComplete; var _onConnectionPaused; var _onConnectionResumed; var _onConnectionFailure; var _onConnectionAttached; var _onConnectionAttachedFailure; var _onDuplicateSession; var _onAgentsNotAvailable; var _onServerNotificationReceived; var _onSystemMessageReceived; var _onGetQueueCurrentStatus; var _onMessagePropertyLoad; var _onErrorOccured; var eGainLog = function(message){if (typeof _this.logger === "function"){_this.logger(message)}}; var initializeApplicationState = function(entryPointId, language, country, templateName, version, serverURL){_entryPointId = entryPointId; if (serverURL)_corsHost = serverURL;  else if (librarySettings && librarySettings.CORSHost)_corsHost = librarySettings.CORSHost; languageCode = language?language:"en"; countryCode = country?country:"US"; _templateName = templateName?templateName:""; _version = version?version:""; eGainLibrary.debug = librarySettings?librarySettings.IsDebugOn:false; eGainLibrary.eGainLog = eGainLog}; var validateEventHandlers = function(callbacks){try{if (typeof callbacks !== "object"){throw"The library cannot be initialized without providing an EventHandlers Object as parameter."}if (typeof callbacks.OnConnectionInitialized !== "function"){} else{_onConnectionInitialized = callbacks.OnConnectionInitialized}if (typeof callbacks.OnConnectSuccess !== "function"){throw"OnConnectSuccess is not defined or is not a function"} else{_onConnectSuccess = callbacks.OnConnectSuccess}if (typeof callbacks.OnConnectionFailure !== "function"){throw"OnConnectionFailure is not defined or is not a function"} else{_onConnectionFailure = callbacks.OnConnectionFailure}if (typeof callbacks.OnConnectionComplete !== "function"){throw"OnConnectionComplete is not defined or is not a function"} else{_onConnectionComplete = callbacks.OnConnectionComplete}if (typeof callbacks.OnSystemMessageReceived !== "function"){throw"OnSystemMessageReceived is not defined or is not a function"} else{_onSystemMessageReceived = callbacks.OnSystemMessageReceived}if (typeof callbacks.OnErrorOccurred !== "function"){throw"OnErrorOccurred is not defined or is not a function"} else{_onErrorOccured = callbacks.OnErrorOccurred}if (typeof callbacks.OnAgentsNotAvailable !== "function"){throw"OnAgentsNotAvailable is not defined or is not a function"} else{_onAgentsNotAvailable = callbacks.OnAgentsNotAvailable}if (typeof callbacks.OnGetQueueCurrentStatus !== "function"){} else{_onGetQueueCurrentStatus = callbacks.OnGetQueueCurrentStatus}if (typeof callbacks.OnConnectionPaused !== "function"){} else{_onConnectionPaused = callbacks.OnConnectionPaused}if (typeof callbacks.OnConnectionResumed !== "function"){} else{_onConnectionResumed = callbacks.OnConnectionResumed}if (typeof callbacks.OnServerNotificationReceived !== "function"){} else{_onServerNotificationReceived = callbacks.OnServerNotificationReceived}if (typeof callbacks.OnConnectionAttached !== "function"){} else{_onConnectionAttached = callbacks.OnConnectionAttached}if (typeof callbacks.OnConnectionAttachedFailure !== "function"){} else{_onConnectionAttachedFailure = callbacks.OnConnectionAttachedFailure}if (typeof callbacks.OnMessagePropertyLoad !== "function"){} else{_onMessagePropertyLoad = callbacks.OnMessagePropertyLoad}if (typeof callbacks.OnDuplicateSession !== "function"){} else{_onDuplicateSession = callbacks.OnDuplicateSession}} catch (err){throw err}}; var validateCustomer = function(customer){var isValidCustomer = false; if (customer.PrimaryKey.Name !== ""){if (customer.PrimaryKey.Name === customer.PrimaryKeyParams.PRIMARY_KEY_EMAIL){var skipValidation = false; for (var itemIndex = 0; itemIndex < customer.CustomerParameters.length; itemIndex++){if (customer.CustomerParameters[itemIndex].eGainAttribute === "email_address" && (typeof customer.CustomerParameters[itemIndex].secureAttribute !== "undefined" && customer.CustomerParameters[itemIndex].secureAttribute === "1")){skipValidation = true; isValidCustomer = true}}var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\ ".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA -Z\-0-9]+\.)+[a-zA-Z]{2,}))$/; if (!skipValidation && re.test(customer.PrimaryKey.Value)){isValidCustomer = true}}if (customer.PrimaryKey.Name === customer.PrimaryKeyParams.PRIMARY_KEY_PHONE){var skipValidation = false; for (var itemIndex = 0; itemIndex < customer.CustomerParameters.length; itemIndex++){if (customer.CustomerParameters[itemIndex].eGainAttribute === "phone_number" && (typeof customer.CustomerParameters[itemIndex].secureAttribute !== "undefined" && customer.CustomerParameters[itemIndex].secureAttribute === "1")){skipValidation = true; isValidCustomer = true}}if (!skipValidation && customer.PrimaryKey.Value.match(/[^0-9 \-\(\)]/) === null){isValidCustomer = true}}if (!isValidCustomer){throw"Customer not correctly initialized. Valid Email or Phone needs to be set as Pimary Key"}}}; var _buildLoginParameters = function(customerObject){var returnValue = []; for (var itemIndex = 0; itemIndex < customerObject.CustomerParameters.length; itemIndex++){var currentParam = {}; currentParam.paramName = customerObject.CustomerParameters[itemIndex].eGainParamName; currentParam.objectName = customerObject.CustomerParameters[itemIndex].eGainParentObject + "::" + customerObject.CustomerParameters[itemIndex].eGainChildObject; currentParam.attributeName = customerObject.CustomerParameters[itemIndex].eGainAttribute; currentParam.attributeValue = customerObject.CustomerParameters[itemIndex].eGainValue; currentParam.primaryKey = customerObject.CustomerParameters[itemIndex].eGainPrimaryKey; currentParam.minLength = customerObject.CustomerParameters[itemIndex].eGainMinLength; currentParam.maxLength = customerObject.CustomerParameters[itemIndex].eGainMaxLength; currentParam.required = customerObject.CustomerParameters[itemIndex].eGainRequired; currentParam.fieldType = customerObject.CustomerParameters[itemIndex].eGainFieldType; currentParam.validationString = customerObject.CustomerParameters[itemIndex].eGainValidationString; currentParam.secureAttribute = customerObject.CustomerParameters[itemIndex].secureAttribute; if (currentParam.secureAttribute === "1")currentParam.egainAttributeName = customerObject.CustomerParameters[itemIndex].providerAttributeName; if (customerObject.PrimaryKey.Name === customerObject.PrimaryKeyParams.PRIMARY_KEY_EMAIL && currentParam.attributeValue === "email_address"){currentParam.objectName = "casemgmt::email_address_contact_point_data"; currentParam.attributeValue = "email_address"; currentParam.primaryKey = "1"} else if (customerObject.PrimaryKey.Name === customerObject.PrimaryKeyParams.PRIMARY_KEY_PHONE && currentParam.attributeValue === "phone_number"){currentParam.objectName = "casemgmt::phone_number_data"; currentParam.attributeValue = "phone_number"; currentParam.primaryKey = "1"}returnValue.push(currentParam)}return returnValue}; var decodeMessage = function(htmlMessage){htmlMessage = htmlMessage.replace(/\\u/g, "%u"); htmlMessage = htmlMessage.replace(/\^/g, "%"); htmlMessage = unescape(htmlMessage); htmlMessage = $.trim(htmlMessage); return htmlMessage}; var replaceHexToASCII = function(str){if (str === "")return""; var caretIdx = str.indexOf("^"); if (caretIdx <= - 1)return str; var leftStr = str.substring(0, caretIdx); var hexStr = str.substring(caretIdx + 1, caretIdx + 3); var hexToASC = String.fromCharCode(parseInt(hexStr, 16)); var rightStr = str.substring(caretIdx + 3); rightStr = replaceHexToASCII(rightStr); return leftStr + hexToASC + rightStr}; var getArticleAttachmentName = function(message){var nodes = $.parseHTML(message); for (var i = 0; i < nodes.length; i++){var node = nodes[i]; if (node.tagName && node.tagName.toLowerCase() === "a"){return node.innerHTML}}return""}; var submitMessage = function(htmlMessage, messageType, command){if ($.trim(htmlMessage.replace(/<br ?\/?>/g, "").replace(/&nbsp;/g, "")).length === 0){return}htmlMessage = htmlMessage.replace(/<a\b/g, '<a target="_blank"'); htmlMessage = htmlMessage.replace(/\n/g, " "); if (!messageType){messageType = "chat"}if (typeof command != "undefined"){_connection.send($msg({type:messageType}).c("body").t(htmlMessage).up().c("egainCommand", {xmlns:"http://bindings.egain.com/chat"}).c("subcmd").t(command).tree())} else{_connection.send($msg({type:messageType}).c("body").t(htmlMessage).tree())}return true}; this.SetCustomer = function(customerObject){var _customerObject; if (customerObject === null){_customerObject = new this.Datatype.CustomerObject} else{_customerObject = customerObject}validateCustomer(_customerObject); var email; for (var itemIndex = 0; itemIndex < _customerObject.CustomerParameters.length; itemIndex++){if (_customerObject.CustomerParameters[itemIndex].eGainAttribute === "email_address"){email = _customerObject.CustomerParameters[itemIndex].eGainValue}}var from = email?email:"anonymous@egain.com"; _connection.from = from.replace(/'/g, "&apos;"); _connection.entryPointId = _entryPointId; var languageCode = _customerObject.Locale.Language || "en"; var countryCode = _customerObject.Locale.Country || "US"; _connection.lang = languageCode + "-" + countryCode; _connection.eGainLoginParameters = _buildLoginParameters(_customerObject)}; this.SetSamlResponse = function(samlResponse){_connection.samlResponse = samlResponse}; this.SetEscalationData = function(escalationData){_connection.escalationData = escalationData}; this.SetXEgainSession = function(xEgainSessionId){_connection.xEgainEscalationHeader = xEgainSessionId}; this.SetVisitorHistoryInformation = function(accountID, userId, oneTagSessionId){_connection.vhtIds = {aId:accountID, sId:oneTagSessionId, uId:userId}}; this.GetQueueCurrentStatus = function(){var QUEUE_STATUS_URL = _corsHost + "/egain/chat/entrypoint/sessionStatistics"; var inputXML = "<sessionStatistics xmlns='http://bindings.egain.com/chat'><sid>"; inputXML += _connection.sid; inputXML += "</sid></sessionStatistics>"; var getQueueLiveStatusArgs = {}; $.ajax({type:"POST", url:QUEUE_STATUS_URL, data:inputXML, contentType:"text/XML", dataType:"xml", success:function(xml){var queueDepth = $(xml).find("ns2\\:queueDepth, queueDepth").text(); var altEngmtTime = $(xml).find("ns2\\:altEngmtTime, altEngmtTime").text(); var waittime = $(xml).find("ns2\\:waitTime, waitTime").text(); waittime = Math.ceil(parseFloat(waittime) / 60); altEngmtTime = parseInt(altEngmtTime); getQueueLiveStatusArgs.QueueDepth = queueDepth; getQueueLiveStatusArgs.WaitTime = waittime; getQueueLiveStatusArgs.AltEngmtTime = altEngmtTime; if (_onGetQueueCurrentStatus)_onGetQueueCurrentStatus(getQueueLiveStatusArgs)}})}; var Masker = function(){this.maskingPatterns = []}; Masker.prototype.SetMaskingPatternData = function(patterns, htmlTagMatcherRegex, htmlTagMatcherIncr){this.maskingPatterns = patterns; this.htmlTagMatcherRegex = htmlTagMatcherRegex; this.htmlTagMatcherIncr = htmlTagMatcherIncr}; Masker.prototype.MaskData = function(htmlData, textData){var patterns = this.maskingPatterns; var htmlTagMatcherRegex = this.htmlTagMatcherRegex; var groupNumIncr = this.htmlTagMatcherIncr; var replacementArr = []; var maskHtmlData = function maskHtmlData(replacementArr, htmlData, htmlTagMatcherRegex, groupNumIncr){var maskedHtml = htmlData; if (replacementArr.length > 0){for (var i = 0; i < replacementArr.length; i++){var maskedStrArr = []; var start = 0; var idx = 0; var replacementObj = replacementArr[i]; var replacementKey = replacementObj.orig; replacementKey = enhanceReplacementKey(replacementKey, htmlTagMatcherRegex, replacementObj.startBoundary, replacementObj.endBoundary); var regEx = new RegExp(replacementKey, "g"); var match = regEx.exec(maskedHtml); while (match){if (match.index + match[0].length === start){break}var replacementValue = replacementObj.replaced; replacementValue = enhanceReplacementValue(replacementValue, groupNumIncr, match); maskedStrArr[idx++] = maskedHtml.substring(start, match.index) + replacementValue; start = match.index + match[0].length; match = regEx.exec(maskedHtml)}maskedStrArr[idx++] = maskedHtml.substring(start, maskedHtml.length); maskedHtml = maskedStrArr.join("")}}return maskedHtml}; var enhanceReplacementKey = function(replacementKey, regex, startBoundary, endBoundary){var enhancedKeyArr = []; var indx = 0; if (startBoundary){enhancedKeyArr[indx++] = "\\b"}for (var i = 0; i < replacementKey.length; i++){if (replacementKey.charAt(i) === "\r" || replacementKey.charAt(i) === "\n"){continue}enhancedKeyArr[indx++] = replacementKey.charAt(i); if (i !== replacementKey.length - 1){enhancedKeyArr[indx++] = regex}}if (endBoundary){enhancedKeyArr[indx++] = "\\b"}var enhancedKey = enhancedKeyArr.join("").replace(/ /g, "(?: ||&nbsp;)").replace(/\u00A0/g, "(?: ||&nbsp;)"); return enhancedKey}; var enhanceReplacementValue = function(replacementValue, groupNumIncr, match){var groupNum = 1; var enhancedValueArr = []; var indx = 0; for (var i = 0; i < replacementValue.length; i++){if (replacementValue.charAt(i) === "\r" || replacementValue.charAt(i) === "\n"){continue}if (replacementValue.charAt(i) === " "){enhancedValueArr[indx++] = "&nbsp;"} else{enhancedValueArr[indx++] = replacementValue.charAt(i)}if (i !== replacementValue.length - 1){enhancedValueArr[indx++] = match[groupNum]; groupNum = groupNum + groupNumIncr}}return enhancedValueArr.join("")}; var maskMatchingPatterns = function(str, re, maskingChar, numCharsToUnmaskFromRight, numCharsToUnmaskFromLeft, applyLunhAlgo, replacementArr){var match = re.exec(str); if (!match){return str}var maskedStrArr = []; var start = 0; var idx = 0; var maskedStr = ""; var prependValue = ""; var appendValue = ""; var startWordBoundary = false; var endWordBoundary = false; while (match){prependValue = ""; appendValue = ""; startWordBoundary = false; endWordBoundary = false; if (match.index + match[0].length === start){break}maskedStr = maskChars(match[0], maskingChar, numCharsToUnmaskFromLeft, numCharsToUnmaskFromRight, applyLunhAlgo); maskedStrArr[idx++] = str.substring(start, match.index) + maskedStr; if (replacementArr && maskedStr !== match[0]){if (match.index > 0 && match.index < str.length){prependValue = str.charAt(match.index - 1); if (!isWordCharacter(prependValue)){prependValue = ""; startWordBoundary = true}} else startWordBoundary = true; if (re.lastIndex < match.input.length && re.lastIndex <= str.length){appendValue = str.charAt(re.lastIndex); if (!isWordCharacter(appendValue)){appendValue = ""; endWordBoundary = true}} else{endWordBoundary = true}replacementArr[replacementArr.length] = {orig:prependValue + match[0] + appendValue, replaced:prependValue + maskedStr + appendValue, startBoundary:startWordBoundary, endBoundary:endWordBoundary}}start = match.index + match[0].length; match = re.exec(str)}maskedStrArr[idx++] = str.substring(start, str.length); return maskedStrArr.join("")}; var isWordCharacter = function(s){return/\w/.test(s)}; var maskChars = function(matchStr, maskingChar, numCharsToUnmaskFromLeft, numCharsToUnmaskFromRight, applyLunhAlgo){if (applyLunhAlgo && !isValidCreditCard(matchStr)){return matchStr}var maskedArr = []; var strLength = matchStr.length; numCharsToUnmaskFromLeft = numCharsToUnmaskFromLeft <= strLength?numCharsToUnmaskFromLeft:strLength; numCharsToUnmaskFromRight = numCharsToUnmaskFromRight <= strLength?numCharsToUnmaskFromRight:strLength; for (var j = strLength - 1; j >= strLength - numCharsToUnmaskFromRight; j--){if (matchStr.charAt(j) === "\n" || matchStr.charAt(j) === "\r"){numCharsToUnmaskFromRight++}}for (var k = 0; k < numCharsToUnmaskFromLeft; k++){if (matchStr.charAt(k) === "\n" || matchStr.charAt(k) === "\r"){numCharsToUnmaskFromLeft++}}var len = strLength - numCharsToUnmaskFromRight; var i = numCharsToUnmaskFromLeft; for (; i < len; i++){if (matchStr.charAt(i) === "\n" || matchStr.charAt(i) === "\r"){maskedArr[i] = matchStr.charAt(i)} else{maskedArr[i] = maskingChar}}var retStr = matchStr.substring(0, numCharsToUnmaskFromLeft) + maskedArr.join("") + matchStr.substring(i, strLength); return retStr}; var isValidCreditCard = function(value){if (/[^0-9-\s]+/.test(value))return false; var nCheck = 0, nDigit = 0, bEven = false; value = value.replace(/\D/g, ""); for (var n = value.length - 1; n >= 0; n--){var cDigit = value.charAt(n), nDigit = parseInt(cDigit, 10); if (bEven){if ((nDigit *= 2) > 9){nDigit -= 9}}nCheck += nDigit; bEven = !bEven}return nCheck % 10 === 0}; for (var i = 0; i < patterns.length; i++){var patternObj = patterns[i]; if (typeof textData !== "undefined" && textData !== htmlData){textData = maskMatchingPatterns(textData, patternObj.compiledRegEx, patternObj.maskingChar, patternObj.charToRetainRight, patternObj.charToRetainLeft, parseInt(patternObj.luhnAlgo) === 1, replacementArr)} else{htmlData = maskMatchingPatterns(htmlData, patternObj.compiledRegEx, patternObj.maskingChar, patternObj.charToRetainRight, patternObj.charToRetainLeft, parseInt(patternObj.luhnAlgo) === 1)}}if (typeof textData !== "undefined" && textData !== htmlData){htmlData = maskHtmlData(replacementArr, htmlData, htmlTagMatcherRegex, groupNumIncr)}return htmlData}; this.Masker = new Masker; var Connection = function(){var _connectToBosh = function(jid, wait, onConnectCallback){if (_connection.eGainMessagingProperty !== null && _connection.eGainMessagingProperty !== undefined){_connection.connect(jid, "", onConnectCallback, wait)} else{setTimeout(function(){_connectToBosh(jid, wait, onConnectCallback)}, 10); return}}; this.InitializeConnectionObject = function(boshServiceURL, messagingPropertyUrl, maskingUrl, customMessagingPropertyUrl){var connectionUrl = boshServiceURL; var additionalParamsStr = ""; if (_egainLib.ConnectionParameters.length > 0){for (var i = 0; i < _egainLib.ConnectionParameters.length; i++){var paramName = Object.keys(_egainLib.ConnectionParameters[i])[0]; var paramValue = _egainLib.ConnectionParameters[i][paramName]; additionalParamsStr += "&" + paramName + "=" + encodeURIComponent(paramValue)}}connectionUrl += additionalParamsStr; var timezoneoffset = (new Date).getTimezoneOffset() * - 1; connectionUrl = connectionUrl + "&custtimeoffset=" + timezoneoffset; if (_video){connectionUrl += "&" + _videoURLParam; if (_avmode){connectionUrl += "&" + _avmodeURLParam}}_connection = new Strophe.Connection(connectionUrl); _connection.eGainOnError = _onErrorOccured; if (typeof this._loadMessagingProperties == "function"){this._loadMessagingProperties(messagingPropertyUrl, customMessagingPropertyUrl)}$.ajax({type:"GET", url:maskingUrl, dataType:"json", success:function(json, textStatus, jqXHR){if (jqXHR.getResponseHeader("X-egain-session")){json.XEgainSession = jqXHR.getResponseHeader("X-egain-session")}var maskingPatterns = json.maskingPatterns.maskingPattern; if (maskingPatterns){var pattern = {}, patterns = []; for (var j = 0; j < maskingPatterns.length; j++){var pattern = maskingPatterns[j]; pattern.compiledRegEx = new RegExp(pattern.regEx, "gi"); patterns[j] = pattern}_egainLib.Masker.SetMaskingPatternData(patterns, json.htmlTagMatcherRegEx, json.htmlTagMatcherIncr)}if (_onConnectionInitialized !== null && _onConnectionInitialized !== undefined){_onConnectionInitialized(json)}}, error:function(){if (_onConnectionInitialized !== null && _onConnectionInitialized !== undefined){_onConnectionInitialized(null)}}})}; this.Start = function(onConnectCallback){var jid = "egain@egain.com"; var wait = null; if (_isDevelopmentModeOn === true){wait = 60 * 5}_connectToBosh(jid, wait, onConnectCallback)}}; var Chat = function(){var connectionObj = new Connection; var _onAgentMessageReceived; var _onAgentJoined; var _onChatTransfer; var _onAgentStartTyping; var _onAgentStopTyping; var _onTranscriptFetched; var _onCobrowseInviteReceived; var _onCustomerInitiateVideo; var _onAgentInitiateVideo; var _onStartVideo; var _onStopVideo; var _onVideoChatTokenReceived; var _onAgentAutoRejectVideo; var _onCustomerAutoRejectVideo; var _onVideoChatCapable; var _onVideoChatMaxEscalation; var _onAudioChatEnabled; var _onAcceptVideoChat; var _onDeclineVideoChat; var _onGetMediaServerDetails; var _onInitiateVideoChat; var _onAttachmentAcceptedByCustomer; var _onAttachmentRejectedByCustomer; var _onAttachmentAcceptedByAgent; var _onAttachmentRejectedByAgent; var _onAttachmentInviteReceived; var _onCustomerAttachmentNotificationSent; var _onGetAttachment; var _onGetAttachmentImageThumbnail; var _onAttachmentUploadedByCustomer; var AVacceptRejectMsgSent = false; var ChatEventHandlers = function(){this.OnAgentMessageReceived = {}; this.OnAgentJoined = {}; this.OnChatTransfer = {}; this.OnAgentStartTyping = {}; this.OnAgentStopTyping = {}; this.OnTranscriptFetched = {}; this.OnCobrowseInviteReceived = {}; this.OnCustomerInitiateVideo = {}; this.OnAgentInitiateVideo = {}; this.OnStartVideo = {}; this.OnStopVideo = {}; this.OnVideoChatTokenReceived = {}; this.OnAgentAutoRejectVideo = {}; this.OnCustomerAutoRejectVideo = {}; this.OnVideoChatCapable = {}; this.OnVideoChatMaxEscalation = {}; this.OnAudioChatEnabled = {}; this.OnAcceptVideoChat = {}; this.OnDeclineVideoChat = {}; this.OnGetMediaServerDetails = {}; this.OnInitiateVideoChat = {}; this.OnCustomerAttachmentNotificationSent = {}; this.OnGetAttachment = {}; this.OnAttachmentAcceptedByCustomer = {}; this.OnAttachmentUploadedByCustomer = {}; this.OnAttachmentRejectedByCustomer = {}; this.OnAttachmentAcceptedByAgent = {}; this.OnAttachmentRejectedByAgent = {}; this.OnAttachmentInviteReceived = {}; this.OnGetAttachmentImageThumbnail = {}}; var validateChatEventHandlers = function(eventHandlers){if (typeof eventHandlers.OnAgentMessageReceived !== "function"){} else{_onAgentMessageReceived = eventHandlers.OnAgentMessageReceived}if (typeof eventHandlers.OnAgentJoined !== "function"){} else{_onAgentJoined = eventHandlers.OnAgentJoined}if (typeof eventHandlers.OnChatTransfer !== "function"){} else{_onChatTransfer = eventHandlers.OnChatTransfer}if (typeof eventHandlers.OnAgentStartTyping !== "function"){} else{_onAgentStartTyping = eventHandlers.OnAgentStartTyping}if (typeof eventHandlers.OnAgentStopTyping !== "function"){} else{_onAgentStopTyping = eventHandlers.OnAgentStopTyping}if (typeof eventHandlers.OnTranscriptFetched !== "function"){} else{_onTranscriptFetched = eventHandlers.OnTranscriptFetched}if (typeof eventHandlers.OnCobrowseInviteReceived !== "function"){} else{_onCobrowseInviteReceived = eventHandlers.OnCobrowseInviteReceived}if (typeof eventHandlers.OnCustomerInitiateVideo !== "function"){} else{_onCustomerInitiateVideo = eventHandlers.OnCustomerInitiateVideo}if (typeof eventHandlers.OnAgentInitiateVideo !== "function"){} else{_onAgentInitiateVideo = eventHandlers.OnAgentInitiateVideo}if (typeof eventHandlers.OnStartVideo !== "function"){} else{_onStartVideo = eventHandlers.OnStartVideo}if (typeof eventHandlers.OnStopVideo !== "function"){} else{_onStopVideo = eventHandlers.OnStopVideo}if (typeof eventHandlers.OnVideoChatTokenReceived !== "function"){} else{_onVideoChatTokenReceived = eventHandlers.OnVideoChatTokenReceived}if (typeof eventHandlers.OnAgentAutoRejectVideo !== "function"){} else{_onAgentAutoRejectVideo = eventHandlers.OnAgentAutoRejectVideo}if (typeof eventHandlers.OnCustomerAutoRejectVideo !== "function"){} else{_onCustomerAutoRejectVideo = eventHandlers.OnCustomerAutoRejectVideo}if (typeof eventHandlers.OnAgentAutoRejectVideo !== "function"){} else{_onAgentAutoRejectVideo = eventHandlers.OnAgentAutoRejectVideo}if (typeof eventHandlers.OnVideoChatCapable !== "function"){} else{_onVideoChatCapable = eventHandlers.OnVideoChatCapable}if (typeof eventHandlers.OnVideoChatMaxEscalation !== "function"){} else{_onVideoChatMaxEscalation = eventHandlers.OnVideoChatMaxEscalation}if (typeof eventHandlers.OnAudioChatEnabled !== "function"){} else{_onAudioChatEnabled = eventHandlers.OnAudioChatEnabled}if (typeof eventHandlers.OnAcceptVideoChat !== "function"){} else{_onAcceptVideoChat = eventHandlers.OnAcceptVideoChat}if (typeof eventHandlers.OnDeclineVideoChat !== "function"){} else{_onDeclineVideoChat = eventHandlers.OnDeclineVideoChat}if (typeof eventHandlers.OnGetMediaServerDetails !== "function"){} else{_onGetMediaServerDetails = eventHandlers.OnGetMediaServerDetails}if (typeof eventHandlers.OnInitiateVideoChat !== "function"){} else{_onInitiateVideoChat = eventHandlers.OnInitiateVideoChat}if (typeof eventHandlers.OnAttachmentAcceptedByCustomer !== "function"){} else{_onAttachmentAcceptedByCustomer = eventHandlers.OnAttachmentAcceptedByCustomer}if (typeof eventHandlers.OnAttachmentRejectedByCustomer !== "function"){} else{_onAttachmentRejectedByCustomer = eventHandlers.OnAttachmentRejectedByCustomer}if (typeof eventHandlers.OnAttachmentAcceptedByAgent !== "function"){} else{_onAttachmentAcceptedByAgent = eventHandlers.OnAttachmentAcceptedByAgent}if (typeof eventHandlers.OnAttachmentUploadedByCustomer !== "function"){} else{_onAttachmentUploadedByCustomer = eventHandlers.OnAttachmentUploadedByCustomer}if (typeof eventHandlers.OnAttachmentRejectedByAgent !== "function"){} else{_onAttachmentRejectedByAgent = eventHandlers.OnAttachmentRejectedByAgent}if (typeof eventHandlers.OnAttachmentInviteReceived !== "function"){} else{_onAttachmentInviteReceived = eventHandlers.OnAttachmentInviteReceived}if (typeof eventHandlers.OnCustomerAttachmentNotificationSent !== "function"){} else{_onCustomerAttachmentNotificationSent = eventHandlers.OnCustomerAttachmentNotificationSent}if (typeof eventHandlers.OnGetAttachment !== "function"){} else{_onGetAttachment = eventHandlers.OnGetAttachment}if (typeof eventHandlers.OnGetAttachmentImageThumbnail !== "function"){} else{_onGetAttachmentImageThumbnail = eventHandlers.OnGetAttachmentImageThumbnail}}; var onConnect = function(status, condition){switch (status){case Strophe.Status.ERROR:break; case Strophe.Status.CONNECTING:break; case Strophe.Status.CONNFAIL:var chatConnectionFailureEventArgs = new _egainLib.Datatype.ResultObject; chatConnectionFailureEventArgs.IsSuccess = false; chatConnectionFailureEventArgs.StatusCode = "CONNECT_FAIL"; chatConnectionFailureEventArgs.StatusMessage = "CONNECTION FAILURE"; switch (condition){case"system-shutdown":connectionFailure = true; var agentsNotAvailableEventArgs = chatConnectionFailureEventArgs; agentsNotAvailableEventArgs.IsSuccess = false; agentsNotAvailableEventArgs.StatusCode = "AGENTS_UNAVAILABLE"; agentsNotAvailableEventArgs.StatusMessage = "AGENTS UNAVAILABLE"; _onAgentsNotAvailable(agentsNotAvailableEventArgs); break; case"other-request":connectionFailure = true; var duplicateSessionEventArgs = chatConnectionFailureEventArgs; duplicateSessionEventArgs.IsSuccess = false; duplicateSessionEventArgs.StatusCode = "DUPLICATE_SESSION"; duplicateSessionEventArgs.StatusMessage = "DUPLICATE_SESSION"; _onDuplicateSession(duplicateSessionEventArgs); break; default:if (condition.indexOf("remote-connection-failed") != - 1){connectionFailure = true; var errorCode = condition.split(":"); var chatConnectionErrorEventArgs = chatConnectionFailureEventArgs; chatConnectionErrorEventArgs.StatusCode = "REMOTE_CONNECTION_FAILURE"; chatConnectionErrorEventArgs.StatusMessage = errorCode[1]; _onConnectionFailure(chatConnectionFailureEventArgs)} else if (!_connection.disconnecting && condition !== "unknown"){connectionFailure = true; chatConnectionFailureEventArgs.StatusMessage = condition; _onConnectionFailure(chatConnectionFailureEventArgs)}break}break; case Strophe.Status.AUTHENTICATING:break; case Strophe.Status.AUTHFAIL:break; case Strophe.Status.DISCONNECTING:break; case Strophe.Status.ATTACHED:_connected = true; _connection.addHandler(notifyUser, null, null, null, null, null); if (_onConnectionAttached !== null && _onConnectionAttached !== undefined){_onConnectionAttached()}break; case Strophe.Status.CONNECTED:_connection.addHandler(notifyUser, null, null, null, null, null); var chatConnectEventArgs = {}; chatConnectEventArgs.ChatID = _connection.sid.split("_")[0]; chatConnectEventArgs.SessionID = _connection.sid; if (_connection.name){chatConnectEventArgs.name = _connection.name; delete _connection.name}if (_connection.subject){chatConnectEventArgs.subject = _connection.subject; delete _connection.subject}_onConnectSuccess(chatConnectEventArgs); _connected = true; break; case Strophe.Status.DISCONNECTED:_connected = false; if (connectionFailure !== true){_onConnectionComplete()}break; default:break}}; var notifyUser = function(messageObjectFromServer){_connected = true; var messageType = messageObjectFromServer.getAttribute("type"); var messageAuthor = messageObjectFromServer.getAttribute("from"); if (messageType && messageAuthor && messageAuthor == "system"){if (_onServerNotificationReceived !== null && _onServerNotificationReceived !== undefined){_onServerNotificationReceived()}}for (var i = 0; i < messageObjectFromServer.childNodes.length; i++){if (!messageObjectFromServer.childNodes[i].tagName){continue}if (messageObjectFromServer.childNodes[i].tagName.indexOf(":widget") > 0){continue}if (messageObjectFromServer.childNodes[i].tagName.indexOf(":body") < 0){}var htmlMessage = messageObjectFromServer.childNodes[i].textContent; if (htmlMessage === "undefined"){htmlMessage = messageObjectFromServer.childNodes[i].text}if (typeof messageObjectFromServer.childNodes[i].baseName !== "undefined" && messageObjectFromServer.childNodes[i].baseName !== null && messageObjectFromServer.childNodes[i].baseName === "egainCommand" || typeof messageObjectFromServer.childNodes[i].localName !== "undefined" && messageObjectFromServer.childNodes[i].localName !== null && messageObjectFromServer.childNodes[i].localName.trim() === "egainCommand"){var egainCmd = null; if (typeof messageObjectFromServer.childNodes[i].text !== "undefined" && messageObjectFromServer.childNodes[i].text !== null)egainCmd = messageObjectFromServer.childNodes[i].text;  else if (typeof messageObjectFromServer.childNodes[i].textContent !== "undefined" && messageObjectFromServer.childNodes[i].textContent !== null)egainCmd = messageObjectFromServer.childNodes[i].textContent.trim(); if (egainCmd !== null && egainCmd !== ""){htmlMessage = ""; if ("custinitiatevideo" === egainCmd && "function" === typeof _onCustomerInitiateVideo){_onCustomerInitiateVideo()} else if ("agentinitiatevideo" === egainCmd && "function" === typeof _onAgentInitiateVideo){_onAgentInitiateVideo()} else if ("startVideo" === egainCmd && "function" === typeof _onStartVideo){_onStartVideo()} else if ("stopVideo" === egainCmd && "function" === typeof _onStopVideo){_onStopVideo()} else if (egainCmd.indexOf("egainCBCmd_") === 0){if (_onCobrowseInviteReceived !== null && _onCobrowseInviteReceived !== undefined){var cbCmd = egainCmd.substring(11); cbCmd = replaceHexToASCII(cbCmd); var cmd = eval("(" + cbCmd + ")"); var action; var sessionId; var customerName; if (typeof cmd !== "undefined" && cmd.action === "add_anchor"){action = cmd.action; sessionId = cmd.sessionId; customerName = cmd.custName}var cobrowseInviteReceivedEventArgs = {}; cobrowseInviteReceivedEventArgs.Action = action; cobrowseInviteReceivedEventArgs.Session = sessionId; cobrowseInviteReceivedEventArgs.CustomerName = customerName; _onCobrowseInviteReceived(cobrowseInviteReceivedEventArgs)}}if (messageObjectFromServer.childNodes[i].childNodes){var arr = {}; var addtionalParams = messageObjectFromServer.childNodes[i]; $(addtionalParams).find("ns2\\:egainAdditionalParam,egainAdditionalParam").each(function(){arr[$(this).find("ns2\\:paramKey,paramKey").text()] = $(this).find("ns2\\:paramValue,paramValue").text()}); egainCmd = $(addtionalParams).find("ns2\\:subcmd,subcmd").text(); if (egainCmd !== null){if (egainCmd == "backstoppingtriggered" || egainCmd == "VIDEO_CHAT_TOKEN" || egainCmd == "custattachmentuploaded" || egainCmd == "acceptcustattachment" || egainCmd == "custacceptattachment" || egainCmd == "custrejectattachment" || egainCmd == "rejectcustattachment" || egainCmd == "agentinitiateattachment"){if (egainCmd == "backstoppingtriggered"){} else if (egainCmd == "custattachmentuploaded"){if (_onAttachmentUploadedByCustomer !== null && _onAttachmentUploadedByCustomer !== undefined){var attachmentUploadedByCustomerEventArgs = {}; attachmentUploadedByCustomerEventArgs.status = 200; attachmentUploadedByCustomerEventArgs.attachmentId = arr.attachmentId; attachmentUploadedByCustomerEventArgs.attachmentName = arr.attachmentName; attachmentUploadedByCustomerEventArgs.attachmentInternalName = arr.attachmentInternalName; _onAttachmentUploadedByCustomer(attachmentUploadedByCustomerEventArgs)}} else if (egainCmd === "custacceptattachment"){if (_onAttachmentAcceptedByCustomer !== null && _onAttachmentAcceptedByCustomer !== undefined){var attachmentAcceptedByAgentEventArgs = {}; attachmentAcceptedByAgentEventArgs.FileId = arr.attachmentId; attachmentAcceptedByAgentEventArgs.FileName = arr.attachmentName; attachmentAcceptedByAgentEventArgs.CustomerName = arr.agentName; _onAttachmentAcceptedByCustomer(attachmentAcceptedByAgentEventArgs)}} else if (egainCmd === "custrejectattachment"){if (_onAttachmentRejectedByCustomer !== null && _onAttachmentRejectedByCustomer !== undefined){var attachmentRejectedByAgentEventArgs = {}; attachmentRejectedByAgentEventArgs.fileId = arr.attachmentId; attachmentRejectedByAgentEventArgs.FileName = arr.attachmentName; attachmentRejectedByAgentEventArgs.agentName = arr.agentName; _onAttachmentRejectedByCustomer(attachmentRejectedByAgentEventArgs)}} else if (egainCmd === "acceptcustattachment"){if (_onAttachmentAcceptedByAgent !== null && _onAttachmentAcceptedByAgent !== undefined){var attachmentAcceptedByAgentEventArgs = {}; attachmentAcceptedByAgentEventArgs.agentName = arr.agentName; attachmentAcceptedByAgentEventArgs.uniqueFileId = arr.filekey; attachmentAcceptedByAgentEventArgs.fileName = arr.fileName; _onAttachmentAcceptedByAgent(attachmentAcceptedByAgentEventArgs)}} else if (egainCmd == "rejectcustattachment"){if (_onAttachmentRejectedByAgent !== null && _onAttachmentRejectedByAgent !== undefined){var attachmentRejectedByAgentEventArgs = {}; attachmentRejectedByAgentEventArgs.uniqueFileId = arr.filekey; _onAttachmentRejectedByAgent(attachmentRejectedByAgentEventArgs)}} else if (egainCmd == "agentinitiateattachment"){if (_onAttachmentInviteReceived !== null && _onAttachmentInviteReceived !== undefined){var attachmentInvitedAgentEventArgs = {}; var Attachment = new Object; Attachment.Id = arr.attachmentId; Attachment.Name = arr.attachmentName; Attachment.AgentName = arr.agentName; Attachment.Type = arr.attachmentType; Attachment.AttachmentSize = arr.attachmentSize; attachmentInvitedAgentEventArgs.Attachment = Attachment; _onAttachmentInviteReceived(attachmentInvitedAgentEventArgs)}} else{var onVideoChatTokenReceivedEventArgs = {}; onVideoChatTokenReceivedEventArgs.avmode = arr["VIDEO_CHAT_AVMODE"]; onVideoChatTokenReceivedEventArgs.vendor = arr["VIDEO_CHAT_VENDOR"]; if ("opentok" === arr["VIDEO_CHAT_VENDOR"]){onVideoChatTokenReceivedEventArgs.openTokParams = arr}_onVideoChatTokenReceived(onVideoChatTokenReceivedEventArgs)}} else if ("agentautoreject" === egainCmd && "function" === typeof _onAgentAutoRejectVideo){_onAgentAutoRejectVideo()} else if ("custautoreject" === egainCmd && "function" === typeof _onCustomerAutoRejectVideo){_onCustomerAutoRejectVideo()}}}}}if (messageType){htmlMessage = unescape(htmlMessage); htmlMessage = decodeMessage(htmlMessage)}if (htmlMessage && htmlMessage.length && htmlMessage.length > 0){if (messageAuthor){messageAuthor = decodeMessage(messageAuthor)}if (messageType === "normal"){if (htmlMessage === "typing_message"){var agentStartTypingEventArgs = {}; agentStartTypingEventArgs.AgentScreenName = messageAuthor; if (_onAgentStartTyping !== null && _onAgentStartTyping !== undefined){_onAgentStartTyping(agentStartTypingEventArgs)}} else{var agentStopTypingEventArgs = {}; agentStopTypingEventArgs.AgentScreenName = messageAuthor; if (_onAgentStopTyping !== null && _onAgentStopTyping !== undefined){_onAgentStopTyping(agentStopTypingEventArgs)}}return true}if ("ActivitySubtypeChangedToVideoChat" === htmlMessage || "AgentInitiateAttachment" === htmlMessage){continue}var subCmd = $(messageObjectFromServer).find("ns2\\:subcmd,subcmd").text(); if (messageType === "chat" && messageAuthor !== "system"){var agentMessageReceivedEventArgs = {}; agentMessageReceivedEventArgs.Message = htmlMessage; agentMessageReceivedEventArgs.AgentScreenName = messageAuthor; agentMessageReceivedEventArgs.PagePushMessage = "pagePushLink" === subCmd; _onAgentMessageReceived(agentMessageReceivedEventArgs)} else{var systemMessageReceivedEventArgs = {}; systemMessageReceivedEventArgs.Message = htmlMessage; if (subCmd !== null){var arr = {}; $(messageObjectFromServer).find("ns2\\:egainAdditionalParam,egainAdditionalParam").each(function(){arr[$(this).find("ns2\\:paramKey,paramKey").text()] = $(this).find("ns2\\:paramValue,paramValue").text()}); if (subCmd === "agentPickup"){var agentJoinedEventArgs = {}; systemMessageReceivedEventArgs.AgentJoinedMessage = true; if ("agentName"in arr){var agentName = arr["agentName"]; agentJoinedEventArgs.AgentName = agentName}if (_onAgentJoined !== null && _onAgentJoined !== undefined){_onAgentJoined(agentJoinedEventArgs)}}if (subCmd === "activityTransfer"){systemMessageReceivedEventArgs.ChatTransferMessage = true; var chatTransferEventArgs = {}; if ("eglvtransfertype"in arr){var transType = arr["eglvtransfertype"]; if (parseInt(transType) > 0){chatTransferEventArgs.TransferType = transType}}if ("eglvtransferEntityName"in arr){var transferEntityName = arr["eglvtransferEntityName"]; if (transferEntityName){chatTransferEventArgs.TransferEntityName = transferEntityName}}if ("chatAttachment"in arr){var chatAttachmentEnabled = arr["chatAttachment"] == 1 || arr["chatAttachment"] == 3; chatTransferEventArgs.ChatAttachmentEnabled = chatAttachmentEnabled}if (_onChatTransfer !== null && _onChatTransfer !== undefined){_onChatTransfer(chatTransferEventArgs)}}if (subCmd === "attachment"){systemMessageReceivedEventArgs.ArticleAttachmentMessage = true; if ("articleAttachmentId"in arr){var attachmentId = arr["articleAttachmentId"]; if (parseInt(attachmentId) > 0){systemMessageReceivedEventArgs.Attachment = {}; systemMessageReceivedEventArgs.Attachment["Id"] = attachmentId; systemMessageReceivedEventArgs.Attachment["Name"] = getArticleAttachmentName(systemMessageReceivedEventArgs.Message)}}}if ("vchatCapable"in arr && "function" === typeof _onVideoChatCapable){var onVideoChatCapableArgs = {}; var vchatCapable = arr["vchatCapable"]; if ("2" === transType || "1" === transType){onVideoChatCapableArgs.isVideoChatEnabled = vchatCapable === "1"; onVideoChatCapableArgs.showVideoButton = true} else{onVideoChatCapableArgs.showVideoButton = vchatCapable === "1"}_onVideoChatCapable(onVideoChatCapableArgs)}if ("vchatMaxEscalation"in arr && "function" === typeof _onVideoChatMaxEscalation){var onVideoChatMaxEscalationArgs = {}; onVideoChatMaxEscalationArgs.videoChatMaxEscalation = parseInt(arr["vchatMaxEscalation"]); onVideoChatMaxEscalationArgs.isDirectVideoChatEnabled = onVideoChatMaxEscalationArgs.videoChatMaxEscalation === 3 || onVideoChatMaxEscalationArgs.videoChatMaxEscalation > 4; _onVideoChatMaxEscalation(onVideoChatMaxEscalationArgs)}if ("enableDirectAudioChat"in arr && "function" === typeof _onAudioChatEnabled){var onAudioChatEnabledArgs = {}; onAudioChatEnabledArgs.isDirectAudioChatEnabled = arr["enableDirectAudioChat"] === "1"; _onAudioChatEnabled(onAudioChatEnabledArgs)}if (subCmd === "acceptcustattachment"){systemMessageReceivedEventArgs.AttachmentAcceptedMsg = true; systemMessageReceivedEventArgs.uniqueFileId = arr.filekey; systemMessageReceivedEventArgs.FileName = arr.fileName}}_onSystemMessageReceived(systemMessageReceivedEventArgs)}}}return true}; this._getEventHandlers = function(){var _chatEventListeners = new ChatEventHandlers; var _connectionEventListeners = new _this.Datatype.EventHandlers; for (var i in _connectionEventListeners){if (!_chatEventListeners.hasOwnProperty(i)){_chatEventListeners[i] = _connectionEventListeners[i]}}return _chatEventListeners}(); this._initialize = function(entryPointId, language, country, eventHandlers, templateName, version, serverURL, video, avmode){var _chatInitResult = new _this.Datatype.ResultObject; var languageCode = language?language:"en"; var countryCode = country?country:"US"; var _templateName = templateName?templateName:""; var _version = version?version:""; _entryPointId = entryPointId; _video = video; _videoURLParam = true === _video?"videoChat=1":_videoURLParam; _avmode = avmode; _avmodeURLParam = null !== _avmode && "number" === typeof _avmode?"avmode=" + _avmode:_avmodeURLParam; initializeApplicationState(entryPointId, language, country, templateName, version, serverURL); BOSH_SERVICE = _corsHost + "/egain/chat/entrypoint?entryPointId=" + entryPointId + "&templateName=" + _templateName + "&languageCode=" + languageCode + "&countryCode=" + countryCode + "&ver=" + _version; MESSAGING_URL = _eGainContextPath + "l10n/messaging_" + languageCode + "_" + countryCode + ".properties"; MASKING_URL = _corsHost + "/egain/chat/entrypoint/initialize" + "/" + entryPointId; validateEventHandlers(eventHandlers); validateChatEventHandlers(eventHandlers); connectionObj.InitializeConnectionObject.call(this, BOSH_SERVICE, MESSAGING_URL, MASKING_URL); return _chatInitResult}; this._loadMessagingProperties = function(messagingPropertyUrl){$.ajax({url:messagingPropertyUrl, type:"GET", dataType:"text", success:function(data){_connection.eGainMessagingProperty = data; if (_onMessagePropertyLoad !== null && _onMessagePropertyLoad !== undefined){_onMessagePropertyLoad(data)}}})}; this._start = function(){connectionObj.Start(onConnect)}; this._end = function(){if (_connection !== null && _connected === true){_connection.disconnect("L10N_CLOSE_MESSAGE")}}; this._sendMessageToAgent = function(htmlMessage, isMessageOffRecord){if (htmlMessage === "")return; if (!isMessageOffRecord){isMessageOffRecord = false}var origHTMLMsg = htmlMessage; var maskedMessage = origHTMLMsg; if (!isMessageOffRecord){maskedMessage = _egainLib.Masker.MaskData(htmlMessage)}submitMessage(maskedMessage); return maskedMessage}; this._sendSystemMessage = function(htmlMessage, cmd){if (typeof cmd === "undefined"){submitMessage(htmlMessage, "headline")} else{submitMessage(htmlMessage, "headline", cmd)}}; this._sendCustomerStartTyping = function(){_connection.send($msg({type:"normal"}).c("body").t("1").tree())}; this._sendCustomerStopTyping = function(){_connection.send($msg({type:"normal"}).c("body").t("0").tree())}; this._getTranscript = function(){var TRANSCRIPT_URL = _corsHost + "/egain/chat/entrypoint/transcript"; var inputXML = "<chatSession xmlns='http://bindings.egain.com/chat'><sid>"; inputXML += _connection.sid; inputXML += "</sid></chatSession>"; var getTranscriptArgs = {}; $.ajax({type:"POST", url:TRANSCRIPT_URL, data:inputXML, contentType:"application/xml", dataType:"json", success:function(response){if (response){if (response.customerName){getTranscriptArgs.CustomerName = response.customerName}if (response.subject){getTranscriptArgs.Subject = response.subject}if (response.assignedTo){getTranscriptArgs.Assignee = response.assignedTo}if (response.startTime){getTranscriptArgs.StartTime = response.startTime}if (Array.isArray && Array.isArray(response.message) && response.message.length > 0){getTranscriptArgs.Messages = []; for (var i = 0; i < response.message.length; i++){var messageObj = {}; var msg = response.message[i]; messageObj.Body = msg["body"]; var sender = msg["sender"]; if (sender){messageObj.SenderName = sender.name; messageObj.SenderType = sender.type}var invitation = msg["invitation"]; if (invitation){messageObj.InvitationMedia = invitation.media; messageObj.InvitationStatus = invitation.status}messageObj.Timestamp = msg.timeStamp; messageObj.OffRecord = msg.offRecord; if (msg.attachment){messageObj.Attachment = {}; messageObj.Attachment.MimeType = msg.attachment.mimeType; if (msg.attachment.internalName){messageObj.Attachment.AttachmentInternalName = msg.attachment.internalName; messageObj.Attachment.SenderName = typeof response.customerName == "undefined"?"Customer":response.customerName; messageObj.Attachment.SenderType = "Customer"} else{messageObj.Attachment.SenderName = response.assignedTo; messageObj.Attachment.SenderType = "Agent"}messageObj.Attachment.Name = msg.attachment.name; messageObj.Attachment.AttachmentSize = msg.attachment.size; messageObj.Attachment.Status = msg.attachment.status; messageObj.Attachment.Id = msg.attachment.url?msg.attachment.url.substring(msg.attachment.url.lastIndexOf("/") + 1):null}getTranscriptArgs.Messages.push(messageObj)}}}if (_onTranscriptFetched)_onTranscriptFetched(getTranscriptArgs)}})}; this._pause = function(){var connection = _connection; if (connection.connected && connection.paused === false){connection.flush(); var chatPauseDuration = librarySettings?librarySettings.ChatPauseInSec:30; var body = connection._buildBody().attrs({pause:chatPauseDuration}); var req = new Strophe.Request(body.tree(), connection._onRequestStateChange.bind(connection).prependArg(connection._dataRecv.bind(connection)), body.tree().getAttribute("rid")); connection._requests.push(req); connection._processRequest(_connection._requests.length - 1); connection.pause(); connection._throttledRequestHandler(); var chatPausedEventArgs = {}; chatPausedEventArgs.requestID = _connection.rid; chatPausedEventArgs.sessionID = _connection.sid; if (_onConnectionPaused){_onConnectionPaused(chatPausedEventArgs)}}}; this._attach = function(sessionID, requestID){var jid = "egain@egain.com"; var attachConnectionUrl = _corsHost + "/egain/chat/entrypoint/attachConnection"; $.ajax({type:"POST", url:attachConnectionUrl, data:{sid:sessionID}, dataType:"text", success:function(string){_connection.attach(jid, sessionID, requestID, onConnect)}, error:function(){if (_onConnectionAttachedFailure){_onConnectionAttachedFailure()}}})}; this._resume = function(){var connection = _connection; if (connection.connected && connection.paused){connection.resume(); if (_onConnectionResumed){_onConnectionResumed()}}}; this._acceptVideoChat = function(sessionID, userId, avmode){var convertVideoChatUrl = _corsHost + "/egain/chat/entrypoint/convertvideochat"; if (!AVacceptRejectMsgSent){AVacceptRejectMsgSent = true; $.ajax({type:"POST", url:convertVideoChatUrl, data:{sid:sessionID, userId:userId, entryPointId:_entryPointId, avmode:avmode}, dataType:"text", success:function(string){AVacceptRejectMsgSent = false; if ("function" === typeof _onAcceptVideoChat){_onAcceptVideoChat(string === "true")}}})}}; this._declineVideoChat = function(sessionID, userId, avmode){var rejectVideoChatUrl = _corsHost + "/egain/chat/entrypoint/rejectvideochat"; if (!AVacceptRejectMsgSent){AVacceptRejectMsgSent = true; $.ajax({type:"POST", url:rejectVideoChatUrl, data:{sid:sessionID, userId:userId, avmode:avmode}, dataType:"text", success:function(string){AVacceptRejectMsgSent = false; if ("function" === typeof _onDeclineVideoChat){_onDeclineVideoChat(string === "true")}}})}}; this._getMediaServerDetails = function(){$.ajax({type:"GET", url:_corsHost + "/egain/chat/entrypoint/mediaServer", dataType:"xml", success:function(xml){var mediaServerObj = {}; var mediaServer = $(xml).find("mediaServer"); mediaServerObj.mediaServerURL = mediaServer.attr("mediaServerURL"); mediaServerObj.mediaServerSecEnabled = mediaServer.attr("mediaServerSecEnabled"); mediaServerObj.mediaServerSecToken = mediaServer.attr("mediaServerSecToken"); mediaServerObj.mediaServerSecConnectParam = mediaServer.attr("mediaServerSecConnectParam"); mediaServerObj.mediaServerSecPlayParam = mediaServer.attr("mediaServerSecPlayParam"); mediaServerObj.mediaServerSecPublishParam = mediaServer.attr("mediaServerSecPublishParam"); if ("function" === typeof _onGetMediaServerDetails){_onGetMediaServerDetails(mediaServerObj)}}})}; this._initiateVideoChat = function(sessionID){var initiateVideoChatUrl = _corsHost + "/egain/chat/entrypoint/initiatevideochat"; var customerIdent = "Customer"; $.ajax({type:"POST", url:initiateVideoChatUrl, data:{sid:sessionID, entryPointId:_entryPointId, customerIdent:customerIdent}, dataType:"text", success:function(response){if ("function" === typeof _onInitiateVideoChat){var onInitiateVideoChatResponse = {statusCode:0, statusText:"EG_VIDEO_AGENT_NOT_AVAILABLE"}; if ("1" === response){onInitiateVideoChatResponse.statusCode = 1; onInitiateVideoChatResponse.statusText = "OK"} else if ("-1" === response){onInitiateVideoChatResponse.statusCode = - 1; onInitiateVideoChatResponse.statusText = "EG_VIDEO_INVITE_ALREADY_SENT"}_onInitiateVideoChat(onInitiateVideoChatResponse)}}})}; this._uploadAttachment = function(file, agentName){var xhr; if (file !== - 1){var chatAttachmentUrl = _corsHost + "/egain/chat/entrypoint" + "/uploadAttachments?language=" + languageCode + "&country=" + countryCode; var uploadAttachmentArgs = {}; uploadAttachmentArgs.uniqueFileId = file.uniqueFileId; var formData = new FormData; formData.append("sid", _connection.sid); formData.append("agentName", agentName); formData.append("fileSize", file.size); formData.append("fileId", file.uniqueFileId); formData.append(file.newName, file); xhr = new XMLHttpRequest; xhr.onload = function(evt){if (evt.target.responseText != parseInt(evt.target.responseText)){uploadAttachmentArgs.status = "failed"; uploadAttachmentArgs.message = evt.target.responseText; _onAttachmentUploadedByCustomer(uploadAttachmentArgs)}}; xhr.open("post", chatAttachmentUrl, true); xhr.send(formData)}return xhr}; this._getAttachment = function(fileId, uniqueFileId){var xhr; if (fileId !== - 1){var agentAttachmentArgs = {}; agentAttachmentArgs.fileId = fileId; agentAttachmentArgs.uniqueFileId = uniqueFileId; var chatAttachmentUrl = _corsHost + "/egain/chat/entrypoint" + "/getattachment/" + fileId; xhr = new XMLHttpRequest; xhr.open("post", chatAttachmentUrl, true); xhr.responseType = "arraybuffer"; xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8"); xhr.onload = function(e){agentAttachmentArgs.data = this.response; if (_onGetAttachment !== null && typeof _onGetAttachment !== "undefined"){_onGetAttachment(agentAttachmentArgs)}}; xhr.send("sid=" + _connection.sid)}return xhr}; this._getArticleAttachment = function(fileName){fileName = escape(fileName); fileName = decodeMessage(fileName); var attachmentUrl = _corsHost + "/egain/chat/entrypoint/getattachment/" + encodeURIComponent(fileName); if (typeof document.formAttachment == "undefined" || document.formAttachment === null){var formAttachment = document.createElement("form"); formAttachment.setAttribute("name", "formAttachment"); formAttachment.setAttribute("method", "POST"); var i = document.createElement("input"); i.setAttribute("type", "hidden"); i.setAttribute("name", "sid"); var s = document.createElement("input"); s.setAttribute("type", "hidden"); s.setAttribute("name", "setCacheHeaders"); formAttachment.appendChild(i); formAttachment.appendChild(s); document.body.appendChild(formAttachment)}if (fileName){document.formAttachment.action = attachmentUrl; document.formAttachment.sid.value = _connection.sid; document.formAttachment.target = "attachmenttarget"; document.formAttachment.setCacheHeaders.value = "false"; document.formAttachment.submit()}}; this._getAttachmentImage = function(attachmentId, uniqueFileId){var data = null; var attachmentThumbnailArgs = {}; $.ajax({type:"POST", url:_corsHost + "/egain/chat/entrypoint/getImageThumbnail", data:{sid:_connection.sid, fileId:attachmentId}, dataType:"text", success:function(responseText){if (responseText){data = responseText; if (_onGetAttachmentImageThumbnail !== null && typeof _onGetAttachmentImageThumbnail !== "undefined"){attachmentThumbnailArgs.data = data; attachmentThumbnailArgs.fileId = attachmentId; if (typeof uniqueFileId !== "undefined" && uniqueFileId !== null)attachmentThumbnailArgs.uniqueFileId = uniqueFileId; _onGetAttachmentImageThumbnail(attachmentThumbnailArgs)}}}, error:function(){return null}})}; this._sendCustomerAttachmentNotification = function(files, customerName){var timeStamp = (new Date).getTime(); var errorOccured = false; for (var i = 0; i < files.length; i++){(function(i){var file = files[i]; var uniqueFileId = timeStamp + "" + i; file.newName = uniqueFileId + "_" + file.name; file.uniqueFileId = uniqueFileId; $.ajax({type:"POST", url:_corsHost + "/egain/chat/entrypoint/sendCustAttachmentNotificaiton", data:{sid:_connection.sid, customerIdentity:customerName, attachmentName:file.name, attachmentInternalName:file.newName, attachmentId:uniqueFileId, attachmentSize:file.size}, dataType:"text", file:file, success:function(rettext){var customerAttachmentNotificationSentEventArgs = {}; if (rettext === "attachmentSettingDisabledForCustomer"){customerAttachmentNotificationSentEventArgs.status = "failed"; customerAttachmentNotificationSentEventArgs.message = rettext; if (!errorOccured){_onCustomerAttachmentNotificationSent(customerAttachmentNotificationSentEventArgs); errorOccured = true}} else if (_onCustomerAttachmentNotificationSent !== null && typeof _onCustomerAttachmentNotificationSent !== "undefined"){var File = {}; File.filename = file.name; File.size = file.size; File.uniqueFileId = uniqueFileId; customerAttachmentNotificationSentEventArgs.status = "success"; customerAttachmentNotificationSentEventArgs.File = File; _onCustomerAttachmentNotificationSent(customerAttachmentNotificationSentEventArgs)}}})})(i)}}; this._sendAcceptChatAttachmentNotification = function(fileId, fileName, customerName){var attachmentAcceptUrl = _corsHost + "/egain/chat/entrypoint/acceptattachment/" + encodeURIComponent(fileId); if (!this.acceptRejectAttachSent){this.acceptRejectAttachSent = true; $.ajax({type:"POST", url:attachmentAcceptUrl, data:{sid:_connection.sid, customerIdentity:customerName, entryPointId:_entryPointId, fileId:fileId, fileName:fileName}, dataType:"text", success:function(string){}, error:function(){}})}this.acceptRejectAttachSent = false}; this._sendRejectChatAttachmentNotification = function(fileId, fileName, customerName){var rejectAttachmenttUrl = _corsHost + "/egain/chat/entrypoint/rejectattachment/" + encodeURIComponent(fileId); if (!this.acceptRejectAttachSent){this.acceptRejectAttachSent = true; $.ajax({type:"POST", url:rejectAttachmenttUrl, data:{sid:_connection.sid, customerIdentity:customerName, entryPointId:_entryPointId, fileId:fileId, fileName:fileName}, dataType:"text", success:function(string){}, error:function(){}})}this.acceptRejectAttachSent = false}}; Chat.prototype = {GetEventHandlers:function(){return this._getEventHandlers}, Initialize:function(entryPointId, language, country, eventHandlers, templateName, version, serverURL, video, avmode){this._initialize(entryPointId, language, country, eventHandlers, templateName, version, serverURL, video, avmode)}, LoadMessagingProperties:function(messagingPropertyUrl){this._loadMessagingProperties(messagingPropertyUrl)}, Start:function(){this._start()}, SendMessageToAgent:function(htmlMessage, isMessageOffRecord){return this._sendMessageToAgent(htmlMessage, isMessageOffRecord)}, SendSystemMessage:function(htmlMessage, cmd){this._sendSystemMessage(htmlMessage, cmd)}, SendCustomerStartTyping:function(){this._sendCustomerStartTyping()}, SendCustomerStopTyping:function(){this._sendCustomerStopTyping()}, GetTranscript:function(){this._getTranscript()}, End:function(){this._end()}, Pause:function(){this._pause()}, Attach:function(sessionID, requestID){this._attach(sessionID, requestID)}, Resume:function(){this._resume()}, AcceptVideoChat:function(sessionID, userId, avmode){this._acceptVideoChat(sessionID, userId, avmode)}, DeclineVideoChat:function(sessionID, userId, avmode){this._declineVideoChat(sessionID, userId, avmode)}, GetMediaServerDetails:function(){this._getMediaServerDetails()}, InitiateVideoChat:function(sessionID){this._initiateVideoChat(sessionID)}, UploadAttachment:function(file, agentName){this._uploadAttachment(file, agentName)}, GetAttachment:function(fileId, uniqueFileId){this._getAttachment(fileId, uniqueFileId)}, GetArticleAttachment:function(fileName){this._getArticleAttachment(fileName)}, GetAttachmentImage:function(attachmentId, uniqueFileId){this._getAttachmentImage(attachmentId, uniqueFileId)}, SendCustomerAttachmentNotification:function(files, customerName){this._sendCustomerAttachmentNotification(files, customerName)}, SendAcceptChatAttachmentNotification:function(fileId, fileName, customerName){this._sendAcceptChatAttachmentNotification(fileId, fileName, customerName)}, SendRejectChatAttachmentNotification:function(fileId, fileName, customerName){this._sendRejectChatAttachmentNotification(fileId, fileName, customerName)}}; this.Chat = Chat; var Callback = function(){Chat.call(this); var connectionObj = new Connection; var _onCallBackInitialized; var _onCallBackMessagePropertyLoad; var _onCallBackConnectionFailure; var _onDuplicateSession; var _onCallBackCompletion; var _onSystemMessageReceived; var _onCallBackErrorOccurred; var _onAgentsNotAvailable; var _onGetQueueCurrentStatus; var _onServerNotificationReceived; var _onCallBackConnectSuccess; var _onCallBackSucceeded; var validateCallbackEventHandlers = function(eventHandlers){try{if (typeof eventHandlers !== "object"){throw"The library cannot be initialized without providing an eGainCallBackCallbacks Object as parameter."}if (typeof eventHandlers.OnCallBackInitialized !== "function"){} else{_onCallBackInitialized = eventHandlers.OnCallBackInitialized}if (typeof eventHandlers.OnCallBackConnectSuccess !== "function"){throw"OnCallBackConnectSuccess is not defined or is not a function"} else{_onCallBackConnectSuccess = eventHandlers.OnCallBackConnectSuccess}if (typeof eventHandlers.OnCallBackSucceeded !== "function"){throw"OnCallBackSucceeded is not defined or is not a function"} else{_onCallBackSucceeded = eventHandlers.OnCallBackSucceeded}if (typeof eventHandlers.OnCallBackConnectionFailure !== "function"){throw"OnCallBackConnectionFailure is not defined or is not a function"} else{_onCallBackConnectionFailure = eventHandlers.OnCallBackConnectionFailure}if (typeof eventHandlers.OnCallBackCompletion !== "function"){throw"OnCallBackCompletion is not defined or is not a function"} else{_onCallBackCompletion = eventHandlers.OnCallBackCompletion}if (typeof eventHandlers.OnSystemMessageReceived !== "function"){throw"OnSystemMessageReceived is not defined or is not a function"} else{_onSystemMessageReceived = eventHandlers.OnSystemMessageReceived}if (typeof eventHandlers.OnCallBackErrorOccurred !== "function"){} else{_onCallBackErrorOccurred = eventHandlers.OnCallBackErrorOccurred}if (typeof eventHandlers.OnAgentsNotAvailable !== "function"){throw"OnAgentsNotAvailable is not defined or is not a function"} else{_onAgentsNotAvailable = eventHandlers.OnAgentsNotAvailable}if (typeof eventHandlers.OnGetQueueCurrentStatus !== "function"){} else{_onGetQueueCurrentStatus = eventHandlers.OnGetQueueCurrentStatus}if (typeof eventHandlers.OnServerNotificationReceived !== "function"){} else{_onServerNotificationReceived = eventHandlers.OnServerNotificationReceived}if (typeof eventHandlers.OnCallBackMessagePropertyLoad !== "function"){} else{_onCallBackMessagePropertyLoad = eventHandlers.OnCallBackMessagePropertyLoad}if (typeof eventHandlers.OnDuplicateSession !== "function"){} else{_onDuplicateSession = eventHandlers.OnDuplicateSession}} catch (err){throw err}}; var onConnect = function(status, condition){switch (status){case Strophe.Status.CONNFAIL:var chatConnectionFailureEventArgs = new _egainLib.Datatype.ResultObject; chatConnectionFailureEventArgs.IsSuccess = false; chatConnectionFailureEventArgs.StatusCode = "CONNECT_FAIL"; chatConnectionFailureEventArgs.StatusMessage = "CONNECTION FAILURE"; switch (condition){case"system-shutdown":connectionFailure = true; var agentsNotAvailableEventArgs = chatConnectionFailureEventArgs; agentsNotAvailableEventArgs.IsSuccess = false; agentsNotAvailableEventArgs.StatusCode = "AGENTS_UNAVAILABLE"; agentsNotAvailableEventArgs.StatusMessage = "AGENTS UNAVAILABLE"; _onAgentsNotAvailable(agentsNotAvailableEventArgs); break; case"other-request":connectionFailure = true; var duplicateSessionEventArgs = chatConnectionFailureEventArgs; duplicateSessionEventArgs.IsSuccess = false; duplicateSessionEventArgs.StatusCode = "DUPLICATE_SESSION"; duplicateSessionEventArgs.StatusMessage = "DUPLICATE SESSION"; _onDuplicateSession(duplicateSessionEventArgs); break; case"L10N_EXIT_TXT":connectionFailure = false; _connected = true; var callbackSuccessEventArgs = chatConnectionFailureEventArgs; callbackSuccessEventArgs.IsSuccess = true; callbackSuccessEventArgs.StatusCode = "CALLBACK_SUCCESS"; callbackSuccessEventArgs.StatusMessage = "CALLBACK_SUCCESS"; _onCallBackSucceeded(callbackSuccessEventArgs); break; default:if (condition.indexOf("remote-connection-failed") != - 1){connectionFailure = true; var errorCode = condition.split(":"); var chatConnectionErrorEventArgs = chatConnectionFailureEventArgs; chatConnectionErrorEventArgs.StatusCode = errorCode[1]; _onCallBackConnectionFailure(chatConnectionFailureEventArgs)} else if (!_connection.disconnecting && condition !== "unknown"){connectionFailure = true; chatConnectionFailureEventArgs.StatusCode = condition; _onCallBackConnectionFailure(chatConnectionFailureEventArgs)}break}break; case Strophe.Status.CONNECTED:_connection.addHandler(notifyUser, null, null, null, null, null); var chatConnectEventArgs = {}; chatConnectEventArgs.CallBackID = _connection.sid.split("_")[0]; chatConnectEventArgs.SessionID = _connection.sid; if (_connection.name){chatConnectEventArgs.name = _connection.name; delete _connection.name}if (_connection.subject){chatConnectEventArgs.subject = _connection.subject; delete _connection.subject}_onCallBackConnectSuccess(chatConnectEventArgs); _connected = true; break; case Strophe.Status.DISCONNECTED:_connected = false; if (connectionFailure !== true){_onCallBackCompletion()}break; default:break}}; var notifyUser = function(messageObjectFromServer){_connected = true; var messageType = messageObjectFromServer.getAttribute("type"); var messageAuthor = messageObjectFromServer.getAttribute("from"); if (messageType && messageAuthor && messageAuthor == "system"){if (_onServerNotificationReceived !== null && _onServerNotificationReceived !== undefined){_onServerNotificationReceived()}}for (var i = 0; i < messageObjectFromServer.childNodes.length; i++){if (!messageObjectFromServer.childNodes[i].tagName){continue}if (messageObjectFromServer.childNodes[i].tagName.indexOf(":widget") > 0){continue}if (messageObjectFromServer.childNodes[i].tagName.indexOf(":body") < 0){}var htmlMessage = messageObjectFromServer.childNodes[i].textContent; if (htmlMessage === "undefined"){htmlMessage = messageObjectFromServer.childNodes[i].text}var transferParam = messageObjectFromServer.childNodes[i]; var arr = {}; $(transferParam).find("ns2\\:egainAdditionalParam,egainAdditionalParam").each(function(){arr[$(this).find("ns2\\:paramKey,paramKey").text()] = $(this).find("ns2\\:paramValue,paramValue").text()}); var transType = ""; if (messageType){htmlMessage = unescape(htmlMessage); htmlMessage = decodeMessage(htmlMessage)}if (htmlMessage && htmlMessage.length && htmlMessage.length > 0){var systemMessageReceivedEventArgs = {}; systemMessageReceivedEventArgs.Message = htmlMessage; _onSystemMessageReceived(systemMessageReceivedEventArgs)}}return true}; this._loadMessagingProperties = function(messagingPropertyUrl, customMessagingPropertyUrl){$.ajax({url:messagingPropertyUrl, type:"GET", dataType:"text", success:function(data){_connection.eGainMessagingProperty = data; $.ajax({url:customMessagingPropertyUrl, type:"GET", dataType:"text", success:function(data){_connection.eGainMessagingProperty = _connection.eGainMessagingProperty + "\n" + data; if (_onCallBackMessagePropertyLoad !== null && _onCallBackMessagePropertyLoad !== undefined){_onCallBackMessagePropertyLoad(data)}}})}})}; this._initialize = function(entryPointId, language, country, eventHandlers, templateName, version, subActivity, serverURL){var _chatInitResult = new _this.Datatype.ResultObject; var languageCode = language?language:"en"; var countryCode = country?country:"US"; var _templateName = templateName?templateName:""; var _version = version?version:""; _entryPointId = entryPointId; initializeApplicationState(entryPointId, language, country, templateName, version, serverURL); BOSH_SERVICE = _corsHost + "/egain/chat/entrypoint?subActivity=" + subActivity + "&entryPointId=" + entryPointId + "&templateName=" + _templateName + "&languageCode=" + languageCode + "&countryCode=" + countryCode + "&ver=" + _version; MESSAGING_URL = _eGainContextPath + "l10n/callback_" + languageCode + "_" + countryCode + ".properties"; CUSTOM_MESSAGING_URL = _eGainContextPath + "l10n/custom_callback_" + languageCode + "_" + countryCode + ".properties"; MASKING_URL = _corsHost + "/egain/chat/entrypoint/initialize" + "/" + entryPointId; validateCallbackEventHandlers(eventHandlers); connectionObj.InitializeConnectionObject.call(this, BOSH_SERVICE, MESSAGING_URL, MASKING_URL, CUSTOM_MESSAGING_URL); return _chatInitResult}; this._start = function(){connectionObj.Start(onConnect)}}; Callback.prototype = Object.create(Chat.prototype); Callback.prototype.constructor = Callback; Callback.prototype.Initialize = function(entryPointId, language, country, eventHandlers, templateName, version, subActivity, serverURL){this._initialize(entryPointId, language, country, eventHandlers, templateName, version, subActivity, serverURL)}; this.Callback = Callback}; window.eGainLibrary = eGainLibrary; Strophe.log = function(level, msg){try{if (level === Strophe.LogLevel.ERROR || level === Strophe.LogLevel.FATAL || eGainLibrary.debug){if (this.eGainOnError){this.eGainOnError({message:msg})}if (eGainLibrary.eGainLog){eGainLibrary.eGainLog(msg)} else{console.log(msg)}}} catch (e){}}; Strophe.SECONDARY_TIMEOUT = 99; Strophe.Connection.prototype.connect = function(jid, pass, callback, wait, hold){this.jid = jid; this.pass = pass; this.connect_callback = callback; this.disconnecting = false; this.connected = false; this.authenticated = false; this.errors = 0; this.wait = wait || this.wait; this.hold = hold || this.hold; this.domain = Strophe.getDomainFromJid(this.jid); var attributes = {to:this.entryPointId, from:this.from, authId:0, "xml:lang":this.lang, wait:this.wait, hold:this.hold, content:"text/xml; charset=utf-8", ver:"1.6", "xmlns:xmpp":Strophe.NS.BOSH, "xmpp:version":"1.0"}; var body = this._buildBody().attrs(attributes); var $egainParams = body.c("egainParams", {xmlns:"http://bindings.egain.com/chat"}); if (this.eGainLoginParameters && this.eGainLoginParameters.length > 0){for (var i = 0; i < this.eGainLoginParameters.length; i++){eGainLibrary.addParamXml($egainParams, this.eGainLoginParameters[i])}}if (typeof this.vhtIds != "undefined" && this.vhtIds){body.c("visitorIdentifier").c("aId").t(this.vhtIds.aId).up().c("sId").t(this.vhtIds.sId).up().c("uId").t(this.vhtIds.uId).up().up()}if (typeof App != "undefined" && App && typeof App.eGainCustomParams != "undefined" && App.eGainCustomParams && typeof App.eGainCustomParams.backStoppingTime != "undefined" && App.eGainCustomParams.backStoppingTime && typeof App.eGainCustomParams.backStoppingAction != "undefined" && App.eGainCustomParams.backStoppingAction){body.c("backStoppingParams").c("time").t(new String(App.eGainCustomParams.backStoppingTime)).up().c("action").t(App.eGainCustomParams.backStoppingAction).up().up()}if (typeof App != "undefined" && App && typeof App.eGainCustomParams != "undefined" && App.eGainCustomParams && typeof App.eGainCustomParams.eglvcaseid != "undefined" && App.eGainCustomParams.eglvcaseid){body.c("caseId").t(new String(App.eGainCustomParams.eglvcaseid)).up()}body.c("messagingData", "<![CDATA[" + this.eGainMessagingProperty + "]]>").up(); if (typeof this.samlResponse != "undefined" && this.samlResponse != "null"){body.c("authenticationData").c("SAMLResponse").t(this.samlResponse).up().up(); delete this.samlResponse}if (typeof this.escalationData != "undefined" && this.escalationData != "null"){body.c("escalationData").c("vaDomain").t(this.escalationData.vaDomain).up().c("vaTenantId").t(this.escalationData.vaTenantId).up().c("vaSessionId").t(this.escalationData.vaSessionId).up().c("vaBotName").t(this.escalationData.vaBotName).up().up(); delete this.escalationData}this._changeConnectStatus(Strophe.Status.CONNECTING, null); this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)), body.tree().getAttribute("rid"))); document.cookie = "egain-last-request-id=" + body.tree().getAttribute("rid"); this._throttledRequestHandler()}; eGainLibrary.addParamXml = function($egainParameters, parameterDefinition){var attribName = parameterDefinition.attributeName; if (!attribName)return; var attributeValue = null; if (typeof App != "undefined")attributeValue = App.session.get(attribName);  else attributeValue = parameterDefinition.attributeValue; attributeValue = eGainLibrary.escapeXML(attributeValue); if (attributeValue.constructor != Array){attributeValue = attributeValue.replace(/[\r\n]/g, "<br />")} else{for (var i = 0; i < attributeValue.length; i++){attributeValue[i] = attributeValue[i].replace(/[\r\n]/g, "<br />")}}$egainParameters.c("param", {name:parameterDefinition.paramName}).c("mapping"); if (parameterDefinition.egainAttributeName != "undefined" && parameterDefinition.egainAttributeName){$egainParameters.c("egainAttributeName").t(parameterDefinition.egainAttributeName).up()}$egainParameters.c("attributeName").t(parameterDefinition.attributeName).up().c("objectName").t(parameterDefinition.objectName).up().c("attributeValue").t(attributeValue).up().c("validationString").up(parameterDefinition.validationString).c("primaryKey").t(parameterDefinition.primaryKey).up(); if (parameterDefinition.secureAttribute != "undefined" && parameterDefinition.secureAttribute){$egainParameters.c("secureAttribute").t(parameterDefinition.secureAttribute).up()}$egainParameters.c("minLength").t(parameterDefinition.minLength).up().c("maxLength").t(parameterDefinition.maxLength).up().c("required").t(parameterDefinition.required).up().c("fieldType").t(parameterDefinition.fieldType).up().up().up()}; eGainLibrary.escapeXML = function(str){if (!str)return""; if (str.constructor != Array){str = str.replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;").replace(/'/g, "&#39;").replace(/"/g, "&quot;").replace(/[\r\n]/g, "<br />")} else{for (var i = 0; i < str.length; i++){str[i] = str[i].replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;").replace(/'/g, "&#39;").replace(/"/g, "&quot;").replace(/[\r\n]/g, "<br />")}}return str}; var xmlEscape = eGainLibrary.escapeXML; Strophe.Connection.prototype._connect_cb = function(req){Strophe.info("_connect_cb was called"); this.connected = true; var bodyWrap = req.getResponse(); if (!bodyWrap){return}this.xmlInput(bodyWrap); this.rawInput(Strophe.serialize(bodyWrap)); var typ = bodyWrap.getAttribute("type"); var cond, conflict, errorCode; if (typ !== null && typ == "terminate"){cond = bodyWrap.getAttribute("condition"); conflict = bodyWrap.getElementsByTagName("conflict"); for (var mindex = 0; mindex < bodyWrap.childNodes.length; mindex++){var errorMsg = bodyWrap.childNodes[mindex]; if (errorMsg.tagName && errorMsg.tagName.indexOf("error") != - 1){for (var i = 0; i < errorMsg.childNodes.length; i++){if (errorMsg.childNodes[i].tagName){if (errorMsg.childNodes[i].tagName.indexOf("code") != - 1){errorCode = Strophe.getText(errorMsg.childNodes[i])}}}}}if (cond !== null){if (cond == "remote-stream-error" && conflict.length > 0){cond = "conflict"} else if (cond == "remote-connection-failed" && typeof errorCode != "undefined"){cond = cond + ":" + errorCode}this._changeConnectStatus(Strophe.Status.CONNFAIL, cond)} else{this._changeConnectStatus(Strophe.Status.CONNFAIL, "unknown")}return} else{var formValues = {}; for (var mindex = 0; mindex < bodyWrap.childNodes.length; mindex++){var egainResponseParams = bodyWrap.childNodes[mindex]; if (egainResponseParams.tagName && egainResponseParams.tagName.indexOf("egainResponseParams") != - 1){for (var responseParamCounter = 0; responseParamCounter < egainResponseParams.childNodes.length; responseParamCounter++){var responseParam = egainResponseParams.childNodes[responseParamCounter]; if (responseParam.tagName && responseParam.tagName.indexOf("responseParam") != - 1){for (var reseponseParamMappingCounter = 0; reseponseParamMappingCounter < responseParam.childNodes.length; reseponseParamMappingCounter++){var responseParamMapping = responseParam.childNodes[reseponseParamMappingCounter]; if (responseParamMapping.tagName && responseParamMapping.tagName.indexOf("responseParamMapping") != - 1){if (window.navigator.userAgent.indexOf("MSIE") != - 1 && (window.navigator.userAgent.indexOf("Trident/4.0") != - 1 || window.navigator.userAgent.indexOf("Trident/5.0") != - 1)){if (Strophe.getText(responseParamMapping.childNodes[0]) == "full_name"){this.name = Strophe.getText(responseParamMapping.childNodes[1])} else if (Strophe.getText(responseParamMapping.childNodes[0]) == "subject"){this.subject = Strophe.getText(responseParamMapping.childNodes[1])} else if (Strophe.getText(responseParamMapping.childNodes[0]) == "first_name" || Strophe.getText(responseParamMapping.childNodes[0]) == "last_name"){this.name = this.name?this.name + " " + Strophe.getText(responseParamMapping.childNodes[1]):Strophe.getText(responseParamMapping.childNodes[1])}} else{for (var i = 0; i < responseParamMapping.childNodes.length; i++){if (responseParamMapping.childNodes[i].tagName && responseParamMapping.childNodes[i].tagName.indexOf("attributeName") != - 1){if (Strophe.getText(responseParamMapping.childNodes[i]) == "full_name"){this.name = Strophe.getText(responseParamMapping.childNodes[i + 2]); i = i + 2} else if (Strophe.getText(responseParamMapping.childNodes[i]) == "subject"){this.subject = Strophe.getText(responseParamMapping.childNodes[i + 2]); i = i + 2} else if (Strophe.getText(responseParamMapping.childNodes[i]) == "first_name" || Strophe.getText(responseParamMapping.childNodes[i]) == "last_name"){this.name = this.name?this.name + " " + Strophe.getText(responseParamMapping.childNodes[i + 2]):Strophe.getText(responseParamMapping.childNodes[i + 2]); i = i + 2}}}}}}}}}}}if (!this.sid){this.sid = bodyWrap.getAttribute("sid")}if (!this.stream_id){this.stream_id = bodyWrap.getAttribute("authid")}var wind = bodyWrap.getAttribute("requests"); if (wind){this.window = parseInt(wind, 10)}var hold = bodyWrap.getAttribute("hold"); if (hold){this.hold = parseInt(hold, 10)}var wait = bodyWrap.getAttribute("wait"); if (wait){this.wait = parseInt(wait, 10)}this.authenticated = true; this._changeConnectStatus(Strophe.Status.CONNECTED, null)}; Strophe.Connection.prototype._buildBody = function(){var bodyWrap = $build("body", {rid:this.rid++, xmlns:Strophe.NS.HTTPBIND}); var payLoad = {Method:"SET", Key:"EgainLastRequestId", Value:this.rid, Caller:"EGLV_DOCK_CALLER_SET"}; if (this.connected){window.parent.postMessage(JSON.stringify(payLoad), "*"); document.cookie = "egain-last-request-id=" + this.rid}if (this.sid !== null){bodyWrap.attrs({sid:this.sid})}return bodyWrap}; Strophe.Connection.prototype._processRequest = function(i, sync){var req = this._requests[i]; var reqStatus = - 1; try{if (req.xhr.readyState == 4){reqStatus = req.xhr.status}} catch (e){Strophe.error("caught an error in _requests[" + i + "], reqStatus: " + reqStatus)}if (typeof reqStatus == "undefined"){reqStatus = - 1}var time_elapsed = req.age(); var primaryTimeout = !isNaN(time_elapsed) && time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait); var secondaryTimeout = req.dead !== null && req.timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait); var requestCompletedWithServerError = req.xhr.readyState == 4 && (reqStatus < 1 || reqStatus >= 500); if (primaryTimeout || secondaryTimeout || requestCompletedWithServerError){if (secondaryTimeout){Strophe.error("Request " + this._requests[i].id + " timed out (secondary), restarting")}req.abort = true; req.xhr.abort(); req.xhr.onreadystatechange = function(){}; this._requests[i] = new Strophe.Request(req.xmlData, req.origFunc, req.rid, req.sends); document.cookie = "egain-last-request-id=" + req.rid; req = this._requests[i]}if (req.xhr.readyState === 0){Strophe.debug("request id " + req.id + "." + req.sends + " posting"); req.date = new Date; try{var sync = "boolean" === typeof req.syncRequest?req.syncRequest:"boolean" === typeof this.syncRequest?this.syncRequest:false; req.xhr.open("POST", this.service, !sync)} catch (e2){Strophe.error("XHR open failed: " + e2.message); if (!this.connected){this._changeConnectStatus(Strophe.Status.CONNFAIL, "bad-service")}this.disconnect(); return}req.xhr.setRequestHeader("Content-Type", "application/xml"); req.xhr.setRequestHeader("X-egain-session", this.xEgainEscalationHeader); var sendFunc = function(){req.xhr.send(req.data)}; if (req.sends > 1){var backoff = Math.pow(req.sends, 3) * 1e3; setTimeout(sendFunc, backoff)} else{sendFunc()}req.sends++; this.xmlOutput(req.xmlData); this.rawOutput(req.data)} else{Strophe.debug("_processRequest: " + (i === 0?"first":"second") + " request has readyState of " + req.xhr.readyState)}}; Strophe.Connection.prototype._hitError = function(reqStatus){if (typeof App == "undefined"){if (typeof clearPollQueueStatusTimer == "function")clearPollQueueStatusTimer()} else App.connection.clearPollQueueStatusTimer(); this.errors++; Strophe.warn("request errored, status: " + reqStatus + ", number of errors: " + this.errors); if (this.errors > 4){if ("function" === typeof this.eGainOnError){this.eGainOnError({status:"error", message:"Should be abandoned. " + reqStatus})}this._onDisconnectTimeout()} else{if ("function" === typeof this.eGainOnError){this.eGainOnError({status:"log", message:"Retrying. " + reqStatus})}}}; Strophe.Connection.prototype._onRequestStateChange = function(func, req){try{Strophe.debug("request id " + req.id + "." + req.sends + " state changed to " + req.xhr.readyState)} catch (e){}if (req.abort){req.abort = false; return}var reqStatus; if (req.xhr.readyState == 4){reqStatus = 0; try{reqStatus = req.xhr.status} catch (e){}if (typeof reqStatus == "undefined"){reqStatus = 0}if (this.disconnecting){if (reqStatus >= 400){this._hitError(reqStatus); return}}var reqIs0 = this._requests[0] == req; var reqIs1 = this._requests[1] == req; if (reqStatus > 0 && reqStatus < 500 || req.sends > 5){this._removeRequest(req); try{Strophe.debug("request id " + req.id + " should now be removed")} catch (e){}}if (reqStatus == 200){if (reqIs1 || reqIs0 && this._requests.length > 0 && this._requests[0].age() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)){this._restartRequest(0)}try{Strophe.debug("request id " + req.id + "." + req.sends + " got 200")} catch (e){}func(req); this.errors = 0} else{if ("function" === typeof this.eGainOnError){this.eGainOnError({status:"error", message:"Should be abandoned. " + reqStatus})} else Strophe.error("request id " + req.id + "." + req.sends + " error " + reqStatus + " happened"); if (reqStatus === 0 || reqStatus >= 400 && reqStatus < 600 || reqStatus >= 12e3){this._hitError(reqStatus); if (reqStatus >= 400 && reqStatus < 500){this._changeConnectStatus(Strophe.Status.DISCONNECTING, null); this._doDisconnect()}}}if (!(reqStatus > 0 && reqStatus < 1e4 || req.sends > 5)){this._throttledRequestHandler()}}}; eGainLibrary.xmlOutput = function(elem){console.log("eGainLibrary.xmlOutput: " + elem)}; eGainLibrary.xmlInput = function(elem){console.log("eGainLibrary.xmlInput: " + elem); if (false){try{for (var mindex = 0; mindex < elem.childNodes.length; mindex++){var msg = elem.childNodes[mindex]; for (var i = 0; i < msg.childNodes.length; i++){if (!msg.childNodes[i].tagName || msg.childNodes[i].tagName.indexOf("body") < 0){continue}var messageHtml = msg.childNodes[i].textContent; if (!messageHtml){messageHtml = msg.childNodes[i].text}messageHtml = unescape(messageHtml); messageHtml = messageHtml.replace(/\^/g, "%"); messageHtml = unescape(messageHtml); messageHtml = $.trim(messageHtml); if (messageHtml.length > 0){transcribe(transcriptEntry(agentIdent, messageHtml), "xmlInput")}}}} catch (e){alert(e.message)}}}; eGainLibrary.rawOutput = function(data){console.log("eGainLibrary.rawOutput: " + data)}; eGainLibrary.rawInput = function(data){console.log("eGainLibrary.rawInput: " + data)}})(jQuery.noConflict(true));